# v0.8.0 リファクタリング詳細実行計画書

## 実行状況サマリー
- **開始日**: 2025-07-27
- **現在フェーズ**: 0（準備段階）
- **進捗率**: 0%
- **完了タスク数**: 2/50+
- **ブランチ**: feature/v0.8.0-major-refactoring

## リファクタリング方針
- **目的**: Rimorのコアバリュー「テストの質を監査する」への回帰
- **戦略**: 60%の機能削減によるシンプル化 + DIコンテナによる疎結合化
- **期間**: 6週間（2025-07-27 〜 2025-09-07予定）

## フェーズ別詳細タスクリスト

### フェーズ0: 準備段階（即座に実行）
- [x] feature/v0.8.0-major-refactoringブランチ作成
- [x] v0.8.0-refactoring-plan.md作成（本ファイル）
- [ ] v0.8.0-file-changes.md作成
- [ ] v0.8.0-test-migration.md作成
- [ ] 初期コミット（計画書のみ）

### フェーズ1: 断捨離（1週間: 2025-07-27 〜 2025-08-03）

#### 1.1 ディレクトリ削除
- [ ] src/dictionary/ディレクトリ削除（12ファイル）
  - [ ] context/（analyzer.ts, engine.ts, scorer.ts）
  - [ ] core/（dictionary.ts, rule.ts, term.ts）
  - [ ] extractors/（knowledgeExtractor.ts, linter.ts, termExtractor.ts）
  - [ ] storage/（cache.ts, loader.ts, versioning.ts）
- [ ] src/interactive/ディレクトリ削除（5ファイル）
  - [ ] analyzer.ts
  - [ ] creator.ts
  - [ ] generator.ts
  - [ ] types.ts
  - [ ] validator.ts
- [ ] src/scoring/内の高度機能削除
  - [ ] prediction.ts
  - [ ] trends.ts
  - [ ] history.ts
  - [ ] 他の複雑な分析機能
- [ ] src/ai-output/内の高度機能削除
  - [ ] project-inference.ts
  - [ ] projectInference.ts（重複？）
  - [ ] その他のProgressive AI機能

#### 1.2 テスト削除
- [ ] test/dictionary/**/*.test.ts 削除
- [ ] test/interactive/**/*.test.ts 削除
- [ ] test/scoring/内の対応するテスト削除
- [ ] test/ai-output/内の対応するテスト削除

#### 1.3 依存関係クリーンアップ
- [ ] package.jsonから不要な依存削除
- [ ] 削除したモジュールのimport文を全ファイルから削除

#### 1.4 CLIコマンド削減
- [ ] src/cli/commands/内の不要コマンド削除
  - [ ] dictionary.ts
  - [ ] plugin-create.ts
  - [ ] trend.ts
  - [ ] その他の複雑なコマンド

### フェーズ2: 基盤構築（1週間: 2025-08-04 〜 2025-08-10）

#### 2.1 DIコンテナ導入
- [ ] inversify, reflect-metadataのインストール
- [ ] tsconfig.jsonの設定更新
- [ ] src/container/index.ts作成
- [ ] src/container/types.ts作成（DIトークン定義）

#### 2.2 コアサービス定義
- [ ] IAnalysisEngine インターフェース定義
- [ ] ISecurityAuditor インターフェース定義
- [ ] IReporter インターフェース定義
- [ ] IPluginManager インターフェース定義（簡素版）

#### 2.3 基本DIバインディング
- [ ] 4つのコアサービスのバインディング設定
- [ ] 開発/本番環境の切り替え設定

### フェーズ3: コア再構築（2週間: 2025-08-11 〜 2025-08-24）

#### 3.1 AnalysisEngine実装
- [ ] 3つのAnalyzer統合（Analyzer, ParallelAnalyzer, CachedAnalyzer）
- [ ] 新しいsrc/core/engine.ts作成
- [ ] AST生成に特化した実装
- [ ] 既存のfileDiscovery機能の統合

#### 3.2 v0.7.0セキュリティ機能の完成
- [ ] TypeBasedSecurityEngineの実装完成
- [ ] ModularTestAnalyzerの実装
- [ ] FlowSensitiveAnalyzerの実装
- [ ] WorkerPoolの実際の並列処理実装

#### 3.3 簡素化ドメインルール実装
- [ ] src/domain/simple-rules.ts作成
- [ ] YAMLベースのルール定義サポート
- [ ] 必須テスト項目チェッカー実装
- [ ] シンプルなキーワードマッチング

#### 3.4 プラグインマネージャー簡素化
- [ ] サンドボックス機能の削除
- [ ] レガシープラグインサポートの削除
- [ ] シンプルなプラグイン実行機能

### フェーズ4: 統合とテスト（2週間: 2025-08-25 〜 2025-09-07）

#### 4.1 CLIの再構築
- [ ] 3つのコマンドに集約
  - [ ] rimor analyze <path>
  - [ ] rimor check <path>（セキュリティ）
  - [ ] rimor config
- [ ] DIコンテナからのサービス注入

#### 4.2 テスト作成
- [ ] src/container/のテスト
- [ ] src/core/engine.tsのテスト
- [ ] src/domain/simple-rules.tsのテスト
- [ ] 統合テストの作成

#### 4.3 ドキュメント更新
- [ ] README.mdの更新
- [ ] ユーザーガイドの簡素化
- [ ] APIドキュメントの更新
- [ ] CHANGELOG.mdの更新

#### 4.4 最終調整
- [ ] パフォーマンステスト（5ms/ファイル以下）
- [ ] メモリ使用量の最適化
- [ ] エラーハンドリングの改善
- [ ] 最終的なコードレビュー

## 成功指標
- [ ] ファイル数: 40%削減（現在の60%に）
- [ ] コード行数: 50%削減
- [ ] テスト実行時間: 30%短縮
- [ ] ビルド時間: 40%短縮
- [ ] 解析速度: 5ms/ファイル以下維持

## リスクと対策
1. **リスク**: 削除による機能喪失
   - **対策**: 各削除前にユーザーガイドで使用状況確認
2. **リスク**: v0.7.0機能の実装困難
   - **対策**: 最小限の実装から始め、段階的に機能追加
3. **リスク**: テストカバレッジの低下
   - **対策**: 新規テストを優先的に作成

## コミット規約
- フォーマット: `feat(v0.8.0): [Phase#] 具体的な変更内容`
- 例: `feat(v0.8.0): [Phase1] Remove complex dictionary system`
- 各タスク完了時に意味のある単位でコミット

#11