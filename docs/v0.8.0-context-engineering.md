# Rimor v0.8.0 - Context Engineering ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

Rimor v0.8.0ã§ã¯ã€[LangChain Blog - Context Engineering for Agents](https://blog.langchain.com/context-engineering-for-agents/)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹**Context Engineering**ã®åŸå‰‡ã‚’æ¡ç”¨ã—ã€AIå‘ã‘ã®æœ€é©åŒ–ã•ã‚ŒãŸå‡ºåŠ›ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

### Context Engineeringã¨ã¯

Context Engineeringã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æä¾›ã™ã‚‹æƒ…å ±ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã®ä½“ç³»çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚ä¸»ãªæˆ¦ç•¥ï¼š

1. **Write Context** - æ§‹é€ åŒ–ã•ã‚ŒãŸæƒ…å ±ã®è¨˜è¿°
2. **Select Context** - é–¢é€£æ€§ã®é«˜ã„æƒ…å ±ã®é¸æŠ
3. **Compress Context** - æƒ…å ±ã®åœ§ç¸®ã¨è¦ç´„
4. **Isolate Context** - æ–‡è„ˆã®åˆ†é›¢ã¨æ•´ç†

## æ–°æ©Ÿèƒ½

### 1. æ§‹é€ åŒ–ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### JSONã‚¹ã‚­ãƒ¼ãƒãƒ™ãƒ¼ã‚¹ã®æ±ºå®šè«–çš„å‡ºåŠ›

```typescript
// æ§‹é€ åŒ–ã•ã‚ŒãŸåˆ†æçµæœ
interface StructuredAnalysisResult {
  metadata: AnalysisMetadata;    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãªã©
  summary: AnalysisSummary;       // ç·åˆçš„ãªã‚µãƒãƒªãƒ¼
  issues: Issue[];                // æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ
  metrics: AnalysisMetrics;       // å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹
  plugins?: PluginResults;        // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè¡Œçµæœ
}
```

**åˆ©ç‚¹**ï¼š
- åŒã˜å…¥åŠ›ã«å¯¾ã—ã¦å¸¸ã«åŒã˜æ§‹é€ ã®å‡ºåŠ›ï¼ˆæ±ºå®šè«–çš„ï¼‰
- AIã«ã‚ˆã‚‹è§£æãŒå®¹æ˜“
- ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªå‡¦ç†ãŒå¯èƒ½

### 2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ã®è‡ªç„¶è¨€èªãƒ¬ãƒãƒ¼ãƒˆ

#### Handlebarsãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³

```handlebars
# Rimor åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**è§£æå¯¾è±¡**: `{{metadata.analyzedPath}}`  
**æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ**: {{summary.totalIssues}} ä»¶

{{#each (groupBySeverity issues)}}
### {{severityLabel @key}} ({{this.length}}ä»¶)
{{#each this}}
- {{this.type}}: {{this.message}}
{{/each}}
{{/each}}
```

**åˆ©ç‚¹**ï¼š
- äººé–“ãŒèª­ã¿ã‚„ã™ã„å½¢å¼
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### 3. ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ»ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¸ã®ç›´æ¥çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

```typescript
// RIMOR-CRITICAL: [critical] SQL_INJECTION - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§
const query = `SELECT * FROM users WHERE id = ${userId}`;

/**
 * RIMOR Security Analysis Report
 * 
 * Issue: XSS
 * Severity: high
 * 
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒé©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã¾ã›ã‚“
 * 
 * Recommendation:
 * HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
 */
res.send(`<h1>${userInput}</h1>`);
```

**åˆ©ç‚¹**ï¼š
- å•é¡Œç®‡æ‰€ã§ã®å³åº§ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®å‚ç…§ã—ã‚„ã™ã•
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®æ´»ç”¨

## CLIã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåˆ†æï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
rimor analyze ./src

# v0.8.0ã®æ–°ã—ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³
rimor analyze ./src --output-json report.json
rimor analyze ./src --output-markdown report.md
rimor analyze ./src --output-html report.html
```

### æ–°ã—ã„CLIã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ä¾‹ |
|-----------|------|-----|
| `--output-json <file>` | JSONå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ› | `--output-json analysis.json` |
| `--output-markdown <file>` | Markdownå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ› | `--output-markdown report.md` |
| `--output-html <file>` | HTMLå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ› | `--output-html report.html` |
| `--annotate` | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ  | `--annotate` |
| `--annotate-format` | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å½¢å¼ï¼ˆinline/blockï¼‰ | `--annotate-format=block` |
| `--annotate-output <dir>` | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ããƒ•ã‚¡ã‚¤ãƒ«ã®å‡ºåŠ›å…ˆ | `--annotate-output ./annotated` |
| `--preview` | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | `--annotate --preview` |
| `--include-details` | è©³ç´°æƒ…å ±ã‚’å«ã‚ã‚‹ | `--include-details` |
| `--include-recommendations` | æ”¹å–„ææ¡ˆã‚’å«ã‚ã‚‹ | `--include-recommendations` |
| `--severity` | é‡è¦åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿ | `--severity=critical,high` |

### ä½¿ç”¨ä¾‹

#### 1. è©³ç´°ãªMarkdownãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

```bash
rimor analyze ./src \
  --output-markdown detailed-report.md \
  --include-details \
  --include-recommendations
```

#### 2. CI/CDç”¨ã®JSONå‡ºåŠ›

```bash
rimor analyze ./src \
  --output-json ci-results.json \
  --severity=critical,high
```

#### 3. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ç¢ºèª
rimor analyze ./src --annotate --preview

# å®Ÿéš›ã«ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
rimor analyze ./src \
  --annotate \
  --annotate-format=block \
  --annotate-output ./reviewed
```

#### 4. è¤‡æ•°å½¢å¼ã§ã®å‡ºåŠ›

```bash
rimor analyze ./src \
  --output-json results.json \
  --output-markdown report.md \
  --output-html report.html
```

## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### JSONå‡ºåŠ›

```json
{
  "metadata": {
    "version": "0.8.0",
    "timestamp": "2024-01-15T10:00:00.000Z",
    "analyzedPath": "/project/src",
    "duration": 2500
  },
  "summary": {
    "totalFiles": 50,
    "totalIssues": 10,
    "issueBySeverity": {
      "critical": 2,
      "high": 3,
      "medium": 3,
      "low": 2,
      "info": 0
    }
  },
  "issues": [
    {
      "id": "abc123",
      "type": "SQL_INJECTION",
      "severity": "critical",
      "location": {
        "file": "src/db.ts",
        "startLine": 45,
        "endLine": 45
      },
      "message": "SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§",
      "recommendation": "ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨"
    }
  ]
}
```

### Markdownãƒ¬ãƒãƒ¼ãƒˆ

```markdown
# Rimor åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**è§£æå¯¾è±¡**: `/project/src`  
**å®Ÿè¡Œæ—¥æ™‚**: 2024/01/15 19:00:00  
**Rimorãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.8.0  

## ğŸ“Š ã‚µãƒãƒªãƒ¼

- **è§£æãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 50 ãƒ•ã‚¡ã‚¤ãƒ«
- **æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ**: 10 ä»¶

### é‡è¦åº¦åˆ¥ã®å•é¡Œæ•°

- ğŸ”´ **Critical**: 2 ä»¶
- ğŸŸ  **High**: 3 ä»¶
- ğŸŸ¡ **Medium**: 3 ä»¶
- ğŸŸ¢ **Low**: 2 ä»¶
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
src/reporting/
â”œâ”€â”€ StructuredReporter.ts      # æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿å¤‰æ›
â”œâ”€â”€ TemplatedReporter.ts       # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ™ãƒ¼ã‚¹ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”œâ”€â”€ AnnotationGenerator.ts     # ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
â”œâ”€â”€ CodeAnnotator.ts          # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ schema.json               # JSONã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”œâ”€â”€ templates/                # Handlebarsãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ summary.md.hbs       # ã‚µãƒãƒªãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â””â”€â”€ detailed.md.hbs      # è©³ç´°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ types.ts                 # å‹å®šç¾©
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
AnalysisResult
    â†“
StructuredReporter (æ§‹é€ åŒ–)
    â†“
StructuredAnalysisResult (å˜ä¸€ã®çœŸå®Ÿã®æº)
    â†“
    â”œâ”€â†’ JSONå‡ºåŠ›
    â”œâ”€â†’ TemplatedReporter â†’ Markdown/HTML
    â””â”€â†’ AnnotationGenerator â†’ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ³¨é‡ˆ
```

## AIã¨ã®çµ±åˆ

### æœ€é©åŒ–ã•ã‚ŒãŸå‡ºåŠ›

Context Engineeringã®åŸå‰‡ã«åŸºã¥ãã€ä»¥ä¸‹ã®æœ€é©åŒ–ã‚’å®Ÿæ–½ï¼š

1. **æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿**: JSONã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹ä¸€è²«ã—ãŸæ§‹é€ 
2. **æ–‡è„ˆã®åœ§ç¸®**: é‡è¦åº¦ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
3. **é–¢é€£æ€§ã®é¸æŠ**: ç‰¹å®šã®å•é¡Œã‚¿ã‚¤ãƒ—ã®ã¿æŠ½å‡º
4. **æ±ºå®šè«–çš„å‡ºåŠ›**: åŒã˜å…¥åŠ›â†’åŒã˜å‡ºåŠ›

### AIå‘ã‘ã®ä½¿ç”¨ä¾‹

```bash
# AIåˆ†æç”¨ã®æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
rimor analyze ./src \
  --output-json ai-input.json \
  --severity=critical,high \
  --include-details

# AIç”¨ã®è¦ç´„ãƒ¬ãƒãƒ¼ãƒˆ
rimor analyze ./src \
  --output-markdown ai-summary.md \
  --severity=critical
```

## ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ç‹¬è‡ªã®Handlebarsãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨å¯èƒ½ï¼š

```typescript
const reporter = container.get<IReporter>(TYPES.Reporter);
const result = await reporter.generateAnalysisReport(analysisResult, {
  format: ReportFormat.MARKDOWN,
  customTemplate: './my-template.hbs'
});
```

### ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªä½¿ç”¨

```typescript
import { container, TYPES } from 'rimor';

// DIã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å–å¾—
const analysisEngine = container.get<IAnalysisEngine>(TYPES.AnalysisEngine);
const reporter = container.get<IReporter>(TYPES.Reporter);

// åˆ†æå®Ÿè¡Œ
const result = await analysisEngine.analyze('./src');

// è¤‡æ•°å½¢å¼ã§å‡ºåŠ›
await reporter.generateAnalysisReport(result, {
  format: ReportFormat.JSON,
  outputPath: 'report.json'
});

await reporter.generateAnalysisReport(result, {
  format: ReportFormat.MARKDOWN,
  outputPath: 'report.md',
  includeDetails: true
});
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. CI/CDã§ã®æ´»ç”¨

```yaml
# GitHub Actionsä¾‹
- name: Run Rimor Analysis
  run: |
    npx rimor analyze ./src \
      --output-json ${{ runner.temp }}/rimor-results.json \
      --severity=critical,high
    
- name: Check Critical Issues
  run: |
    CRITICAL=$(jq '.summary.issueBySeverity.critical' ${{ runner.temp }}/rimor-results.json)
    if [ "$CRITICAL" -gt 0 ]; then
      echo "Critical issues found!"
      exit 1
    fi
```

### 2. ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã®æ´»ç”¨

```bash
# ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚
rimor analyze feature-branch \
  --annotate \
  --annotate-format=block \
  --include-recommendations
```

### 3. å®šæœŸçš„ãªå“è³ªç›£æŸ»

```bash
# é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
rimor analyze ./src \
  --output-markdown weekly-report-$(date +%Y%m%d).md \
  --include-details \
  --include-recommendations
```

## ã¾ã¨ã‚

Rimor v0.8.0ã®Context Engineeringå®Ÿè£…ã«ã‚ˆã‚Šï¼š

- **AIå‘ã‘æœ€é©åŒ–**: æ§‹é€ åŒ–ã•ã‚ŒãŸæ±ºå®šè«–çš„å‡ºåŠ›
- **äººé–“å‘ã‘æœ€é©åŒ–**: èª­ã¿ã‚„ã™ã„Markdown/HTMLãƒ¬ãƒãƒ¼ãƒˆ
- **é–‹ç™ºè€…å‘ã‘æœ€é©åŒ–**: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- **æŸ”è»Ÿãªçµ±åˆ**: è¤‡æ•°ã®å‡ºåŠ›å½¢å¼ã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚ªãƒ—ã‚·ãƒ§ãƒ³

ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€AIãƒ„ãƒ¼ãƒ«ã¨ã®çµ±åˆã€å“è³ªç®¡ç†ãƒ—ãƒ­ã‚»ã‚¹ã®è‡ªå‹•åŒ–ã€é–‹ç™ºè€…ã¸ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒå¤§å¹…ã«æ”¹å–„ã•ã‚Œã¾ã™ã€‚