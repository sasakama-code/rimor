435ce3b61e9500fd336cad24e357c535
"use strict";
/**
 * NamingAnalyzer
 * Issue #65: 命名規則分析専用モジュール
 *
 * SOLID原則: 単一責任（命名規則分析のみ）
 * DRY原則: パターンマッチングロジックの共通化
 * KISS原則: シンプルな正規表現ベースの分析
 * YAGNI原則: 必要最小限の機能実装
 * Defensive Programming: 入力検証とエラーハンドリング
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.NamingAnalyzer = void 0;
const fs = __importStar(require("fs"));
const glob = __importStar(require("glob"));
const path = __importStar(require("path"));
/**
 * 命名規則を分析する専用クラス
 */
class NamingAnalyzer {
    /**
     * プロジェクト全体の命名規則を分析
     */
    async analyzeNamingConventions(projectPath) {
        const files = this.getAllFiles(projectPath);
        const codeContents = await this.readAllCodeFiles(files);
        const fileNames = files.map(f => path.basename(f));
        // ファイル名の分析
        const filePattern = this.analyzeFileNaming(fileNames);
        // 変数名の分析
        const variablePatterns = this.analyzeVariableNaming(codeContents);
        const variablePattern = this.getDominantPattern(variablePatterns);
        // 関数名の分析
        const functionPatterns = this.analyzeFunctionNaming(codeContents);
        const functionPattern = this.getDominantPattern(functionPatterns);
        // クラス名の分析
        const classPatterns = this.analyzeClassNaming(codeContents);
        const classPattern = this.getDominantPattern(classPatterns.patterns);
        // ディレクトリ名の分析（簡易実装）
        const dirPattern = 'kebab-case';
        return {
            files: {
                pattern: filePattern,
                confidence: 0.8,
                examples: fileNames.slice(0, 3),
                violations: []
            },
            directories: {
                pattern: dirPattern,
                confidence: 0.7,
                examples: ['src', 'test', 'lib'],
                violations: []
            },
            variables: {
                pattern: variablePattern,
                confidence: 0.85,
                examples: variablePatterns[variablePattern]?.slice(0, 3) || [],
                violations: []
            },
            functions: {
                pattern: functionPattern,
                confidence: 0.85,
                examples: functionPatterns[functionPattern]?.slice(0, 3) || [],
                violations: []
            },
            classes: {
                pattern: classPattern,
                confidence: 0.9,
                examples: classPatterns.patterns[classPattern]?.slice(0, 3) || [],
                violations: []
            }
        };
    }
    /**
     * ファイル名の命名パターンを分析
     */
    analyzeFileNaming(fileNames) {
        const patterns = {
            camelCase: fileNames.filter(name => /^[a-z][a-zA-Z0-9]*\.[a-z]+$/.test(name)),
            PascalCase: fileNames.filter(name => /^[A-Z][a-zA-Z0-9]*\.[a-z]+$/.test(name)),
            snake_case: fileNames.filter(name => /^[a-z][a-z0-9_]*\.[a-z]+$/.test(name)),
            'kebab-case': fileNames.filter(name => /^[a-z][a-z0-9-]*\.[a-z]+$/.test(name)),
            SCREAMING_SNAKE_CASE: fileNames.filter(name => /^[A-Z][A-Z0-9_]*\.[a-z]+$/.test(name))
        };
        return this.getDominantPattern(patterns);
    }
    /**
     * 変数名の命名パターンを分析
     */
    analyzeVariableNaming(code) {
        const patterns = {
            camelCase: [],
            PascalCase: [],
            snake_case: [],
            'kebab-case': [],
            SCREAMING_SNAKE_CASE: []
        };
        // const/let/var 変数宣言を抽出
        const variableRegex = /(?:const|let|var)\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g;
        let match;
        while ((match = variableRegex.exec(code)) !== null) {
            const varName = match[1];
            if (/^[a-z][a-zA-Z0-9]*$/.test(varName)) {
                patterns.camelCase.push(varName);
            }
            else if (/^[A-Z][a-zA-Z0-9]*$/.test(varName)) {
                patterns.PascalCase.push(varName);
            }
            else if (/^[a-z][a-z0-9_]*$/.test(varName)) {
                patterns.snake_case.push(varName);
            }
            else if (/^[A-Z][A-Z0-9_]*$/.test(varName) && varName.includes('_')) {
                patterns.SCREAMING_SNAKE_CASE.push(varName);
            }
        }
        return patterns;
    }
    /**
     * 関数名の命名パターンを分析
     */
    analyzeFunctionNaming(code) {
        const patterns = {
            camelCase: [],
            PascalCase: [],
            snake_case: [],
            'kebab-case': [],
            SCREAMING_SNAKE_CASE: []
        };
        // function宣言とアロー関数を抽出
        const functionRegex = /(?:function\s+([a-zA-Z_$][a-zA-Z0-9_$]*)|const\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*(?:\([^)]*\)|[a-zA-Z_$][a-zA-Z0-9_$]*)\s*=>)/g;
        let match;
        while ((match = functionRegex.exec(code)) !== null) {
            const funcName = match[1] || match[2];
            if (/^[a-z][a-zA-Z0-9]*$/.test(funcName)) {
                patterns.camelCase.push(funcName);
            }
            else if (/^[A-Z][a-zA-Z0-9]*$/.test(funcName)) {
                patterns.PascalCase.push(funcName);
            }
            else if (/^[a-z][a-z0-9_]*$/.test(funcName)) {
                patterns.snake_case.push(funcName);
            }
            else if (/^[A-Z][A-Z0-9_]*$/.test(funcName)) {
                patterns.SCREAMING_SNAKE_CASE.push(funcName);
            }
        }
        return patterns;
    }
    /**
     * クラス名の命名パターンを分析
     */
    analyzeClassNaming(code) {
        const patterns = {
            camelCase: [],
            PascalCase: [],
            snake_case: [],
            'kebab-case': [],
            SCREAMING_SNAKE_CASE: []
        };
        const interfaces = [];
        const types = [];
        // クラス宣言を抽出
        const classRegex = /class\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g;
        let match;
        while ((match = classRegex.exec(code)) !== null) {
            const className = match[1];
            if (/^[a-z][a-zA-Z0-9]*$/.test(className)) {
                patterns.camelCase.push(className);
            }
            else if (/^[A-Z][a-zA-Z0-9]*$/.test(className)) {
                patterns.PascalCase.push(className);
            }
            else if (/^[a-z][a-z0-9_]*$/.test(className)) {
                patterns.snake_case.push(className);
            }
        }
        // インターフェース宣言を抽出
        const interfaceRegex = /interface\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g;
        while ((match = interfaceRegex.exec(code)) !== null) {
            interfaces.push(match[1]);
        }
        // 型エイリアス宣言を抽出
        const typeRegex = /type\s+([a-zA-Z_$][a-zA-Z0-9_$]*)/g;
        while ((match = typeRegex.exec(code)) !== null) {
            types.push(match[1]);
        }
        return { patterns, interfaces, types };
    }
    /**
     * 最も使用頻度の高いパターンを特定
     */
    getDominantPattern(patterns) {
        let maxCount = 0;
        let dominantPattern = 'mixed';
        let tieCount = 0;
        for (const [pattern, items] of Object.entries(patterns)) {
            if (items.length > maxCount) {
                maxCount = items.length;
                dominantPattern = pattern;
                tieCount = 1;
            }
            else if (items.length === maxCount && items.length > 0) {
                tieCount++;
            }
        }
        // 同数の場合はmixedを返す
        if (tieCount > 1) {
            return 'mixed';
        }
        return dominantPattern;
    }
    /**
     * 命名規則の総合レポートを生成
     */
    generateNamingReport(conventions) {
        const lines = [
            '=== Naming Conventions Analysis ===',
            '',
            `Files: ${conventions.files.pattern} (${Math.round(conventions.files.confidence * 100)}% confidence)`,
            `Directories: ${conventions.directories.pattern} (${Math.round(conventions.directories.confidence * 100)}% confidence)`,
            `Variables: ${conventions.variables.pattern} (${Math.round(conventions.variables.confidence * 100)}% confidence)`,
            `Functions: ${conventions.functions.pattern} (${Math.round(conventions.functions.confidence * 100)}% confidence)`,
            `Classes: ${conventions.classes.pattern} (${Math.round(conventions.classes.confidence * 100)}% confidence)`,
            '',
            `Overall Consistency: ${Math.round(this.calculateOverallConsistency(conventions) * 100)}%`,
            ''
        ];
        // 例を追加
        if (conventions.files.examples.length > 0) {
            lines.push('File Examples:');
            conventions.files.examples.forEach(ex => lines.push(`  - ${ex}`));
            lines.push('');
        }
        return lines.join('\n');
    }
    /**
     * 全体的な一貫性を計算
     */
    calculateOverallConsistency(conventions) {
        const confidences = [
            conventions.files.confidence,
            conventions.directories.confidence,
            conventions.variables.confidence,
            conventions.functions.confidence,
            conventions.classes.confidence
        ];
        return confidences.reduce((sum, conf) => sum + conf, 0) / confidences.length;
    }
    /**
     * すべてのコードファイルを取得
     */
    getAllFiles(projectPath) {
        const pattern = path.join(projectPath, '**/*.{js,jsx,ts,tsx}');
        return glob.sync(pattern, {
            ignore: ['**/node_modules/**', '**/dist/**', '**/build/**']
        });
    }
    /**
     * すべてのコードファイルを読み込み
     */
    async readAllCodeFiles(files) {
        const contents = [];
        for (const file of files) {
            try {
                const content = fs.readFileSync(file, 'utf-8');
                contents.push(content);
            }
            catch (error) {
                // ファイル読み込みエラーは無視
            }
        }
        return contents.join('\n');
    }
    /**
     * 一貫性スコアを計算
     */
    calculateConsistency(patterns) {
        const validPatterns = patterns.filter(p => p && p !== 'mixed');
        if (validPatterns.length === 0)
            return 0;
        const patternCounts = new Map();
        validPatterns.forEach(pattern => {
            if (pattern) {
                patternCounts.set(pattern, (patternCounts.get(pattern) || 0) + 1);
            }
        });
        const maxCount = Math.max(...patternCounts.values());
        return maxCount / validPatterns.length;
    }
}
exports.NamingAnalyzer = NamingAnalyzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9hbmFseXplcnMvc3RydWN0dXJlLWFuYWx5c2lzL25hbWluZy1hbmFseXplci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7OztHQVNHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXSCx1Q0FBeUI7QUFDekIsMkNBQTZCO0FBQzdCLDJDQUE2QjtBQUU3Qjs7R0FFRztBQUNILE1BQWEsY0FBYztJQUN6Qjs7T0FFRztJQUNILEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxXQUFtQjtRQUNoRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sWUFBWSxHQUFHLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hELE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbkQsV0FBVztRQUNYLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUV0RCxTQUFTO1FBQ1QsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDbEUsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFbEUsU0FBUztRQUNULE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRWxFLFVBQVU7UUFDVixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDNUQsTUFBTSxZQUFZ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LENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxPQUFPLENBQUMsQ0FBQztRQUMvRCxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRXpDLE1BQU0sYUFBYSxHQUFHLElBQUksR0FBRyxFQUFrQixDQUFDO1FBQ2hELGFBQWEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDWixhQUFhLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDcEUsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELE9BQU8sUUFBUSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUM7SUFDekMsQ0FBQztDQUVGO0FBalRELHdDQWlUQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc2FzYWthbWEvUHJvamVjdHMvUmltb3Ivc3JjL2FuYWx5emVycy9zdHJ1Y3R1cmUtYW5hbHlzaXMvbmFtaW5nLWFuYWx5emVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTmFtaW5nQW5hbHl6ZXJcbiAqIElzc3VlICM2NTog5ZG95ZCN6KaP5YmH5YiG5p6Q5bCC55So44Oi44K444Ol44O844OrXG4gKiBcbiAqIFNPTElE5Y6f5YmHOiDljZjkuIDosqzku7vvvIjlkb3lkI3opo/liYfliIbmnpDjga7jgb/vvIlcbiAqIERSWeWOn+WJhzog44OR44K/44O844Oz44Oe44OD44OB44Oz44Kw44Ot44K444OD44Kv44Gu5YWx6YCa5YyWXG4gKiBLSVNT5Y6f5YmHOiDjgrfjg7Pjg5fjg6vjgarmraPopo/ooajnj77jg5njg7zjgrnjga7liIbmnpBcbiAqIFlBR05J5Y6f5YmHOiDlv4XopoHmnIDlsI/pmZDjga7mqZ/og73lrp/oo4VcbiAqIERlZmVuc2l2ZSBQcm9ncmFtbWluZzog5YWl5Yqb5qSc6Ki844Go44Ko44Op44O844OP44Oz44OJ44Oq44Oz44KwXG4gKi9cblxuaW1wb3J0IHsgXG4gIE5hbWluZ0NvbnZlbnRpb25zLCBcbiAgTmFtaW5nUGF0dGVybixcbiAgRmlsZU5hbWluZ0NvbnZlbnRpb24sXG4gIERpcmVjdG9yeU5hbWluZ0NvbnZlbnRpb24sXG4gIFZhcmlhYmxlTmFtaW5nQ29udmVudGlvbixcbiAgRnVuY3Rpb25OYW1pbmdDb252ZW50aW9uLFxuICBDbGFzc05hbWluZ0NvbnZlbnRpb25cbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgZ2xvYiBmcm9tICdnbG9iJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbi8qKlxuICog5ZG95ZCN6KaP5YmH44KS5YiG5p6Q44GZ44KL5bCC55So44Kv44Op44K5XG4gKi9cbmV4cG9ydCBjbGFzcyBOYW1pbmdBbmFseXplciB7XG4gIC8qKlxuICAgKiDjg5fjg63jgrjjgqfjgq/jg4jlhajkvZPjga7lkb3lkI3opo/liYfjgpLliIbmnpBcbiAgICovXG4gIGFzeW5jIGFuYWx5emVOYW1pbmdDb252ZW50aW9ucyhwcm9qZWN0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxOYW1pbmdDb252ZW50aW9ucz4ge1xuICAgIGNvbnN0IGZpbGVzID0gdGhpcy5nZXRBbGxGaWxlcyhwcm9qZWN0UGF0aCk7XG4gICAgY29uc3QgY29kZUNvbnRlbnRzID0gYXdhaXQgdGhpcy5yZWFkQWxsQ29kZUZpbGVzKGZpbGVzKTtcbiAgICBjb25zdCBmaWxlTmFtZXMgPSBmaWxlcy5tYXAoZiA9PiBwYXRoLmJhc2VuYW1lKGYpKTtcbiAgICBcbiAgICAvLyDjg5XjgqHjgqTjg6vlkI3jga7liIbmnpBcbiAgICBjb25zdCBmaWxlUGF0dGVybiA9IHRoaXMuYW5hbHl6ZUZpbGVOYW1pbmcoZmlsZU5hbWVzKTtcbiAgICBcbiAgICAvLyDlpInmlbDlkI3jga7liIbmnpBcbiAgICBjb25zdCB2YXJpYWJsZVBhdHRlcm5zID0gdGhpcy5hbmFseXplVmFyaWFibGVOYW1pbmcoY29kZUNvbnRlbnRzKTtcbiAgICBjb25zdCB2YXJpYWJsZVBhdHRlcm4gPSB0aGlzLmdldERvbWluYW50UGF0dGVybih2YXJpYWJsZVBhdHRlcm5zKTtcbiAgICBcbiAgICAvLyDplqLmlbDlkI3jga7liIbmnpBcbiAgICBjb25zdCBmdW5jdGlvblBhdHRlcm5zID0gdGhpcy5hbmFseXplRnVuY3Rpb25OYW1pbmcoY29kZUNvbnRlbnRzKTtcbiAgICBjb25zdCBmdW5jdGlvblBhdHRlcm4gPSB0aGlzLmdldERvbWluYW50UGF0dGVybihmdW5jdGlvblBhdHRlcm5zKTtcbiAgICBcbiAgICAvLyDjgq/jg6njgrnlkI3jga7liIbmnpBcbiAgICBjb25zdCBjbGFzc1BhdHRlcm5zID0gdGhpcy5hbmFseXplQ2xhc3NOYW1pbmcoY29kZUNvbnRlbnRzKTtcbiAgICBjb25zdCBjbGFzc1BhdHRlcm4gPSB0aGlzLmdldERvbWluYW50UGF0dGVybihjbGFzc1BhdHRlcm5zLnBhdHRlcm5zKTtcbiAgICBcbiAgICAvLyDjg4fjgqPjg6zjgq/jg4jjg6rlkI3jga7liIbmnpDvvIjnsKHmmJPlrp/oo4XvvIlcbiAgICBjb25zdCBkaXJQYXR0ZXJuID0gJ2tlYmFiLWNhc2UnIGFzIE5hbWluZ1BhdHRlcm47XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpbGVzOiB7XG4gICAgICAgIHBhdHRlcm46IGZpbGVQYXR0ZXJuLFxuICAgICAgICBjb25maWRlbmNlOiAwLjgsXG4gICAgICAgIGV4YW1wbGVzOiBmaWxlTmFtZXMuc2xpY2UoMCwgMyksXG4gICAgICAgIHZpb2xhdGlvbnM6IFtdXG4gICAgICB9LFxuICAgICAgZGlyZWN0b3JpZXM6IHtcbiAgICAgICAgcGF0dGVybjogZGlyUGF0dGVybixcbiAgICAgICAgY29uZmlkZW5jZTogMC43LFxuICAgICAgICBleGFtcGxlczogWydzcmMnLCAndGVzdCcsICdsaWInXSxcbiAgICAgICAgdmlvbGF0aW9uczogW11cbiAgICAgIH0sXG4gICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgcGF0dGVybjogdmFyaWFibGVQYXR0ZXJuLFxuICAgICAgICBjb25maWRlbmNlOiAwLjg1LFxuICAgICAgICBleGFtcGxlczogdmFyaWFibGVQYXR0ZXJuc1t2YXJpYWJsZVBhdHRlcm5dPy5zbGljZSgwLCAzKSB8fCBbXSxcbiAgICAgICAgdmlvbGF0aW9uczogW11cbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbnM6IHtcbiAgICAgICAgcGF0dGVybjogZnVuY3Rpb25QYXR0ZXJuLFxuICAgICAgICBjb25maWRlbmNlOiAwLjg1LFxuICAgICAgICBleGFtcGxlczogZnVuY3Rpb25QYXR0ZXJuc1tmdW5jdGlvblBhdHRlcm5dPy5zbGljZSgwLCAzKSB8fCBbXSxcbiAgICAgICAgdmlvbGF0aW9uczogW11cbiAgICAgIH0sXG4gICAgICBjbGFzc2VzOiB7XG4gICAgICAgIHBhdHRlcm46IGNsYXNzUGF0dGVybixcbiAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICBleGFtcGxlczogY2xhc3NQYXR0ZXJucy5wYXR0ZXJuc1tjbGFzc1BhdHRlcm5dPy5zbGljZSgwLCAzKSB8fCBbXSxcbiAgICAgICAgdmlvbGF0aW9uczogW11cbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIFxuICAvKipcbiAgICog44OV44Kh44Kk44Or5ZCN44Gu5ZG95ZCN44OR44K/44O844Oz44KS5YiG5p6QXG4gICAqL1xuICBhbmFseXplRmlsZU5hbWluZyhmaWxlTmFtZXM6IHN0cmluZ1tdKTogTmFtaW5nUGF0dGVybiB7XG4gICAgY29uc3QgcGF0dGVybnMgPSB7XG4gICAgICBjYW1lbENhc2U6IGZpbGVOYW1lcy5maWx0ZXIobmFtZSA9PiAvXlthLXpdW2EtekEtWjAtOV0qXFwuW2Etel0rJC8udGVzdChuYW1lKSksXG4gICAgICBQYXNjYWxDYXNlOiBmaWxlTmFtZXMuZmlsdGVyKG5hbWUgPT4gL15bQS1aXVthLXpBLVowLTldKlxcLlthLXpdKyQvLnRlc3QobmFtZSkpLFxuICAgICAgc25ha2VfY2FzZTogZmlsZU5hbWVzLmZpbHRlcihuYW1lID0+IC9eW2Etel1bYS16MC05X10qXFwuW2Etel0rJC8udGVzdChuYW1lKSksXG4gICAgICAna2ViYWItY2FzZSc6IGZpbGVOYW1lcy5maWx0ZXIobmFtZSA9PiAvXlthLXpdW2EtejAtOS1dKlxcLlthLXpdKyQvLnRlc3QobmFtZSkpLFxuICAgICAgU0NSRUFNSU5HX1NOQUtFX0NBU0U6IGZpbGVOYW1lcy5maWx0ZXIobmFtZSA9PiAvXltBLVpdW0EtWjAtOV9dKlxcLlthLXpdKyQvLnRlc3QobmFtZSkpXG4gICAgfTtcbiAgICBcbiAgICByZXR1cm4gdGhpcy5nZXREb21pbmFudFBhdHRlcm4ocGF0dGVybnMpO1xuICB9XG4gIFxuICAvKipcbiAgICog5aSJ5pWw5ZCN44Gu5ZG95ZCN44OR44K/44O844Oz44KS5YiG5p6QXG4gICAqL1xuICBhbmFseXplVmFyaWFibGVOYW1pbmcoY29kZTogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+IHtcbiAgICBjb25zdCBwYXR0ZXJuczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgY2FtZWxDYXNlOiBbXSxcbiAgICAgIFBhc2NhbENhc2U6IFtdLFxuICAgICAgc25ha2VfY2FzZTogW10sXG4gICAgICAna2ViYWItY2FzZSc6IFtdLFxuICAgICAgU0NSRUFNSU5HX1NOQUtFX0NBU0U6IFtdXG4gICAgfTtcbiAgICBcbiAgICAvLyBjb25zdC9sZXQvdmFyIOWkieaVsOWuo+iogOOCkuaKveWHulxuICAgIGNvbnN0IHZhcmlhYmxlUmVnZXggPSAvKD86Y29uc3R8bGV0fHZhcilcXHMrKFthLXpBLVpfJF1bYS16QS1aMC05XyRdKikvZztcbiAgICBsZXQgbWF0Y2g7XG4gICAgXG4gICAgd2hpbGUgKChtYXRjaCA9IHZhcmlhYmxlUmVnZXguZXhlYyhjb2RlKSkgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHZhck5hbWUgPSBtYXRjaFsxXTtcbiAgICAgIFxuICAgICAgaWYgKC9eW2Etel1bYS16QS1aMC05XSokLy50ZXN0KHZhck5hbWUpKSB7XG4gICAgICAgIHBhdHRlcm5zLmNhbWVsQ2FzZS5wdXNoKHZhck5hbWUpO1xuICAgICAgfSBlbHNlIGlmICgvXltBLVpdW2EtekEtWjAtOV0qJC8udGVzdCh2YXJOYW1lKSkge1xuICAgICAgICBwYXR0ZXJucy5QYXNjYWxDYXNlLnB1c2godmFyTmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKC9eW2Etel1bYS16MC05X10qJC8udGVzdCh2YXJOYW1lKSkge1xuICAgICAgICBwYXR0ZXJucy5zbmFrZV9jYXNlLnB1c2godmFyTmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKC9eW0EtWl1bQS1aMC05X10qJC8udGVzdCh2YXJOYW1lKSAmJiB2YXJOYW1lLmluY2x1ZGVzKCdfJykpIHtcbiAgICAgICAgcGF0dGVybnMuU0NSRUFNSU5HX1NOQUtFX0NBU0UucHVzaCh2YXJOYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHBhdHRlcm5zO1xuICB9XG4gIFxuICAvKipcbiAgICog6Zai5pWw5ZCN44Gu5ZG95ZCN44OR44K/44O844Oz44KS5YiG5p6QXG4gICAqL1xuICBhbmFseXplRnVuY3Rpb25OYW1pbmcoY29kZTogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+IHtcbiAgICBjb25zdCBwYXR0ZXJuczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgY2FtZWxDYXNlOiBbXSxcbiAgICAgIFBhc2NhbENhc2U6IFtdLFxuICAgICAgc25ha2VfY2FzZTogW10sXG4gICAgICAna2ViYWItY2FzZSc6IFtdLFxuICAgICAgU0NSRUFNSU5HX1NOQUtFX0NBU0U6IFtdXG4gICAgfTtcbiAgICBcbiAgICAvLyBmdW5jdGlvbuWuo+iogOOBqOOCouODreODvOmWouaVsOOCkuaKveWHulxuICAgIGNvbnN0IGZ1bmN0aW9uUmVnZXggPSAvKD86ZnVuY3Rpb25cXHMrKFthLXpBLVpfJF1bYS16QS1aMC05XyRdKil8Y29uc3RcXHMrKFthLXpBLVpfJF1bYS16QS1aMC05XyRdKilcXHMqPVxccyooPzpcXChbXildKlxcKXxbYS16QS1aXyRdW2EtekEtWjAtOV8kXSopXFxzKj0+KS9nO1xuICAgIGxldCBtYXRjaDtcbiAgICBcbiAgICB3aGlsZSAoKG1hdGNoID0gZnVuY3Rpb25SZWdleC5leGVjKGNvZGUpKSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgZnVuY05hbWUgPSBtYXRjaFsxXSB8fCBtYXRjaFsyXTtcbiAgICAgIFxuICAgICAgaWYgKC9eW2Etel1bYS16QS1aMC05XSokLy50ZXN0KGZ1bmNOYW1lKSkge1xuICAgICAgICBwYXR0ZXJucy5jYW1lbENhc2UucHVzaChmdW5jTmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKC9eW0EtWl1bYS16QS1aMC05XSokLy50ZXN0KGZ1bmNOYW1lKSkge1xuICAgICAgICBwYXR0ZXJucy5QYXNjYWxDYXNlLnB1c2goZnVuY05hbWUpO1xuICAgICAgfSBlbHNlIGlmICgvXlthLXpdW2EtejAtOV9dKiQvLnRlc3QoZnVuY05hbWUpKSB7XG4gICAgICAgIHBhdHRlcm5zLnNuYWtlX2Nhc2UucHVzaChmdW5jTmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKC9eW0EtWl1bQS1aMC05X10qJC8udGVzdChmdW5jTmFtZSkpIHtcbiAgICAgICAgcGF0dGVybnMuU0NSRUFNSU5HX1NOQUtFX0NBU0UucHVzaChmdW5jTmFtZSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBwYXR0ZXJucztcbiAgfVxuICBcbiAgLyoqXG4gICAqIOOCr+ODqeOCueWQjeOBruWRveWQjeODkeOCv+ODvOODs+OCkuWIhuaekFxuICAgKi9cbiAgYW5hbHl6ZUNsYXNzTmFtaW5nKGNvZGU6IHN0cmluZyk6IHtcbiAgICBwYXR0ZXJuczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+O1xuICAgIGludGVyZmFjZXM6IHN0cmluZ1tdO1xuICAgIHR5cGVzOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgY29uc3QgcGF0dGVybnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAgIGNhbWVsQ2FzZTogW10sXG4gICAgICBQYXNjYWxDYXNlOiBbXSxcbiAgICAgIHNuYWtlX2Nhc2U6IFtdLFxuICAgICAgJ2tlYmFiLWNhc2UnOiBbXSxcbiAgICAgIFNDUkVBTUlOR19TTkFLRV9DQVNFOiBbXVxuICAgIH07XG4gICAgY29uc3QgaW50ZXJmYWNlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB0eXBlczogc3RyaW5nW10gPSBbXTtcbiAgICBcbiAgICAvLyDjgq/jg6njgrnlrqPoqIDjgpLmir3lh7pcbiAgICBjb25zdCBjbGFzc1JlZ2V4ID0gL2NsYXNzXFxzKyhbYS16QS1aXyRdW2EtekEtWjAtOV8kXSopL2c7XG4gICAgbGV0IG1hdGNoO1xuICAgIFxuICAgIHdoaWxlICgobWF0Y2ggPSBjbGFzc1JlZ2V4LmV4ZWMoY29kZSkpICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBjbGFzc05hbWUgPSBtYXRjaFsxXTtcbiAgICAgIFxuICAgICAgaWYgKC9eW2Etel1bYS16QS1aMC05XSokLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgcGF0dGVybnMuY2FtZWxDYXNlLnB1c2goY2xhc3NOYW1lKTtcbiAgICAgIH0gZWxzZSBpZiAoL15bQS1aXVthLXpBLVowLTldKiQvLnRlc3QoY2xhc3NOYW1lKSkge1xuICAgICAgICBwYXR0ZXJucy5QYXNjYWxDYXNlLnB1c2goY2xhc3NOYW1lKTtcbiAgICAgIH0gZWxzZSBpZiAoL15bYS16XVthLXowLTlfXSokLy50ZXN0KGNsYXNzTmFtZSkpIHtcbiAgICAgICAgcGF0dGVybnMuc25ha2VfY2FzZS5wdXNoKGNsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIOOCpOODs+OCv+ODvOODleOCp+ODvOOCueWuo+iogOOCkuaKveWHulxuICAgIGNvbnN0IGludGVyZmFjZVJlZ2V4ID0gL2ludGVyZmFjZVxccysoW2EtekEtWl8kXVthLXpBLVowLTlfJF0qKS9nO1xuICAgIHdoaWxlICgobWF0Y2ggPSBpbnRlcmZhY2VSZWdleC5leGVjKGNvZGUpKSAhPT0gbnVsbCkge1xuICAgICAgaW50ZXJmYWNlcy5wdXNoKG1hdGNoWzFdKTtcbiAgICB9XG4gICAgXG4gICAgLy8g5Z6L44Ko44Kk44Oq44Ki44K55a6j6KiA44KS5oq95Ye6XG4gICAgY29uc3QgdHlwZVJlZ2V4ID0gL3R5cGVcXHMrKFthLXpBLVpfJF1bYS16QS1aMC05XyRdKikvZztcbiAgICB3aGlsZSAoKG1hdGNoID0gdHlwZVJlZ2V4LmV4ZWMoY29kZSkpICE9PSBudWxsKSB7XG4gICAgICB0eXBlcy5wdXNoKG1hdGNoWzFdKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgcGF0dGVybnMsIGludGVyZmFjZXMsIHR5cGVzIH07XG4gIH1cbiAgXG4gIC8qKlxuICAgKiDmnIDjgoLkvb/nlKjpoLvluqbjga7pq5jjgYTjg5Hjgr/jg7zjg7PjgpLnibnlrppcbiAgICovXG4gIGdldERvbWluYW50UGF0dGVybihwYXR0ZXJuczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+KTogTmFtaW5nUGF0dGVybiB7XG4gICAgbGV0IG1heENvdW50ID0gMDtcbiAgICBsZXQgZG9taW5hbnRQYXR0ZXJuOiBOYW1pbmdQYXR0ZXJuID0gJ21peGVkJztcbiAgICBsZXQgdGllQ291bnQgPSAwO1xuICAgIFxuICAgIGZvciAoY29uc3QgW3BhdHRlcm4sIGl0ZW1zXSBvZiBPYmplY3QuZW50cmllcyhwYXR0ZXJucykpIHtcbiAgICAgIGlmIChpdGVtcy5sZW5ndGggPiBtYXhDb3VudCkge1xuICAgICAgICBtYXhDb3VudCA9IGl0ZW1zLmxlbmd0aDtcbiAgICAgICAgZG9taW5hbnRQYXR0ZXJuID0gcGF0dGVybiBhcyBOYW1pbmdQYXR0ZXJuO1xuICAgICAgICB0aWVDb3VudCA9IDE7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW1zLmxlbmd0aCA9PT0gbWF4Q291bnQgJiYgaXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICB0aWVDb3VudCsrO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyDlkIzmlbDjga7loLTlkIjjga9taXhlZOOCkui/lOOBmVxuICAgIGlmICh0aWVDb3VudCA+IDEpIHtcbiAgICAgIHJldHVybiAnbWl4ZWQnO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZG9taW5hbnRQYXR0ZXJuO1xuICB9XG4gIFxuICAvKipcbiAgICog5ZG95ZCN6KaP5YmH44Gu57eP5ZCI44Os44Od44O844OI44KS55Sf5oiQXG4gICAqL1xuICBnZW5lcmF0ZU5hbWluZ1JlcG9ydChjb252ZW50aW9uczogTmFtaW5nQ29udmVudGlvbnMpOiBzdHJpbmcge1xuICAgIGNvbnN0IGxpbmVzID0gW1xuICAgICAgJz09PSBOYW1pbmcgQ29udmVudGlvbnMgQW5hbHlzaXMgPT09JyxcbiAgICAgICcnLFxuICAgICAgYEZpbGVzOiAke2NvbnZlbnRpb25zLmZpbGVzLnBhdHRlcm59ICgke01hdGgucm91bmQoY29udmVudGlvbnMuZmlsZXMuY29uZmlkZW5jZSAqIDEwMCl9JSBjb25maWRlbmNlKWAsXG4gICAgICBgRGlyZWN0b3JpZXM6ICR7Y29udmVudGlvbnMuZGlyZWN0b3JpZXMucGF0dGVybn0gKCR7TWF0aC5yb3VuZChjb252ZW50aW9ucy5kaXJlY3Rvcmllcy5jb25maWRlbmNlICogMTAwKX0lIGNvbmZpZGVuY2UpYCxcbiAgICAgIGBWYXJpYWJsZXM6ICR7Y29udmVudGlvbnMudmFyaWFibGVzLnBhdHRlcm59ICgke01hdGgucm91bmQoY29udmVudGlvbnMudmFyaWFibGVzLmNvbmZpZGVuY2UgKiAxMDApfSUgY29uZmlkZW5jZSlgLFxuICAgICAgYEZ1bmN0aW9uczogJHtjb252ZW50aW9ucy5mdW5jdGlvbnMucGF0dGVybn0gKCR7TWF0aC5yb3VuZChjb252ZW50aW9ucy5mdW5jdGlvbnMuY29uZmlkZW5jZSAqIDEwMCl9JSBjb25maWRlbmNlKWAsXG4gICAgICBgQ2xhc3NlczogJHtjb252ZW50aW9ucy5jbGFzc2VzLnBhdHRlcm59ICgke01hdGgucm91bmQoY29udmVudGlvbnMuY2xhc3Nlcy5jb25maWRlbmNlICogMTAwKX0lIGNvbmZpZGVuY2UpYCxcbiAgICAgICcnLFxuICAgICAgYE92ZXJhbGwgQ29uc2lzdGVuY3k6ICR7TWF0aC5yb3VuZCh0aGlzLmNhbGN1bGF0ZU92ZXJhbGxDb25zaXN0ZW5jeShjb252ZW50aW9ucykgKiAxMDApfSVgLFxuICAgICAgJydcbiAgICBdO1xuICAgIFxuICAgIC8vIOS+i+OCkui/veWKoFxuICAgIGlmIChjb252ZW50aW9ucy5maWxlcy5leGFtcGxlcy5sZW5ndGggPiAwKSB7XG4gICAgICBsaW5lcy5wdXNoKCdGaWxlIEV4YW1wbGVzOicpO1xuICAgICAgY29udmVudGlvbnMuZmlsZXMuZXhhbXBsZXMuZm9yRWFjaChleCA9PiBsaW5lcy5wdXNoKGAgIC0gJHtleH1gKSk7XG4gICAgICBsaW5lcy5wdXNoKCcnKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xuICB9XG4gIFxuICAvKipcbiAgICog5YWo5L2T55qE44Gq5LiA6LKr5oCn44KS6KiI566XXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZU92ZXJhbGxDb25zaXN0ZW5jeShjb252ZW50aW9uczogTmFtaW5nQ29udmVudGlvbnMpOiBudW1iZXIge1xuICAgIGNvbnN0IGNvbmZpZGVuY2VzID0gW1xuICAgICAgY29udmVudGlvbnMuZmlsZXMuY29uZmlkZW5jZSxcbiAgICAgIGNvbnZlbnRpb25zLmRpcmVjdG9yaWVzLmNvbmZpZGVuY2UsXG4gICAgICBjb252ZW50aW9ucy52YXJpYWJsZXMuY29uZmlkZW5jZSxcbiAgICAgIGNvbnZlbnRpb25zLmZ1bmN0aW9ucy5jb25maWRlbmNlLFxuICAgICAgY29udmVudGlvbnMuY2xhc3Nlcy5jb25maWRlbmNlXG4gICAgXTtcbiAgICBcbiAgICByZXR1cm4gY29uZmlkZW5jZXMucmVkdWNlKChzdW0sIGNvbmYpID0+IHN1bSArIGNvbmYsIDApIC8gY29uZmlkZW5jZXMubGVuZ3RoO1xuICB9XG4gIFxuICAvKipcbiAgICog44GZ44G544Gm44Gu44Kz44O844OJ44OV44Kh44Kk44Or44KS5Y+W5b6XXG4gICAqL1xuICBwcml2YXRlIGdldEFsbEZpbGVzKHByb2plY3RQYXRoOiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcGF0dGVybiA9IHBhdGguam9pbihwcm9qZWN0UGF0aCwgJyoqLyoue2pzLGpzeCx0cyx0c3h9Jyk7XG4gICAgcmV0dXJuIGdsb2Iuc3luYyhwYXR0ZXJuLCB7XG4gICAgICBpZ25vcmU6IFsnKiovbm9kZV9tb2R1bGVzLyoqJywgJyoqL2Rpc3QvKionLCAnKiovYnVpbGQvKionXVxuICAgIH0pO1xuICB9XG4gIFxuICAvKipcbiAgICog44GZ44G544Gm44Gu44Kz44O844OJ44OV44Kh44Kk44Or44KS6Kqt44G/6L6844G/XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlYWRBbGxDb2RlRmlsZXMoZmlsZXM6IHN0cmluZ1tdKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBjb250ZW50czogc3RyaW5nW10gPSBbXTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0Zi04Jyk7XG4gICAgICAgIGNvbnRlbnRzLnB1c2goY29udGVudCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyDjg5XjgqHjgqTjg6voqq3jgb/ovrzjgb/jgqjjg6njg7zjga/nhKHoppZcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGNvbnRlbnRzLmpvaW4oJ1xcbicpO1xuICB9XG4gIFxuICAvKipcbiAgICog5LiA6LKr5oCn44K544Kz44Ki44KS6KiI566XXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNvbnNpc3RlbmN5KHBhdHRlcm5zOiAoTmFtaW5nUGF0dGVybiB8IHVuZGVmaW5lZClbXSk6IG51bWJlciB7XG4gICAgY29uc3QgdmFsaWRQYXR0ZXJucyA9IHBhdHRlcm5zLmZpbHRlcihwID0+IHAgJiYgcCAhPT0gJ21peGVkJyk7XG4gICAgaWYgKHZhbGlkUGF0dGVybnMubGVuZ3RoID09PSAwKSByZXR1cm4gMDtcbiAgICBcbiAgICBjb25zdCBwYXR0ZXJuQ291bnRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgICB2YWxpZFBhdHRlcm5zLmZvckVhY2gocGF0dGVybiA9PiB7XG4gICAgICBpZiAocGF0dGVybikge1xuICAgICAgICBwYXR0ZXJuQ291bnRzLnNldChwYXR0ZXJuLCAocGF0dGVybkNvdW50cy5nZXQocGF0dGVybikgfHwgMCkgKyAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCBtYXhDb3VudCA9IE1hdGgubWF4KC4uLnBhdHRlcm5Db3VudHMudmFsdWVzKCkpO1xuICAgIHJldHVybiBtYXhDb3VudCAvIHZhbGlkUGF0dGVybnMubGVuZ3RoO1xuICB9XG4gIFxufSJdLCJ2ZXJzaW9uIjozfQ==