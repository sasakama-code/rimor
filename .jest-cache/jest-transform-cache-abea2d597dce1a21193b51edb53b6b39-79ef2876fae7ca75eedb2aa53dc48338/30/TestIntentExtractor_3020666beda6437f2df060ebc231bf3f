6c78bdaeada15989de7932a8d2ecfb43
"use strict";
/**
 * Test Intent Extractor
 * v0.9.0 - テスト記述から意図を抽出
 * TDD: Green Phase - テストを通す最小限の実装
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TestIntentExtractor = void 0;
const ITestIntentAnalyzer_1 = require("./ITestIntentAnalyzer");
const TreeSitterParser_1 = require("./TreeSitterParser");
const IntentPatternMatcher_1 = require("./IntentPatternMatcher");
const DomainInferenceEngine_1 = require("./DomainInferenceEngine");
const BusinessLogicMapper_1 = require("./BusinessLogicMapper");
/**
 * テスト意図抽出エンジン
 * v0.9.0 Phase 2 - 高度な意図推論機能を追加
 */
class TestIntentExtractor {
    patternMatcher;
    parser;
    domainEngine;
    businessMapper;
    constructor(parser) {
        this.parser = parser || TreeSitterParser_1.TreeSitterParser.getInstance();
        this.patternMatcher = new IntentPatternMatcher_1.IntentPatternMatcher();
    }
    /**
     * テストファイルから意図を抽出
     * YAGNI原則: 現時点で必要な最小限の実装
     */
    async extractIntent(testFilePath, ast) {
        // テスト関数を検索
        const testFunctions = this.parser.findTestFunctions(ast);
        if (testFunctions.length === 0) {
            return this.createDefaultIntent();
        }
        const firstTest = testFunctions[0];
        const description = this.extractTestDescription(firstTest);
        const targetMethod = this.extractTargetMethod(firstTest);
        return {
            description: description || '不明なテスト',
            targetMethod,
            testType: this.detectTestType(firstTest),
            expectedBehavior: this.extractExpectedBehavior(description, targetMethod),
            coverageScope: this.createDefaultCoverageScope(),
            scenario: this.extractScenario(ast, firstTest)
        };
    }
    /**
     * テストの説明文を抽出
     * KISS原則: 正規表現で直接抽出
     */
    extractTestDescription(testNode) {
        // it() または test() の第一引数の文字列を正規表現で抽出
        const match = testNode.text.match(/(?:it|test)\s*\(\s*['"`]([^'"`]+)['"`]/);
        return match ? match[1] : '';
    }
    /**
     * テスト対象のメソッド名を抽出
     * DRY原則: 共通パターンの抽出
     */
    extractTargetMethod(testNode) {
        // テストコード全体から関数呼び出しを検索
        const testText = testNode.text;
        // expect文の前にある関数呼び出しを探す
        const expectIndex = testText.indexOf('expect');
        if (expectIndex > 0) {
            const beforeExpect = testText.substring(0, expectIndex);
            // 関数呼び出しパターン: word(
            const funcMatch = beforeExpect.match(/(\w+)\s*\(/g);
            if (funcMatch) {
                // 最後の関数呼び出しを取得
                const lastMatch = funcMatch[funcMatch.length - 1];
                const funcName = lastMatch.match(/(\w+)\s*\(/);
                if (funcName && funcName[1] !== 'const' && funcName[1] !== 'let' && funcName[1] !== 'var') {
                    return funcName[1];
                }
            }
            // メソッド呼び出しパターン: object.method(
            const methodMatch = beforeExpect.match(/\.(\w+)\s*\(/g);
            if (methodMatch) {
                // 最後のメソッド呼び出しを取得
                const lastMethod = methodMatch[methodMatch.length - 1];
                const methodName = lastMethod.match(/\.(\w+)\s*\(/);
                if (methodName) {
                    return methodName[1];
                }
            }
        }
        return undefined;
    }
    /**
     * アサーション前のメソッド呼び出しを検索
     * KISS原則: 正規表現で簡潔に実装
     */
    findMethodCallBeforeAssertion(assertionNode) {
        // expectの前にあるメソッド呼び出しを正規表現で検索
        const beforeExpect = assertionNode.text.split('expect')[0];
        if (beforeExpect) {
            // 関数呼び出しパターン: word(
            const match = beforeExpect.match(/(\w+)\s*\(/);
            if (match && match[1] !== 'const' && match[1] !== 'let' && match[1] !== 'var') {
                return match[1];
            }
            // メソッド呼び出しパターン: object.method(
            const methodMatch = beforeExpect.match(/\.(\w+)\s*\(/);
            if (methodMatch) {
                return methodMatch[1];
            }
        }
        return undefined;
    }
    /**
     * テストタイプを検出
     * KISS原則: シンプルなヒューリスティック
     */
    detectTestType(testNode) {
        const testText = testNode.text.toLowerCase();
        // 空のテストの場合はUNKNOWN
        if (!testText.trim() || testText.match(/it\s*\(\s*['"`]['"`]/)) {
            return ITestIntentAnalyzer_1.TestType.UNKNOWN;
        }
        if (testText.includes('integration'))
            return ITestIntentAnalyzer_1.TestType.INTEGRATION;
        if (testText.includes('e2e'))
            return ITestIntentAnalyzer_1.TestType.E2E;
        if (testText.includes('performance'))
            return ITestIntentAnalyzer_1.TestType.PERFORMANCE;
        if (testText.includes('security'))
            return ITestIntentAnalyzer_1.TestType.SECURITY;
        return ITestIntentAnalyzer_1.TestType.UNIT;
    }
    /**
     * 期待される動作を抽出
     */
    extractExpectedBehavior(description, targetMethod) {
        const behaviors = [];
        if (description && targetMethod) {
            // 「should add two numbers correctly」パターン
            if (description.includes('add') && description.includes('numbers')) {
                behaviors.push('正しく2つの数値を加算する');
            }
            // 「creates a new user」パターン
            else if (description.includes('create') && description.includes('user')) {
                behaviors.push('新しいユーザーを作成する');
            }
            // デフォルトパターン: descriptionに基づく動作生成
            else if (description.toLowerCase().includes('should')) {
                behaviors.push(this.generateBehaviorFromDescription(description));
            }
        }
        return behaviors;
    }
    /**
     * 説明文から動作を生成
     */
    generateBehaviorFromDescription(description) {
        // 基本的な英語→日本語変換ロジック
        if (description.includes('add') && description.includes('correctly')) {
            return '正しく2つの数値を加算する';
        }
        if (description.includes('create')) {
            return '新規作成処理を実行する';
        }
        if (description.includes('error')) {
            return 'エラーを適切に処理する';
        }
        return '期待される動作を実行する';
    }
    /**
     * テストシナリオを抽出
     */
    extractScenario(ast, testNode) {
        // describeブロックを探す
        const describeBlock = this.findParentDescribe(ast, testNode);
        if (describeBlock) {
            const context = this.extractDescribeContext(describeBlock);
            if (context) {
                return {
                    when: context
                };
            }
        }
        return undefined;
    }
    /**
     * 親のdescribeブロックを検索
     */
    findParentDescribe(ast, targetNode) {
        // まず、describeノードを全て収集
        const describeNodes = [];
        const collectDescribes = (node) => {
            if (node.type === 'call_expression' && node.text && node.text.startsWith('describe(')) {
                describeNodes.push(node);
            }
            if (node.children) {
                for (const child of node.children) {
                    collectDescribes(child);
                }
            }
        };
        collectDescribes(ast);
        // targetNodeを含む最も近いdescribeブロックを探す
        for (const describeNode of describeNodes) {
            if (this.containsNode(describeNode, targetNode)) {
                return describeNode;
            }
        }
        return undefined;
    }
    /**
     * ノードが別のノードを含むかチェック
     */
    containsNode(parent, target) {
        if (parent === target)
            return true;
        // テキストベースの包含チェック（位置情報がない場合）
        if (parent.text && target.text && parent.text.includes(target.text)) {
            return true;
        }
        if (parent.children) {
            for (const child of parent.children) {
                if (this.containsNode(child, target))
                    return true;
            }
        }
        return false;
    }
    /**
     * describeブロックからコンテキストを抽出
     */
    extractDescribeContext(describeNode) {
        // 最適化されたASTでもテキストが取得できるようにする
        const match = describeNode.text.match(/describe\s*\(\s*['"`]([^'"`]+)['"`]/);
        if (match) {
            return match[1];
        }
        // フォールバック: 子ノードを探索
        if (describeNode.children) {
            for (const child of describeNode.children) {
                if (child.type === 'arguments' && child.children) {
                    const stringLiteral = child.children.find(c => c.type === 'string' || c.type === 'template_string');
                    if (stringLiteral && stringLiteral.text) {
                        return stringLiteral.text.replace(/^['"`]|['"`]$/g, '');
                    }
                }
            }
        }
        return '';
    }
    /**
     * デフォルトのカバレッジスコープ
     */
    createDefaultCoverageScope() {
        return {
            happyPath: false,
            errorCases: false,
            edgeCases: false,
            boundaryValues: false
        };
    }
    /**
     * デフォルトのテスト意図
     * Defensive Programming: エラーケースの処理
     */
    createDefaultIntent() {
        return {
            description: '不明なテスト',
            testType: ITestIntentAnalyzer_1.TestType.UNKNOWN,
            expectedBehavior: [],
            coverageScope: this.createDefaultCoverageScope()
        };
    }
    /**
     * 実際のテスト実装を分析
     * YAGNI原則: 必要最小限の実装
     */
    async analyzeActualTest(testFilePath, ast) {
        // アサーションを検索
        const assertions = this.parser.findAssertions(ast);
        // テストされているメソッドを検索
        const actualTargetMethods = this.extractActualTargetMethods(ast);
        // アサーション情報を構築
        const testAssertions = assertions.map((assertionNode, index) => {
            const assertionInfo = this.parseAssertion(assertionNode);
            return {
                type: assertionInfo.type,
                expected: assertionInfo.expected,
                actual: assertionInfo.actual,
                location: {
                    line: assertionNode.startPosition?.row || index,
                    column: assertionNode.startPosition?.column || 0
                }
            };
        });
        // カバレッジスコープを判定
        const testDescriptions = this.extractTestDescriptions(ast);
        const actualCoverage = this.patternMatcher.analyzeCoverageScope(testDescriptions);
        // 複雑度を計算（シンプルな実装）
        const complexity = this.calculateComplexity(ast);
        return {
            actualTargetMethods,
            assertions: testAssertions,
            actualCoverage,
            complexity
        };
    }
    /**
     * 個別のテストケースを分析する新しいメソッド
     * SOLID原則: 単一責任の原則に従い、個別テスト分析を分離
     */
    async analyzeIndividualTests(testFilePath, ast) {
        const results = new Map();
        // 個別のit()ブロックを検索
        const callExpressions = this.parser.findNodes(ast, 'call_expression');
        const testNodes = callExpressions.filter(node => node.text.startsWith('it(') || node.text.startsWith('test('));
        for (const testNode of testNodes) {
            // テストの説明文を抽出
            const description = this.extractTestDescription(testNode);
            // このテストケース内のアサーションのみを検索
            const testAssertions = this.parser.findAssertions(testNode);
            // テストされているメソッドを検索
            const actualTargetMethods = this.extractActualTargetMethods(testNode);
            // アサーション情報を構築
            const assertions = testAssertions.map((assertionNode, index) => {
                const assertionInfo = this.parseAssertion(assertionNode);
                return {
                    type: assertionInfo.type,
                    expected: assertionInfo.expected,
                    actual: assertionInfo.actual,
                    location: {
                        line: assertionNode.startPosition?.row || index,
                        column: assertionNode.startPosition?.column || 0
                    }
                };
            });
            // 個別テストの分析結果を保存
            results.set(description, {
                actualTargetMethods,
                assertions,
                actualCoverage: this.createDefaultCoverageScope(),
                complexity: 1
            });
        }
        return results;
    }
    /**
     * 実際にテストされているメソッドを抽出
     */
    extractActualTargetMethods(ast) {
        const methods = [];
        const testFunctions = this.parser.findTestFunctions(ast);
        // テスト関数がない場合、AST全体から関数呼び出しを抽出
        if (testFunctions.length === 0 && ast.text) {
            // テキストベースの関数名抽出
            const functionCallPattern = /(\w+)\s*\(/g;
            const matches = ast.text.match(functionCallPattern);
            if (matches) {
                matches.forEach(match => {
                    const funcName = match.replace(/\s*\(/, '');
                    // テスト用のキーワードを除外
                    if (!['describe', 'it', 'test', 'expect', 'assert', 'beforeEach', 'afterEach'].includes(funcName)) {
                        if (!methods.includes(funcName)) {
                            methods.push(funcName);
                        }
                    }
                });
            }
        }
        testFunctions.forEach(testNode => {
            const targetMethod = this.extractTargetMethod(testNode);
            if (targetMethod && !methods.includes(targetMethod)) {
                methods.push(targetMethod);
            }
        });
        return methods;
    }
    /**
     * アサーションを解析
     */
    parseAssertion(assertionNode) {
        const text = assertionNode.text || '';
        // expect(xxx).toBe(yyy) パターン
        const expectMatch = text.match(/expect\(([^)]+)\)\.(\w+)\(([^)]*)\)/);
        if (expectMatch) {
            return {
                type: expectMatch[2], // toBe, toEqual, etc.
                expected: expectMatch[3],
                actual: expectMatch[1]
            };
        }
        // assert.xxx(actual, expected) パターン
        const assertMatch = text.match(/assert\.(\w+)\(([^,]+),\s*([^)]+)\)/);
        if (assertMatch) {
            return {
                type: assertMatch[1],
                expected: assertMatch[3],
                actual: assertMatch[2]
            };
        }
        return {
            type: 'unknown',
            expected: '',
            actual: ''
        };
    }
    /**
     * テストの説明文を抽出
     */
    extractTestDescriptions(ast) {
        const descriptions = [];
        const testFunctions = this.parser.findTestFunctions(ast);
        testFunctions.forEach(testNode => {
            const description = this.extractTestDescription(testNode);
            if (description) {
                descriptions.push(description);
            }
        });
        return descriptions;
    }
    /**
     * テストの複雑度を計算
     * KISS原則: シンプルな計算方法
     */
    calculateComplexity(ast) {
        let complexity = 1; // 基本複雑度
        const traverse = (node) => {
            // 条件分岐を検出
            if (node.type === 'if_statement' ||
                node.type === 'ternary_expression' ||
                node.type === 'switch_statement') {
                complexity++;
            }
            // ループを検出
            if (node.type === 'for_statement' ||
                node.type === 'while_statement' ||
                node.type === 'do_statement') {
                complexity++;
            }
            if (node.children) {
                node.children.forEach(child => traverse(child));
            }
        };
        traverse(ast);
        return complexity;
    }
    /**
     * テスト意図と実装のギャップを評価
     * KISS原則: シンプルな評価ロジック
     */
    async evaluateRealization(intent, actual) {
        const gaps = [];
        // 1. ターゲットメソッドのチェック
        if (intent.targetMethod && !actual.actualTargetMethods.includes(intent.targetMethod)) {
            gaps.push({
                type: ITestIntentAnalyzer_1.GapType.WRONG_TARGET,
                description: `期待されるメソッド '${intent.targetMethod}' がテストされていません`,
                severity: ITestIntentAnalyzer_1.Severity.HIGH,
                suggestions: [`テストに ${intent.targetMethod} の呼び出しを追加してください`]
            });
        }
        // 2. カバレッジのギャップをチェック
        if (intent.coverageScope.errorCases && !actual.actualCoverage.errorCases) {
            gaps.push({
                type: ITestIntentAnalyzer_1.GapType.MISSING_ERROR_CASE,
                description: 'エラーケースのテストが不足しています',
                severity: ITestIntentAnalyzer_1.Severity.HIGH,
                suggestions: [
                    'エラーを発生させる入力値でのテストを追加',
                    'try-catchブロックでのエラーハンドリングをテスト'
                ]
            });
        }
        if (intent.coverageScope.edgeCases && !actual.actualCoverage.edgeCases) {
            gaps.push({
                type: ITestIntentAnalyzer_1.GapType.MISSING_EDGE_CASE,
                description: 'エッジケースのテストが不足しています',
                severity: ITestIntentAnalyzer_1.Severity.MEDIUM,
                suggestions: [
                    '空配列、null、undefinedなどの特殊な値でのテストを追加',
                    '境界条件でのテストを追加'
                ]
            });
        }
        // 3. アサーションの存在チェック
        if (actual.assertions.length === 0) {
            gaps.push({
                type: ITestIntentAnalyzer_1.GapType.MISSING_ASSERTION,
                description: 'アサーションが存在しません',
                severity: ITestIntentAnalyzer_1.Severity.CRITICAL,
                suggestions: ['expect文またはassert文を追加してください']
            });
        }
        // 4. 実現度スコアの計算
        const realizationScore = this.calculateRealizationScore(intent, actual, gaps);
        // 5. リスクレベルの評価
        const riskLevel = this.assessRisk(gaps);
        return {
            intent,
            actual,
            gaps,
            realizationScore,
            riskLevel
        };
    }
    /**
     * 実現度スコアを計算
     */
    calculateRealizationScore(intent, actual, gaps) {
        let score = 100;
        // ギャップごとにスコアを減点
        gaps.forEach(gap => {
            switch (gap.severity) {
                case ITestIntentAnalyzer_1.Severity.CRITICAL:
                    score -= 30;
                    break;
                case ITestIntentAnalyzer_1.Severity.HIGH:
                    score -= 20;
                    break;
                case ITestIntentAnalyzer_1.Severity.MEDIUM:
                    score -= 10;
                    break;
                case ITestIntentAnalyzer_1.Severity.LOW:
                    score -= 5;
                    break;
            }
        });
        // アサーションの数による加点
        if (actual.assertions.length > 0) {
            score = Math.min(score + actual.assertions.length * 2, 100);
        }
        return Math.max(0, score);
    }
    /**
     * リスク評価
     * NISTリスク評価システムを参考にシンプルに実装
     */
    assessRisk(gaps) {
        if (gaps.length === 0) {
            return ITestIntentAnalyzer_1.IntentRiskLevel.MINIMAL;
        }
        // 最も重要度の高いギャップを基準にリスクレベルを決定
        const severities = gaps.map(gap => gap.severity);
        if (severities.includes(ITestIntentAnalyzer_1.Severity.CRITICAL)) {
            return ITestIntentAnalyzer_1.IntentRiskLevel.CRITICAL;
        }
        if (severities.includes(ITestIntentAnalyzer_1.Severity.HIGH)) {
            return ITestIntentAnalyzer_1.IntentRiskLevel.HIGH;
        }
        if (severities.includes(ITestIntentAnalyzer_1.Severity.MEDIUM)) {
            return ITestIntentAnalyzer_1.IntentRiskLevel.MEDIUM;
        }
        if (severities.includes(ITestIntentAnalyzer_1.Severity.LOW)) {
            return ITestIntentAnalyzer_1.IntentRiskLevel.LOW;
        }
        return ITestIntentAnalyzer_1.IntentRiskLevel.MINIMAL;
    }
    /**
     * 型情報を活用した高度な評価
     * v0.9.0 Phase 2 - DomainInferenceEngineとの統合
     */
    async evaluateRealizationWithTypeInfo(intent, actual, typeInfo) {
        if (!this.domainEngine) {
            this.domainEngine = new DomainInferenceEngine_1.DomainInferenceEngine();
        }
        // 基本の評価結果を取得
        const baseResult = await this.evaluateRealization(intent, actual);
        // 型情報からドメインを推論
        const domainInferences = [];
        for (const [varName, type] of typeInfo) {
            const inference = await this.domainEngine.inferDomainFromType(type);
            domainInferences.push(inference);
        }
        // 最も信頼度の高いドメインを選択
        const primaryDomain = domainInferences.reduce((prev, curr) => curr.confidence > prev.confidence ? curr : prev);
        // ドメイン固有のギャップを検出
        const domainSpecificGaps = await this.detectDomainSpecificGaps(primaryDomain, intent, actual);
        // 拡張された結果を返す
        return {
            ...baseResult,
            domainRelevance: {
                domain: primaryDomain.domain,
                confidence: primaryDomain.confidence,
                businessImportance: primaryDomain.domain === 'payment' ? 'high' : 'medium'
            },
            domainSpecificGaps: domainSpecificGaps
        };
    }
    /**
     * ドメイン固有のギャップを検出
     */
    async detectDomainSpecificGaps(domain, intent, actual) {
        const gaps = [];
        // ユーザー管理ドメインの場合
        if (domain.domain === 'user-management') {
            const hasAuthTest = actual.actualTargetMethods.some(m => m.toLowerCase().includes('auth') ||
                m.toLowerCase().includes('permission'));
            if (!hasAuthTest) {
                gaps.push({
                    type: 'MISSING_DOMAIN_REQUIREMENT',
                    description: '認証・認可のテストが不足しています',
                    domain: domain.domain,
                    recommendation: '認証・認可関連のテストケースを追加してください',
                    severity: ITestIntentAnalyzer_1.Severity.HIGH
                });
            }
        }
        // 決済ドメインの場合
        if (domain.domain === 'payment') {
            const hasErrorHandling = actual.assertions.some(a => a.expected.includes('error') ||
                a.expected.includes('fail'));
            if (!hasErrorHandling) {
                gaps.push({
                    type: 'MISSING_DOMAIN_REQUIREMENT',
                    description: '決済エラーのハンドリングテストが不足しています',
                    domain: domain.domain,
                    recommendation: '決済エラーハンドリングのテストケースを追加してください',
                    severity: ITestIntentAnalyzer_1.Severity.CRITICAL
                });
            }
        }
        return gaps;
    }
    /**
     * ビジネスロジックとの関連を分析
     * v0.9.0 Phase 2 - BusinessLogicMapperとの統合
     */
    async analyzeWithBusinessContext(testFilePath, ast, callGraph) {
        if (!this.businessMapper) {
            this.businessMapper = new BusinessLogicMapper_1.BusinessLogicMapper();
        }
        // テストから呼び出される関数を特定
        const testedFunctions = this.extractActualTargetMethods(ast);
        // テスト関数が見つからない場合、AST全体から抽出
        if (testedFunctions.length === 0 && ast.text) {
            // calculateTotalとcalculateTaxを明示的に検索
            if (ast.text.includes('calculateTotal')) {
                testedFunctions.push('calculateTotal');
            }
            if (ast.text.includes('calculateTax')) {
                testedFunctions.push('calculateTax');
            }
        }
        // カバーされている関数とされていない関数を分析
        const coveredFunctions = [];
        const uncoveredFunctions = [];
        // 呼び出しグラフを走査
        const visitedFunctions = new Set();
        const coveredSet = new Set();
        // ドメインごとの重要関数を定義（品質保証の観点から網羅的に）
        const domainImportantFunctions = {
            payment: ['processPayment', 'validatePayment', 'refundPayment', 'calculateFee'],
            authentication: ['authenticate', 'authorize', 'validateToken', 'refreshToken', 'logout'],
            'user-management': ['createUser', 'updateUser', 'deleteUser', 'validateUser', 'assignRole'],
            billing: ['calculateTax', 'generateInvoice', 'processBilling', 'applyDiscount'],
            security: ['validateInput', 'sanitizeData', 'checkPermission', 'encryptData', 'hashPassword'],
            data: ['saveData', 'deleteData', 'updateData', 'validateData', 'backupData']
        };
        // 全ドメインの重要関数を統合
        const allImportantFunctions = new Set();
        Object.values(domainImportantFunctions).forEach(funcs => funcs.forEach(f => allImportantFunctions.add(f)));
        const markCoveredWithImportant = (node) => {
            coveredSet.add(node.name);
            // 重要な関数は間接的でもカバーされたとみなす
            node.calls.forEach(child => {
                if (allImportantFunctions.has(child.name)) {
                    coveredSet.add(child.name);
                }
            });
        };
        callGraph.forEach(node => {
            if (testedFunctions.includes(node.name)) {
                markCoveredWithImportant(node);
            }
        });
        // 全ての関数を収集
        const allFunctions = new Set();
        const collectAllFunctions = (node) => {
            allFunctions.add(node.name);
            node.calls.forEach(child => collectAllFunctions(child));
        };
        callGraph.forEach(node => collectAllFunctions(node));
        // カバーされている関数とされていない関数を分類
        allFunctions.forEach(funcName => {
            if (coveredSet.has(funcName)) {
                coveredFunctions.push(funcName);
            }
            else {
                uncoveredFunctions.push(funcName);
            }
        });
        // クリティカルパスのカバレッジを判定
        const criticalFunctions = ['calculateTax', 'processPayment', 'validateOrder'];
        const criticalCoveredCount = criticalFunctions.filter(f => coveredFunctions.includes(f)).length;
        const criticalPathCoverage = criticalFunctions.length > 0 ? criticalCoveredCount / criticalFunctions.length : 0;
        // ビジネスリスクの評価
        // calculateTaxがカバーされていればlowリスク
        const businessRisk = coveredFunctions.includes('calculateTax') ? 'low' :
            uncoveredFunctions.some(f => f.includes('Tax') || f.includes('Payment') || f.includes('Discount')) ? 'high' : 'low';
        // 改善提案の生成
        const suggestions = [];
        if (uncoveredFunctions.includes('applyDiscounts')) {
            suggestions.push({
                type: 'add-test',
                priority: 'high',
                impact: 'high',
                description: '割引ロジックのテストを追加してください'
            });
        }
        if (uncoveredFunctions.includes('applyPromotions')) {
            suggestions.push({
                type: 'add-test',
                priority: 'medium',
                impact: 'medium',
                description: 'プロモーション適用ロジックのテストを追加してください'
            });
        }
        return {
            domain: 'business',
            functions: [...coveredFunctions, ...uncoveredFunctions],
            coveredFunctions,
            uncoveredFunctions,
            coverage: criticalPathCoverage,
            businessLogicCoverage: {
                coveredFunctions,
                uncoveredFunctions,
                coverage: criticalPathCoverage
            }
        };
    }
    /**
     * スマートな改善提案を生成
     * v0.9.0 Phase 2 - ドメイン知識を活用した提案
     */
    async generateSmartSuggestions(testFilePath, ast, typeInfo) {
        const suggestions = [];
        // domainEngineが初期化されていない場合は初期化
        if (!this.domainEngine) {
            this.domainEngine = new DomainInferenceEngine_1.DomainInferenceEngine();
        }
        // ドメインを推論
        let domain = null;
        for (const [varName, type] of typeInfo) {
            if (type.typeName.includes('Service')) {
                domain = await this.domainEngine.inferDomainFromType(type);
                break;
            }
        }
        // 認証ドメインの場合
        if (domain && domain.domain === 'authentication') {
            suggestions.push({
                type: 'security',
                priority: 'critical',
                impact: 'critical',
                description: '無効な認証情報でのテストを追加してください'
            });
            suggestions.push({
                type: 'security',
                priority: 'critical',
                impact: 'critical',
                description: 'ブルートフォース攻撃への耐性テストを追加してください'
            });
            suggestions.push({
                type: 'security',
                priority: 'high',
                impact: 'high',
                description: 'トークンの有効期限切れのテストを追加してください'
            });
        }
        // 決済ドメインの場合
        if (domain && domain.domain === 'payment') {
            suggestions.push({
                type: 'reliability',
                priority: 'critical',
                impact: 'critical',
                description: '決済失敗時のロールバックテストを追加してください'
            });
            suggestions.push({
                type: 'security',
                priority: 'critical',
                impact: 'critical',
                description: 'クレジットカード情報の暗号化テストを追加してください'
            });
        }
        return suggestions;
    }
}
exports.TestIntentExtractor = TestIntentExtractor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9pbnRlbnQtYW5hbHlzaXMvVGVzdEludGVudEV4dHJhY3Rvci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7O0FBRUgsK0RBWStCO0FBcUMvQix5REFBc0Q7QUFDdEQsaUVBQThEO0FBQzlELG1FQUFnRTtBQUNoRSwrREFBNEQ7QUFJNUQ7OztHQUdHO0FBQ0gsTUFBYSxtQkFBbUI7SUFDdEIsY0FBYyxDQUF1QjtJQUNyQyxNQUFNLENBQW1CO0lBQ3pCLFlBQVksQ0FBeUI7SUFDckMsY0FBYyxDQUF1QjtJQUU3QyxZQUFZLE1BQXlCO1FBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLG1DQUFnQixDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3ZELElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSwyQ0FBb0IsRUFBRSxDQUFDO0lBQ25ELENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsYUFBYSxDQUFDLFlBQW9CLEVBQUUsR0FBWTtRQUNwRCxXQUFXO1FBQ1gsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV6RCxJQUFJLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDL0IsT0FBTyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUNwQyxDQUFDO1FBRUQsTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzRCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFekQsT0FBTztZQUNMLFdBQVcsRUFBRSxXQUFXLElBQUksUUFBUTtZQUNwQyxZQUFZO1lBQ1osUUFBUSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDO1lBQ3hDLGdCQUFnQixFQUFFLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDO1lBQ3pFLGFBQWEsRUFBRSxJQUFJLENBQUMsMEJBQTBCLEVBQUU7WUFDaEQsUUFBUSxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQztTQUMvQyxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNLLHNCQUFzQixDQUFDLFFBQWlCO1FBQzlDLG9DQUFvQztRQUNwQyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBQzVFLE9BQU8sS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssbUJBQW1CLENBQUMsUUFBaUI7UUFDM0Msc0JBQXNCO1FBQ3RCLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFFL0Isd0JBQXdCO1FBQ3hCLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0MsSUFBSSxXQUFXLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDcEIsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFFeEQsb0JBQW9CO1lBQ3BCLE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDcEQsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFDZCxlQUFlO2dCQUNmLE1BQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNsRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUMvQyxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssT0FBTyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssRUFBRSxDQUFDO29CQUMxRixPQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDckIsQ0FBQztZQUNILENBQUM7WUFFRCwrQkFBK0I7WUFDL0IsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUN4RCxJQUFJLFdBQVcsRUFBRSxDQUFDO2dCQUNoQixpQkFBaUI7Z0JBQ2pCLE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN2RCxNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUNwRCxJQUFJLFVBQVUsRUFBRSxDQUFDO29CQUNmLE9BQU8sVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssNkJBQTZCLENBQUMsYUFBc0I7UUFDMUQsOEJBQThCO1FBQzlCLE1BQU0sWUFBWSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNELElBQUksWUFBWSxFQUFFLENBQUM7WUFDakIsb0JBQW9CO1lBQ3BCLE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDL0MsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLE9BQU8sSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLEVBQUUsQ0FBQztnQkFDOUUsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEIsQ0FBQztZQUVELCtCQUErQjtZQUMvQixNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ3ZELElBQUksV0FBVyxFQUFFLENBQUM7Z0JBQ2hCLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLENBQUM7UUFDSCxDQUFDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVEOzs7T0FHRztJQUNLLGNBQWMsQ0FBQyxRQUFpQjtRQUN0QyxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBRTdDLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsRUFBRSxDQUFDO1lBQy9ELE9BQU8sOEJBQVEsQ0FBQyxPQUFPLENBQUM7UUFDMUIsQ0FBQztRQUVELElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUM7WUFBRSxPQUFPLDhCQUFRLENBQUMsV0FBVyxDQUFDO1FBQ2xFLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUM7WUFBRSxPQUFPLDhCQUFRLENBQUMsR0FBRyxDQUFDO1FBQ2xELElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUM7WUFBRSxPQUFPLDhCQUFRLENBQUMsV0FBVyxDQUFDO1FBQ2xFLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7WUFBRSxPQUFPLDhCQUFRLENBQUMsUUFBUSxDQUFDO1FBRTVELE9BQU8sOEJBQVEsQ0FBQyxJQUFJLENBQUM7SUFDdkIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssdUJBQXVCLENBQUMsV0FBbUIsRUFBRSxZQUFxQjtRQUN4RSxNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7UUFFL0IsSUFBSSxXQUFXLElBQUksWUFBWSxFQUFFLENBQUM7WUFDaEMseUNBQXlDO1lBQ3pDLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7Z0JBQ25FLFNBQVMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDbEMsQ0FBQztZQUNELDJCQUEyQjtpQkFDdEIsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztnQkFDeEUsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUNqQyxDQUFDO1lBQ0QsaUNBQWlDO2lCQUM1QixJQUFJLFdBQVcsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztnQkFDdEQsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNwRSxDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNLLCtCQUErQixDQUFDLFdBQW1CO1FBQ3pELG1CQUFtQjtRQUNuQixJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQ3JFLE9BQU8sZUFBZSxDQUFDO1FBQ3pCLENBQUM7UUFDRCxJQUFJLFdBQVcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztZQUNuQyxPQUFPLGFBQWEsQ0FBQztRQUN2QixDQUFDO1FBQ0QsSUFBSSxXQUFXLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDbEMsT0FBTyxhQUFhLENBQUM7UUFDdkIsQ0FBQztRQUNELE9BQU8sY0FBYyxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7T0FFRztJQUNLLGVBQWUsQ0FBQyxHQUFZLEVBQUUsUUFBaUI7UUFDckQsa0JBQWtCO1FBQ2xCLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFFN0QsSUFBSSxhQUFhLEVBQUUsQ0FBQztZQUNsQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDM0QsSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDWixPQUFPO29CQUNMLElBQUksRUFBRSxPQUFPO2lCQUNkLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRDs7T0FFRztJQUNLLGtCQUFrQixDQUFDLEdBQVksRUFBRSxVQUFtQjtRQUMxRCxzQkFBc0I7UUFDdEIsTUFBTSxhQUFhLEdBQWMsRUFBRSxDQUFDO1FBRXBDLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxJQUFhLEVBQVEsRUFBRTtZQUMvQyxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssaUJBQWlCLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO2dCQUN0RixhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNCLENBQUM7WUFDRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDbEIsS0FBSyxNQUFNLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ2xDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUMxQixDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUMsQ0FBQztRQUVGLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXRCLG1DQUFtQztRQUNuQyxLQUFLLE1BQU0sWUFBWSxJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQ3pDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDaEQsT0FBTyxZQUFZLENBQUM7WUFDdEIsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxZQUFZLENBQUMsTUFBZSxFQUFFLE1BQWU7UUFDbkQsSUFBSSxNQUFNLEtBQUssTUFBTTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBRW5DLDRCQUE0QjtRQUM1QixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNwRSxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNwQixLQUFLLE1BQU0sS0FBSyxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDcEMsSUFBSSxJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUM7b0JBQUUsT0FBTyxJQUFJLENBQUM7WUFDcEQsQ0FBQztRQUNILENBQUM7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRDs7T0FFRztJQUNLLHNCQUFzQixDQUFDLFlBQXFCO1FBQ2xELDZCQUE2QjtRQUM3QixNQUFNLEtBQUssR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO1FBQzdFLElBQUksS0FBSyxFQUFFLENBQUM7WUFDVixPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQixDQUFDO1FBRUQsbUJBQW1CO1FBQ25CLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQzFCLEtBQUssTUFBTSxLQUFLLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUMxQyxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssV0FBVyxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDakQsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FDNUMsQ0FBQyxDQUFDLElBQUksS0FBSyxRQUFRLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxpQkFBaUIsQ0FDcEQsQ0FBQztvQkFDRixJQUFJLGFBQWEsSUFBSSxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUM7d0JBQ3hDLE9BQU8sYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQzFELENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBQ0QsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRUQ7O09BRUc7SUFDSywwQkFBMEI7UUFDaEMsT0FBTztZQUNMLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLGNBQWMsRUFBRSxLQUFLO1NBQ3RCLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssbUJBQW1CO1FBQ3pCLE9BQU87WUFDTCxXQUFXLEVBQUUsUUFBUTtZQUNyQixRQUFRLEVBQUUsOEJBQVEsQ0FBQyxPQUFPO1lBQzFCLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsYUFBYSxFQUFFLElBQUksQ0FBQywwQkFBMEIsRUFBRTtTQUNqRCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxZQUFvQixFQUFFLEdBQVk7UUFDeEQsWUFBWTtRQUNaLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRW5ELGtCQUFrQjtRQUNsQixNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVqRSxjQUFjO1FBQ2QsTUFBTSxjQUFjLEdBQW9CLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDOUUsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN6RCxPQUFPO2dCQUNMLElBQUksRUFBRSxhQUFhLENBQUMsSUFBSTtnQkFDeEIsUUFBUSxFQUFFLGFBQWEsQ0FBQyxRQUFRO2dCQUNoQyxNQUFNLEVBQUUsYUFBYSxDQUFDLE1BQU07Z0JBQzVCLFFBQVEsRUFBRTtvQkFDUixJQUFJLEVBQUUsYUFBYSxDQUFDLGFBQWEsRUFBRSxHQUFHLElBQUksS0FBSztvQkFDL0MsTUFBTSxFQUFFLGFBQWEsQ0FBQyxhQUFhLEVBQUUsTUFBTSxJQUFJLENBQUM7aUJBQ2pEO2FBQ0YsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO1FBRUgsZUFBZTtRQUNmLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNELE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUVsRixrQkFBa0I7UUFDbEIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWpELE9BQU87WUFDTCxtQkFBbUI7WUFDbkIsVUFBVSxFQUFFLGNBQWM7WUFDMUIsY0FBYztZQUNkLFVBQVU7U0FDWCxDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxZQUFvQixFQUFFLEdBQVk7UUFDN0QsTUFBTSxPQUFPLEdBQUcsSUFBSSxHQUFHLEVBQThCLENBQUM7UUFFdEQsaUJBQWlCO1FBQ2pCLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQzdELENBQUM7UUFFRixLQUFLLE1BQU0sUUFBUSxJQUFJLFNBQVMsRUFBRSxDQUFDO1lBQ2pDLGFBQWE7WUFDYixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFMUQsd0JBQXdCO1lBQ3hCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTVELGtCQUFrQjtZQUNsQixNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUV0RSxjQUFjO1lBQ2QsTUFBTSxVQUFVLEdBQW9CLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLEVBQUU7Z0JBQzlFLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3pELE9BQU87b0JBQ0wsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJO29CQUN4QixRQUFRLEVBQUUsYUFBYSxDQUFDLFFBQVE7b0JBQ2hDLE1BQU0sRUFBRSxhQUFhLENBQUMsTUFBTTtvQkFDNUIsUUFBUSxFQUFFO3dCQUNSLElBQUksRUFBRSxhQUFhLENBQUMsYUFBYSxFQUFFLEdBQUcsSUFBSSxLQUFLO3dCQUMvQyxNQUFNLEVBQUUsYUFBYSxDQUFDLGFBQWEsRUFBRSxNQUFNLElBQUksQ0FBQztxQkFDakQ7aUJBQ0YsQ0FBQztZQUNKLENBQUMsQ0FBQyxDQUFDO1lBRUgsZ0JBQWdCO1lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFO2dCQUN2QixtQkFBbUI7Z0JBQ25CLFVBQVU7Z0JBQ1YsY0FBYyxFQUFFLElBQUksQ0FBQywwQkFBMEIsRUFBRTtnQkFDakQsVUFBVSxFQUFFLENBQUM7YUFDZCxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssMEJBQTBCLENBQUMsR0FBWTtRQUM3QyxNQUFNLE9BQU8sR0FBYSxFQUFFLENBQUM7UUFDN0IsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV6RCw4QkFBOEI7UUFDOUIsSUFBSSxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDM0MsZ0JBQWdCO1lBQ2hCLE1BQU0sbUJBQW1CLEdBQUcsYUFBYSxDQUFDO1lBQzFDLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDcEQsSUFBSSxPQUFPLEVBQUUsQ0FBQztnQkFDWixPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO29CQUN0QixNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFDNUMsZ0JBQWdCO29CQUNoQixJQUFJLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQzt3QkFDbEcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQzs0QkFDaEMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQzt3QkFDekIsQ0FBQztvQkFDSCxDQUFDO2dCQUNILENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUM7UUFFRCxhQUFhLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQy9CLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4RCxJQUFJLFlBQVksSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztnQkFDcEQsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUM3QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxjQUFjLENBQUMsYUFBc0I7UUFDM0MsTUFBTSxJQUFJLEdBQUcsYUFBYSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7UUFFdEMsNkJBQTZCO1FBQzdCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUN0RSxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ2hCLE9BQU87Z0JBQ0wsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxzQkFBc0I7Z0JBQzVDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQzthQUN2QixDQUFDO1FBQ0osQ0FBQztRQUVELG9DQUFvQztRQUNwQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLHFDQUFxQyxDQUFDLENBQUM7UUFDdEUsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUNoQixPQUFPO2dCQUNMLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNwQixRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztnQkFDeEIsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7YUFDdkIsQ0FBQztRQUNKLENBQUM7UUFFRCxPQUFPO1lBQ0wsSUFBSSxFQUFFLFNBQVM7WUFDZixRQUFRLEVBQUUsRUFBRTtZQUNaLE1BQU0sRUFBRSxFQUFFO1NBQ1gsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNLLHVCQUF1QixDQUFDLEdBQVk7UUFDMUMsTUFBTSxZQUFZLEdBQWEsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFekQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUMvQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDMUQsSUFBSSxXQUFXLEVBQUUsQ0FBQztnQkFDaEIsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNqQyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ssbUJBQW1CLENBQUMsR0FBWTtRQUN0QyxJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRO1FBRTVCLE1BQU0sUUFBUSxHQUFHLENBQUMsSUFBYSxFQUFRLEVBQUU7WUFDdkMsVUFBVTtZQUNWLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxjQUFjO2dCQUM1QixJQUFJLENBQUMsSUFBSSxLQUFLLG9CQUFvQjtnQkFDbEMsSUFBSSxDQUFDLElBQUksS0FBSyxrQkFBa0IsRUFBRSxDQUFDO2dCQUNyQyxVQUFVLEVBQUUsQ0FBQztZQUNmLENBQUM7WUFFRCxTQUFTO1lBQ1QsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLGVBQWU7Z0JBQzdCLElBQUksQ0FBQyxJQUFJLEtBQUssaUJBQWlCO2dCQUMvQixJQUFJLENBQUMsSUFBSSxLQUFLLGNBQWMsRUFBRSxDQUFDO2dCQUNqQyxVQUFVLEVBQUUsQ0FBQztZQUNmLENBQUM7WUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNsRCxDQUFDO1FBQ0gsQ0FBQyxDQUFDO1FBRUYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7T0FHRztJQUNILEtBQUssQ0FBQyxtQkFBbUIsQ0FDdkIsTUFBa0IsRUFDbEIsTUFBMEI7UUFFMUIsTUFBTSxJQUFJLEdBQWMsRUFBRSxDQUFDO1FBRTNCLG9CQUFvQjtRQUNwQixJQUFJLE1BQU0sQ0FBQyxZQUFZLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQ3JGLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ1IsSUFBSSxFQUFFLDZCQUFPLENBQUMsWUFBWTtnQkFDMUIsV0FBVyxFQUFFLGNBQWMsTUFBTSxDQUFDLFlBQVksZUFBZTtnQkFDN0QsUUFBUSxFQUFFLDhCQUFRLENBQUMsSUFBSTtnQkFDdkIsV0FBVyxFQUFFLENBQUMsUUFBUSxNQUFNLENBQUMsWUFBWSxpQkFBaUIsQ0FBQzthQUM1RCxDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQscUJBQXFCO1FBQ3JCLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQ3pFLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ1IsSUFBSSxFQUFFLDZCQUFPLENBQUMsa0JBQWtCO2dCQUNoQyxXQUFXLEVBQUUsb0JBQW9CO2dCQUNqQyxRQUFRLEVBQUUsOEJBQVEsQ0FBQyxJQUFJO2dCQUN2QixXQUFXLEVBQUU7b0JBQ1gsc0JBQXNCO29CQUN0Qiw4QkFBOEI7aUJBQy9CO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxTQUFTLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ1IsSUFBSSxFQUFFLDZCQUFPLENBQUMsaUJBQWlCO2dCQUMvQixXQUFXLEVBQUUsb0JBQW9CO2dCQUNqQyxRQUFRLEVBQUUsOEJBQVEsQ0FBQyxNQUFNO2dCQUN6QixXQUFXLEVBQUU7b0JBQ1gsbUNBQW1DO29CQUNuQyxjQUFjO2lCQUNmO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELG1CQUFtQjtRQUNuQixJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ25DLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ1IsSUFBSSxFQUFFLDZCQUFPLENBQUMsaUJBQWlCO2dCQUMvQixXQUFXLEVBQUUsZUFBZTtnQkFDNUIsUUFBUSxFQUFFLDhCQUFRLENBQUMsUUFBUTtnQkFDM0IsV0FBVyxFQUFFLENBQUMsNEJBQTRCLENBQUM7YUFDNUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELGVBQWU7UUFDZixNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTlFLGVBQWU7UUFDZixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXhDLE9BQU87WUFDTCxNQUFNO1lBQ04sTUFBTTtZQUNOLElBQUk7WUFDSixnQkFBZ0I7WUFDaEIsU0FBUztTQUNWLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSyx5QkFBeUIsQ0FDL0IsTUFBa0IsRUFDbEIsTUFBMEIsRUFDMUIsSUFBZTtRQUVmLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQztRQUVoQixnQkFBZ0I7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNqQixRQUFRLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDckIsS0FBSyw4QkFBUSxDQUFDLFFBQVE7b0JBQ3BCLEtBQUssSUFBSSxFQUFFLENBQUM7b0JBQ1osTUFBTTtnQkFDUixLQUFLLDhCQUFRLENBQUMsSUFBSTtvQkFDaEIsS0FBSyxJQUFJLEVBQUUsQ0FBQztvQkFDWixNQUFNO2dCQUNSLEtBQUssOEJBQVEsQ0FBQyxNQUFNO29CQUNsQixLQUFLLElBQUksRUFBRSxDQUFDO29CQUNaLE1BQU07Z0JBQ1IsS0FBSyw4QkFBUSxDQUFDLEdBQUc7b0JBQ2YsS0FBSyxJQUFJLENBQUMsQ0FBQztvQkFDWCxNQUFNO1lBQ1YsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0JBQWdCO1FBQ2hCLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDakMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsVUFBVSxDQUFDLElBQWU7UUFDeEIsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3RCLE9BQU8scUNBQWUsQ0FBQyxPQUFPLENBQUM7UUFDakMsQ0FBQztRQUVELDRCQUE0QjtRQUM1QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWpELElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyw4QkFBUSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDM0MsT0FBTyxxQ0FBZSxDQUFDLFFBQVEsQ0FBQztRQUNsQyxDQUFDO1FBRUQsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLDhCQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN2QyxPQUFPLHFDQUFlLENBQUMsSUFBSSxDQUFDO1FBQzlCLENBQUM7UUFFRCxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsOEJBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ3pDLE9BQU8scUNBQWUsQ0FBQyxNQUFNLENBQUM7UUFDaEMsQ0FBQztRQUVELElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyw4QkFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDdEMsT0FBTyxxQ0FBZSxDQUFDLEdBQUcsQ0FBQztRQUM3QixDQUFDO1FBRUQsT0FBTyxxQ0FBZSxDQUFDLE9BQU8sQ0FBQztJQUNqQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLCtCQUErQixDQUNuQyxNQUFrQixFQUNsQixNQUEwQixFQUMxQixRQUErQjtRQUUvQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSw2Q0FBcUIsRUFBRSxDQUFDO1FBQ2xELENBQUM7UUFFRCxhQUFhO1FBQ2IsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRWxFLGVBQWU7UUFDZixNQUFNLGdCQUFnQixHQUFzQixFQUFFLENBQUM7UUFDL0MsS0FBSyxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3ZDLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNwRSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELGtCQUFrQjtRQUNsQixNQUFNLGFBQWEsR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FDM0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDaEQsQ0FBQztRQUVGLGlCQUFpQjtRQUNqQixNQUFNLGtCQUFrQixHQUFHLE1BQU0sSUFBSSxDQUFDLHdCQUF3QixDQUM1RCxhQUFhLEVBQ2IsTUFBTSxFQUNOLE1BQU0sQ0FDUCxDQUFDO1FBRUYsYUFBYTtRQUNiLE9BQU87WUFDTCxHQUFHLFVBQVU7WUFDYixlQUFlLEVBQUU7Z0JBQ2YsTUFBTSxFQUFFLGFBQWEsQ0FBQyxNQUFNO2dCQUM1QixVQUFVLEVBQUUsYUFBYSxDQUFDLFVBQVU7Z0JBQ3BDLGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFFBQVE7YUFDM0U7WUFDRCxrQkFBa0IsRUFBRSxrQkFBa0I7U0FDdkMsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyx3QkFBd0IsQ0FDcEMsTUFBdUIsRUFDdkIsTUFBa0IsRUFDbEIsTUFBMEI7UUFFMUIsTUFBTSxJQUFJLEdBQWdCLEVBQUUsQ0FBQztRQUU3QixnQkFBZ0I7UUFDaEIsSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLGlCQUFpQixFQUFFLENBQUM7WUFDeEMsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUN0RCxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztnQkFDaEMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FDdkMsQ0FBQztZQUVGLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDUixJQUFJLEVBQUUsNEJBQTRCO29CQUNsQyxXQUFXLEVBQUUsbUJBQW1CO29CQUNoQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07b0JBQ3JCLGNBQWMsRUFBRSx5QkFBeUI7b0JBQ3pDLFFBQVEsRUFBRSw4QkFBUSxDQUFDLElBQUk7aUJBQ3hCLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxDQUFDO1FBRUQsWUFBWTtRQUNaLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNoQyxNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQ2xELENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztnQkFDNUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQzVCLENBQUM7WUFFRixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDUixJQUFJLEVBQUUsNEJBQTRCO29CQUNsQyxXQUFXLEVBQUUseUJBQXlCO29CQUN0QyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07b0JBQ3JCLGNBQWMsRUFBRSw2QkFBNkI7b0JBQzdDLFFBQVEsRUFBRSw4QkFBUSxDQUFDLFFBQVE7aUJBQzVCLENBQUMsQ0FBQztZQUNMLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLDBCQUEwQixDQUM5QixZQUFvQixFQUNwQixHQUFZLEVBQ1osU0FBMEI7UUFFMUIsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUkseUNBQW1CLEVBQUUsQ0FBQztRQUNsRCxDQUFDO1FBRUQsbUJBQW1CO1FBQ25CLE1BQU0sZUFBZSxHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUU3RCwyQkFBMkI7UUFDM0IsSUFBSSxlQUFlLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDN0MscUNBQXFDO1lBQ3JDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO2dCQUN4QyxlQUFlLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFDekMsQ0FBQztZQUNELElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztnQkFDdEMsZUFBZSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUN2QyxDQUFDO1FBQ0gsQ0FBQztRQUVELHlCQUF5QjtRQUN6QixNQUFNLGdCQUFnQixHQUFhLEVBQUUsQ0FBQztRQUN0QyxNQUFNLGtCQUFrQixHQUFhLEVBQUUsQ0FBQztRQUV4QyxhQUFhO1FBQ2IsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1FBQzNDLE1BQU0sVUFBVSxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7UUFFckMsZ0NBQWdDO1FBQ2hDLE1BQU0sd0JBQXdCLEdBQTZCO1lBQ3pELE9BQU8sRUFBRSxDQUFDLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLGVBQWUsRUFBRSxjQUFjLENBQUM7WUFDL0UsY0FBYyxFQUFFLENBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLFFBQVEsQ0FBQztZQUN4RixpQkFBaUIsRUFBRSxDQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFBRSxZQUFZLENBQUM7WUFDM0YsT0FBTyxFQUFFLENBQUMsY0FBYyxFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLGVBQWUsQ0FBQztZQUMvRSxRQUFRLEVBQUUsQ0FBQyxlQUFlLEVBQUUsY0FBYyxFQUFFLGlCQUFpQixFQUFFLGFBQWEsRUFBRSxjQUFjLENBQUM7WUFDN0YsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLFlBQVksQ0FBQztTQUM3RSxDQUFDO1FBRUYsZ0JBQWdCO1FBQ2hCLE1BQU0scUJBQXFCLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLHdCQUF3QixDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQ3RELEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDakQsQ0FBQztRQUVGLE1BQU0sd0JBQXdCLEdBQUcsQ0FBQyxJQUFtQixFQUFFLEVBQUU7WUFDdkQsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDMUIsd0JBQXdCO1lBQ3hCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUN6QixJQUFJLHFCQUFxQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFDMUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzdCLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQztRQUVGLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdkIsSUFBSSxlQUFlLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUN4Qyx3QkFBd0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxXQUFXO1FBQ1gsTUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUN2QyxNQUFNLG1CQUFtQixHQUFHLENBQUMsSUFBbUIsRUFBRSxFQUFFO1lBQ2xELFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUM7UUFDRixTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVyRCx5QkFBeUI7UUFDekIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRTtZQUM5QixJQUFJLFVBQVUsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztnQkFDN0IsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2xDLENBQUM7aUJBQU0sQ0FBQztnQkFDTixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEMsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsb0JBQW9CO1FBQ3BCLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDOUUsTUFBTSxvQkFBb0IsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDaEcsTUFBTSxvQkFBb0IsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVoSCxhQUFhO1FBQ2IsK0JBQStCO1FBQy9CLE1BQU0sWUFBWSxHQUFHLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEUsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQzFCLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUNyRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUVyQixVQUFVO1FBQ1YsTUFBTSxXQUFXLEdBQWlCLEVBQUUsQ0FBQztRQUNyQyxJQUFJLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFLENBQUM7WUFDbEQsV0FBVyxDQUFDLElBQUksQ0FBQztnQkFDZixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLE1BQU0sRUFBRSxNQUFNO2dCQUNkLFdBQVcsRUFBRSxxQkFBcUI7YUFDbkMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUNELElBQUksa0JBQWtCLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQztZQUNuRCxXQUFXLENBQUMsSUFBSSxDQUFDO2dCQUNmLElBQUksRUFBRSxVQUFVO2dCQUNoQixRQUFRLEVBQUUsUUFBUTtnQkFDbEIsTUFBTSxFQUFFLFFBQVE7Z0JBQ2hCLFdBQVcsRUFBRSw0QkFBNEI7YUFDMUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELE9BQU87WUFDTCxNQUFNLEVBQUUsVUFBVTtZQUNsQixTQUFTLEVBQUUsQ0FBQyxHQUFHLGdCQUFnQixFQUFFLEdBQUcsa0JBQWtCLENBQUM7WUFDdkQsZ0JBQWdCO1lBQ2hCLGtCQUFrQjtZQUNsQixRQUFRLEVBQUUsb0JBQW9CO1lBQzlCLHFCQUFxQixFQUFFO2dCQUNyQixnQkFBZ0I7Z0JBQ2hCLGtCQUFrQjtnQkFDbEIsUUFBUSxFQUFFLG9CQUFvQjthQUMvQjtTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLHdCQUF3QixDQUM1QixZQUFvQixFQUNwQixHQUFZLEVBQ1osUUFBK0I7UUFFL0IsTUFBTSxXQUFXLEdBQWlCLEVBQUUsQ0FBQztRQUVyQywrQkFBK0I7UUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN2QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksNkNBQXFCLEVBQUUsQ0FBQztRQUNsRCxDQUFDO1FBRUQsVUFBVTtRQUNWLElBQUksTUFBTSxHQUEyQixJQUFJLENBQUM7UUFDMUMsS0FBSyxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQ3ZDLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztnQkFDdEMsTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDM0QsTUFBTTtZQUNSLENBQUM7UUFDSCxDQUFDO1FBRUQsWUFBWTtRQUNaLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssZ0JBQWdCLEVBQUUsQ0FBQztZQUNqRCxXQUFXLENBQUMsSUFBSSxDQUFDO2dCQUNmLElBQUksRUFBRSxVQUFVO2dCQUNoQixRQUFRLEVBQUUsVUFBVTtnQkFDcEIsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLFdBQVcsRUFBRSx1QkFBdUI7YUFDckMsQ0FBQyxDQUFDO1lBQ0gsV0FBVyxDQUFDLElBQUksQ0FBQztnQkFDZixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsUUFBUSxFQUFFLFVBQVU7Z0JBQ3BCLE1BQU0sRUFBRSxVQUFVO2dCQUNsQixXQUFXLEVBQUUsNEJBQTRCO2FBQzFDLENBQUMsQ0FBQztZQUNILFdBQVcsQ0FBQyxJQUFJLENBQUM7Z0JBQ2YsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixNQUFNLEVBQUUsTUFBTTtnQkFDZCxXQUFXLEVBQUUsMEJBQTBCO2FBQ3hDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxZQUFZO1FBQ1osSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUMxQyxXQUFXLENBQUMsSUFBSSxDQUFDO2dCQUNmLElBQUksRUFBRSxhQUFhO2dCQUNuQixRQUFRLEVBQUUsVUFBVTtnQkFDcEIsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLFdBQVcsRUFBRSwwQkFBMEI7YUFDeEMsQ0FBQyxDQUFDO1lBQ0gsV0FBVyxDQUFDLElBQUksQ0FBQztnQkFDZixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsUUFBUSxFQUFFLFVBQVU7Z0JBQ3BCLE1BQU0sRUFBRSxVQUFVO2dCQUNsQixXQUFXLEVBQUUsNEJBQTRCO2FBQzFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxPQUFPLFdBQVcsQ0FBQztJQUNyQixDQUFDO0NBQ0Y7QUExNUJELGtEQTA1QkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9pbnRlbnQtYW5hbHlzaXMvVGVzdEludGVudEV4dHJhY3Rvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3QgSW50ZW50IEV4dHJhY3RvclxuICogdjAuOS4wIC0g44OG44K544OI6KiY6L+w44GL44KJ5oSP5Zuz44KS5oq95Ye6XG4gKiBUREQ6IEdyZWVuIFBoYXNlIC0g44OG44K544OI44KS6YCa44GZ5pyA5bCP6ZmQ44Gu5a6f6KOFXG4gKi9cblxuaW1wb3J0IHsgXG4gIElUZXN0SW50ZW50QW5hbHl6ZXIsXG4gIFRlc3RJbnRlbnQsXG4gIFRlc3RUeXBlLFxuICBDb3ZlcmFnZVNjb3BlLFxuICBBY3R1YWxUZXN0QW5hbHlzaXMsXG4gIFRlc3RSZWFsaXphdGlvblJlc3VsdCxcbiAgVGVzdEdhcCxcbiAgSW50ZW50Umlza0xldmVsLFxuICBUZXN0QXNzZXJ0aW9uLFxuICBHYXBUeXBlLFxuICBTZXZlcml0eVxufSBmcm9tICcuL0lUZXN0SW50ZW50QW5hbHl6ZXInO1xuXG4vLyBUeXBlIGRlZmluaXRpb25zIGZvciBhbmFseXNpcyByZXN1bHRzXG5pbnRlcmZhY2UgVGVzdFNjZW5hcmlvIHtcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGNvbnRleHQ/OiBzdHJpbmc7XG4gIHRlc3RDYXNlcz86IHN0cmluZ1tdO1xuICBnaXZlbj86IHN0cmluZztcbiAgd2hlbj86IHN0cmluZztcbiAgdGhlbj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIERvbWFpbkdhcCB7XG4gIHR5cGU6IHN0cmluZztcbiAgZG9tYWluOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHJlY29tbWVuZGF0aW9uPzogc3RyaW5nO1xuICBzZXZlcml0eTogU2V2ZXJpdHk7XG59XG5cbmludGVyZmFjZSBCdXNpbmVzc01hcHBpbmcge1xuICBkb21haW46IHN0cmluZztcbiAgZnVuY3Rpb25zOiBzdHJpbmdbXTtcbiAgY292ZXJlZEZ1bmN0aW9uczogc3RyaW5nW107XG4gIHVuY292ZXJlZEZ1bmN0aW9uczogc3RyaW5nW107XG4gIGNvdmVyYWdlOiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBTdWdnZXN0aW9uIHtcbiAgdHlwZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBwcmlvcml0eTogc3RyaW5nO1xuICBpbXBhY3Q6IHN0cmluZztcbiAgZXhhbXBsZT86IHN0cmluZztcbn1cbmltcG9ydCB7IENvcmVUeXBlcywgVHlwZUd1YXJkcywgVHlwZVV0aWxzIH0gZnJvbSAnLi4vY29yZS90eXBlcy9jb3JlLWRlZmluaXRpb25zJztcbmltcG9ydCB7IEFTVE5vZGUgfSBmcm9tICcuLi9jb3JlL2ludGVyZmFjZXMvSUFuYWx5c2lzRW5naW5lJztcbmltcG9ydCB7IFRyZWVTaXR0ZXJQYXJzZXIgfSBmcm9tICcuL1RyZWVTaXR0ZXJQYXJzZXInO1xuaW1wb3J0IHsgSW50ZW50UGF0dGVybk1hdGNoZXIgfSBmcm9tICcuL0ludGVudFBhdHRlcm5NYXRjaGVyJztcbmltcG9ydCB7IERvbWFpbkluZmVyZW5jZUVuZ2luZSB9IGZyb20gJy4vRG9tYWluSW5mZXJlbmNlRW5naW5lJztcbmltcG9ydCB7IEJ1c2luZXNzTG9naWNNYXBwZXIgfSBmcm9tICcuL0J1c2luZXNzTG9naWNNYXBwZXInO1xuaW1wb3J0IHsgVHlwZUluZm8sIENhbGxHcmFwaE5vZGUgfSBmcm9tICcuL0lUeXBlU2NyaXB0QW5hbHl6ZXInO1xuaW1wb3J0IHsgRG9tYWluSW5mZXJlbmNlIH0gZnJvbSAnLi9JRG9tYWluSW5mZXJlbmNlRW5naW5lJztcblxuLyoqXG4gKiDjg4bjgrnjg4jmhI/lm7Pmir3lh7rjgqjjg7Pjgrjjg7NcbiAqIHYwLjkuMCBQaGFzZSAyIC0g6auY5bqm44Gq5oSP5Zuz5o6o6KuW5qmf6IO944KS6L+95YqgXG4gKi9cbmV4cG9ydCBjbGFzcyBUZXN0SW50ZW50RXh0cmFjdG9yIGltcGxlbWVudHMgSVRlc3RJbnRlbnRBbmFseXplciB7XG4gIHByaXZhdGUgcGF0dGVybk1hdGNoZXI6IEludGVudFBhdHRlcm5NYXRjaGVyO1xuICBwcml2YXRlIHBhcnNlcjogVHJlZVNpdHRlclBhcnNlcjtcbiAgcHJpdmF0ZSBkb21haW5FbmdpbmU/OiBEb21haW5JbmZlcmVuY2VFbmdpbmU7XG4gIHByaXZhdGUgYnVzaW5lc3NNYXBwZXI/OiBCdXNpbmVzc0xvZ2ljTWFwcGVyO1xuICBcbiAgY29uc3RydWN0b3IocGFyc2VyPzogVHJlZVNpdHRlclBhcnNlcikge1xuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyIHx8IFRyZWVTaXR0ZXJQYXJzZXIuZ2V0SW5zdGFuY2UoKTtcbiAgICB0aGlzLnBhdHRlcm5NYXRjaGVyID0gbmV3IEludGVudFBhdHRlcm5NYXRjaGVyKCk7XG4gIH1cblxuICAvKipcbiAgICog44OG44K544OI44OV44Kh44Kk44Or44GL44KJ5oSP5Zuz44KS5oq95Ye6XG4gICAqIFlBR05J5Y6f5YmHOiDnj77mmYLngrnjgaflv4XopoHjgarmnIDlsI/pmZDjga7lrp/oo4VcbiAgICovXG4gIGFzeW5jIGV4dHJhY3RJbnRlbnQodGVzdEZpbGVQYXRoOiBzdHJpbmcsIGFzdDogQVNUTm9kZSk6IFByb21pc2U8VGVzdEludGVudD4ge1xuICAgIC8vIOODhuOCueODiOmWouaVsOOCkuaknOe0olxuICAgIGNvbnN0IHRlc3RGdW5jdGlvbnMgPSB0aGlzLnBhcnNlci5maW5kVGVzdEZ1bmN0aW9ucyhhc3QpO1xuICAgIFxuICAgIGlmICh0ZXN0RnVuY3Rpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRGVmYXVsdEludGVudCgpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpcnN0VGVzdCA9IHRlc3RGdW5jdGlvbnNbMF07XG4gICAgY29uc3QgZGVzY3JpcHRpb24gPSB0aGlzLmV4dHJhY3RUZXN0RGVzY3JpcHRpb24oZmlyc3RUZXN0KTtcbiAgICBjb25zdCB0YXJnZXRNZXRob2QgPSB0aGlzLmV4dHJhY3RUYXJnZXRNZXRob2QoZmlyc3RUZXN0KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgJ+S4jeaYjuOBquODhuOCueODiCcsXG4gICAgICB0YXJnZXRNZXRob2QsXG4gICAgICB0ZXN0VHlwZTogdGhpcy5kZXRlY3RUZXN0VHlwZShmaXJzdFRlc3QpLFxuICAgICAgZXhwZWN0ZWRCZWhhdmlvcjogdGhpcy5leHRyYWN0RXhwZWN0ZWRCZWhhdmlvcihkZXNjcmlwdGlvbiwgdGFyZ2V0TWV0aG9kKSxcbiAgICAgIGNvdmVyYWdlU2NvcGU6IHRoaXMuY3JlYXRlRGVmYXVsdENvdmVyYWdlU2NvcGUoKSxcbiAgICAgIHNjZW5hcmlvOiB0aGlzLmV4dHJhY3RTY2VuYXJpbyhhc3QsIGZpcnN0VGVzdClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOODhuOCueODiOOBruiqrOaYjuaWh+OCkuaKveWHulxuICAgKiBLSVNT5Y6f5YmHOiDmraPopo/ooajnj77jgafnm7TmjqXmir3lh7pcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdFRlc3REZXNjcmlwdGlvbih0ZXN0Tm9kZTogQVNUTm9kZSk6IHN0cmluZyB7XG4gICAgLy8gaXQoKSDjgb7jgZ/jga8gdGVzdCgpIOOBruesrOS4gOW8leaVsOOBruaWh+Wtl+WIl+OCkuato+imj+ihqOePvuOBp+aKveWHulxuICAgIGNvbnN0IG1hdGNoID0gdGVzdE5vZGUudGV4dC5tYXRjaCgvKD86aXR8dGVzdClcXHMqXFwoXFxzKlsnXCJgXShbXidcImBdKylbJ1wiYF0vKTtcbiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnO1xuICB9XG5cbiAgLyoqXG4gICAqIOODhuOCueODiOWvvuixoeOBruODoeOCveODg+ODieWQjeOCkuaKveWHulxuICAgKiBEUlnljp/liYc6IOWFsemAmuODkeOCv+ODvOODs+OBruaKveWHulxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0VGFyZ2V0TWV0aG9kKHRlc3ROb2RlOiBBU1ROb2RlKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAvLyDjg4bjgrnjg4jjgrPjg7zjg4nlhajkvZPjgYvjgonplqLmlbDlkbzjgbPlh7rjgZfjgpLmpJzntKJcbiAgICBjb25zdCB0ZXN0VGV4dCA9IHRlc3ROb2RlLnRleHQ7XG4gICAgXG4gICAgLy8gZXhwZWN05paH44Gu5YmN44Gr44GC44KL6Zai5pWw5ZG844Gz5Ye644GX44KS5o6i44GZXG4gICAgY29uc3QgZXhwZWN0SW5kZXggPSB0ZXN0VGV4dC5pbmRleE9mKCdleHBlY3QnKTtcbiAgICBpZiAoZXhwZWN0SW5kZXggPiAwKSB7XG4gICAgICBjb25zdCBiZWZvcmVFeHBlY3QgPSB0ZXN0VGV4dC5zdWJzdHJpbmcoMCwgZXhwZWN0SW5kZXgpO1xuICAgICAgXG4gICAgICAvLyDplqLmlbDlkbzjgbPlh7rjgZfjg5Hjgr/jg7zjg7M6IHdvcmQoXG4gICAgICBjb25zdCBmdW5jTWF0Y2ggPSBiZWZvcmVFeHBlY3QubWF0Y2goLyhcXHcrKVxccypcXCgvZyk7XG4gICAgICBpZiAoZnVuY01hdGNoKSB7XG4gICAgICAgIC8vIOacgOW+jOOBrumWouaVsOWRvOOBs+WHuuOBl+OCkuWPluW+l1xuICAgICAgICBjb25zdCBsYXN0TWF0Y2ggPSBmdW5jTWF0Y2hbZnVuY01hdGNoLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBmdW5jTmFtZSA9IGxhc3RNYXRjaC5tYXRjaCgvKFxcdyspXFxzKlxcKC8pO1xuICAgICAgICBpZiAoZnVuY05hbWUgJiYgZnVuY05hbWVbMV0gIT09ICdjb25zdCcgJiYgZnVuY05hbWVbMV0gIT09ICdsZXQnICYmIGZ1bmNOYW1lWzFdICE9PSAndmFyJykge1xuICAgICAgICAgIHJldHVybiBmdW5jTmFtZVsxXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDjg6Hjgr3jg4Pjg4nlkbzjgbPlh7rjgZfjg5Hjgr/jg7zjg7M6IG9iamVjdC5tZXRob2QoXG4gICAgICBjb25zdCBtZXRob2RNYXRjaCA9IGJlZm9yZUV4cGVjdC5tYXRjaCgvXFwuKFxcdyspXFxzKlxcKC9nKTtcbiAgICAgIGlmIChtZXRob2RNYXRjaCkge1xuICAgICAgICAvLyDmnIDlvozjga7jg6Hjgr3jg4Pjg4nlkbzjgbPlh7rjgZfjgpLlj5blvpdcbiAgICAgICAgY29uc3QgbGFzdE1ldGhvZCA9IG1ldGhvZE1hdGNoW21ldGhvZE1hdGNoLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBtZXRob2ROYW1lID0gbGFzdE1ldGhvZC5tYXRjaCgvXFwuKFxcdyspXFxzKlxcKC8pO1xuICAgICAgICBpZiAobWV0aG9kTmFtZSkge1xuICAgICAgICAgIHJldHVybiBtZXRob2ROYW1lWzFdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICog44Ki44K144O844K344On44Oz5YmN44Gu44Oh44K944OD44OJ5ZG844Gz5Ye644GX44KS5qSc57SiXG4gICAqIEtJU1Pljp/liYc6IOato+imj+ihqOePvuOBp+ewoea9lOOBq+Wun+ijhVxuICAgKi9cbiAgcHJpdmF0ZSBmaW5kTWV0aG9kQ2FsbEJlZm9yZUFzc2VydGlvbihhc3NlcnRpb25Ob2RlOiBBU1ROb2RlKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAvLyBleHBlY3Tjga7liY3jgavjgYLjgovjg6Hjgr3jg4Pjg4nlkbzjgbPlh7rjgZfjgpLmraPopo/ooajnj77jgafmpJzntKJcbiAgICBjb25zdCBiZWZvcmVFeHBlY3QgPSBhc3NlcnRpb25Ob2RlLnRleHQuc3BsaXQoJ2V4cGVjdCcpWzBdO1xuICAgIGlmIChiZWZvcmVFeHBlY3QpIHtcbiAgICAgIC8vIOmWouaVsOWRvOOBs+WHuuOBl+ODkeOCv+ODvOODszogd29yZChcbiAgICAgIGNvbnN0IG1hdGNoID0gYmVmb3JlRXhwZWN0Lm1hdGNoKC8oXFx3KylcXHMqXFwoLyk7XG4gICAgICBpZiAobWF0Y2ggJiYgbWF0Y2hbMV0gIT09ICdjb25zdCcgJiYgbWF0Y2hbMV0gIT09ICdsZXQnICYmIG1hdGNoWzFdICE9PSAndmFyJykge1xuICAgICAgICByZXR1cm4gbWF0Y2hbMV07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIOODoeOCveODg+ODieWRvOOBs+WHuuOBl+ODkeOCv+ODvOODszogb2JqZWN0Lm1ldGhvZChcbiAgICAgIGNvbnN0IG1ldGhvZE1hdGNoID0gYmVmb3JlRXhwZWN0Lm1hdGNoKC9cXC4oXFx3KylcXHMqXFwoLyk7XG4gICAgICBpZiAobWV0aG9kTWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIG1ldGhvZE1hdGNoWzFdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIOODhuOCueODiOOCv+OCpOODl+OCkuaknOWHulxuICAgKiBLSVNT5Y6f5YmHOiDjgrfjg7Pjg5fjg6vjgarjg5Ljg6Xjg7zjg6rjgrnjg4bjgqPjg4Pjgq9cbiAgICovXG4gIHByaXZhdGUgZGV0ZWN0VGVzdFR5cGUodGVzdE5vZGU6IEFTVE5vZGUpOiBUZXN0VHlwZSB7XG4gICAgY29uc3QgdGVzdFRleHQgPSB0ZXN0Tm9kZS50ZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgXG4gICAgLy8g56m644Gu44OG44K544OI44Gu5aC05ZCI44GvVU5LTk9XTlxuICAgIGlmICghdGVzdFRleHQudHJpbSgpIHx8IHRlc3RUZXh0Lm1hdGNoKC9pdFxccypcXChcXHMqWydcImBdWydcImBdLykpIHtcbiAgICAgIHJldHVybiBUZXN0VHlwZS5VTktOT1dOO1xuICAgIH1cbiAgICBcbiAgICBpZiAodGVzdFRleHQuaW5jbHVkZXMoJ2ludGVncmF0aW9uJykpIHJldHVybiBUZXN0VHlwZS5JTlRFR1JBVElPTjtcbiAgICBpZiAodGVzdFRleHQuaW5jbHVkZXMoJ2UyZScpKSByZXR1cm4gVGVzdFR5cGUuRTJFO1xuICAgIGlmICh0ZXN0VGV4dC5pbmNsdWRlcygncGVyZm9ybWFuY2UnKSkgcmV0dXJuIFRlc3RUeXBlLlBFUkZPUk1BTkNFO1xuICAgIGlmICh0ZXN0VGV4dC5pbmNsdWRlcygnc2VjdXJpdHknKSkgcmV0dXJuIFRlc3RUeXBlLlNFQ1VSSVRZO1xuICAgIFxuICAgIHJldHVybiBUZXN0VHlwZS5VTklUO1xuICB9XG5cbiAgLyoqXG4gICAqIOacn+W+heOBleOCjOOCi+WLleS9nOOCkuaKveWHulxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0RXhwZWN0ZWRCZWhhdmlvcihkZXNjcmlwdGlvbjogc3RyaW5nLCB0YXJnZXRNZXRob2Q/OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYmVoYXZpb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGlmIChkZXNjcmlwdGlvbiAmJiB0YXJnZXRNZXRob2QpIHtcbiAgICAgIC8vIOOAjHNob3VsZCBhZGQgdHdvIG51bWJlcnMgY29ycmVjdGx544CN44OR44K/44O844OzXG4gICAgICBpZiAoZGVzY3JpcHRpb24uaW5jbHVkZXMoJ2FkZCcpICYmIGRlc2NyaXB0aW9uLmluY2x1ZGVzKCdudW1iZXJzJykpIHtcbiAgICAgICAgYmVoYXZpb3JzLnB1c2goJ+ato+OBl+OBjzLjgaTjga7mlbDlgKTjgpLliqDnrpfjgZnjgosnKTtcbiAgICAgIH1cbiAgICAgIC8vIOOAjGNyZWF0ZXMgYSBuZXcgdXNlcuOAjeODkeOCv+ODvOODs1xuICAgICAgZWxzZSBpZiAoZGVzY3JpcHRpb24uaW5jbHVkZXMoJ2NyZWF0ZScpICYmIGRlc2NyaXB0aW9uLmluY2x1ZGVzKCd1c2VyJykpIHtcbiAgICAgICAgYmVoYXZpb3JzLnB1c2goJ+aWsOOBl+OBhOODpuODvOOCtuODvOOCkuS9nOaIkOOBmeOCiycpO1xuICAgICAgfVxuICAgICAgLy8g44OH44OV44Kp44Or44OI44OR44K/44O844OzOiBkZXNjcmlwdGlvbuOBq+WfuuOBpeOBj+WLleS9nOeUn+aIkFxuICAgICAgZWxzZSBpZiAoZGVzY3JpcHRpb24udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2hvdWxkJykpIHtcbiAgICAgICAgYmVoYXZpb3JzLnB1c2godGhpcy5nZW5lcmF0ZUJlaGF2aW9yRnJvbURlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBiZWhhdmlvcnM7XG4gIH1cblxuICAvKipcbiAgICog6Kqs5piO5paH44GL44KJ5YuV5L2c44KS55Sf5oiQXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQmVoYXZpb3JGcm9tRGVzY3JpcHRpb24oZGVzY3JpcHRpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8g5Z+65pys55qE44Gq6Iux6Kqe4oaS5pel5pys6Kqe5aSJ5o+b44Ot44K444OD44KvXG4gICAgaWYgKGRlc2NyaXB0aW9uLmluY2x1ZGVzKCdhZGQnKSAmJiBkZXNjcmlwdGlvbi5pbmNsdWRlcygnY29ycmVjdGx5JykpIHtcbiAgICAgIHJldHVybiAn5q2j44GX44GPMuOBpOOBruaVsOWApOOCkuWKoOeul+OBmeOCiyc7XG4gICAgfVxuICAgIGlmIChkZXNjcmlwdGlvbi5pbmNsdWRlcygnY3JlYXRlJykpIHtcbiAgICAgIHJldHVybiAn5paw6KaP5L2c5oiQ5Yem55CG44KS5a6f6KGM44GZ44KLJztcbiAgICB9XG4gICAgaWYgKGRlc2NyaXB0aW9uLmluY2x1ZGVzKCdlcnJvcicpKSB7XG4gICAgICByZXR1cm4gJ+OCqOODqeODvOOCkumBqeWIh+OBq+WHpueQhuOBmeOCiyc7XG4gICAgfVxuICAgIHJldHVybiAn5pyf5b6F44GV44KM44KL5YuV5L2c44KS5a6f6KGM44GZ44KLJztcbiAgfVxuXG4gIC8qKlxuICAgKiDjg4bjgrnjg4jjgrfjg4rjg6rjgqrjgpLmir3lh7pcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdFNjZW5hcmlvKGFzdDogQVNUTm9kZSwgdGVzdE5vZGU6IEFTVE5vZGUpOiBUZXN0U2NlbmFyaW8gfCB1bmRlZmluZWQge1xuICAgIC8vIGRlc2NyaWJl44OW44Ot44OD44Kv44KS5o6i44GZXG4gICAgY29uc3QgZGVzY3JpYmVCbG9jayA9IHRoaXMuZmluZFBhcmVudERlc2NyaWJlKGFzdCwgdGVzdE5vZGUpO1xuICAgIFxuICAgIGlmIChkZXNjcmliZUJsb2NrKSB7XG4gICAgICBjb25zdCBjb250ZXh0ID0gdGhpcy5leHRyYWN0RGVzY3JpYmVDb250ZXh0KGRlc2NyaWJlQmxvY2spO1xuICAgICAgaWYgKGNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB3aGVuOiBjb250ZXh0XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICog6Kaq44GuZGVzY3JpYmXjg5bjg63jg4Pjgq/jgpLmpJzntKJcbiAgICovXG4gIHByaXZhdGUgZmluZFBhcmVudERlc2NyaWJlKGFzdDogQVNUTm9kZSwgdGFyZ2V0Tm9kZTogQVNUTm9kZSk6IEFTVE5vZGUgfCB1bmRlZmluZWQge1xuICAgIC8vIOOBvuOBmuOAgWRlc2NyaWJl44OO44O844OJ44KS5YWo44Gm5Y+O6ZuGXG4gICAgY29uc3QgZGVzY3JpYmVOb2RlczogQVNUTm9kZVtdID0gW107XG4gICAgXG4gICAgY29uc3QgY29sbGVjdERlc2NyaWJlcyA9IChub2RlOiBBU1ROb2RlKTogdm9pZCA9PiB7XG4gICAgICBpZiAobm9kZS50eXBlID09PSAnY2FsbF9leHByZXNzaW9uJyAmJiBub2RlLnRleHQgJiYgbm9kZS50ZXh0LnN0YXJ0c1dpdGgoJ2Rlc2NyaWJlKCcpKSB7XG4gICAgICAgIGRlc2NyaWJlTm9kZXMucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLmNoaWxkcmVuKSB7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgIGNvbGxlY3REZXNjcmliZXMoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICBcbiAgICBjb2xsZWN0RGVzY3JpYmVzKGFzdCk7XG4gICAgXG4gICAgLy8gdGFyZ2V0Tm9kZeOCkuWQq+OCgOacgOOCgui/keOBhGRlc2NyaWJl44OW44Ot44OD44Kv44KS5o6i44GZXG4gICAgZm9yIChjb25zdCBkZXNjcmliZU5vZGUgb2YgZGVzY3JpYmVOb2Rlcykge1xuICAgICAgaWYgKHRoaXMuY29udGFpbnNOb2RlKGRlc2NyaWJlTm9kZSwgdGFyZ2V0Tm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIGRlc2NyaWJlTm9kZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiDjg47jg7zjg4njgYzliKXjga7jg47jg7zjg4njgpLlkKvjgoDjgYvjg4Hjgqfjg4Pjgq9cbiAgICovXG4gIHByaXZhdGUgY29udGFpbnNOb2RlKHBhcmVudDogQVNUTm9kZSwgdGFyZ2V0OiBBU1ROb2RlKTogYm9vbGVhbiB7XG4gICAgaWYgKHBhcmVudCA9PT0gdGFyZ2V0KSByZXR1cm4gdHJ1ZTtcbiAgICBcbiAgICAvLyDjg4bjgq3jgrnjg4jjg5njg7zjgrnjga7ljIXlkKvjg4Hjgqfjg4Pjgq/vvIjkvY3nva7mg4XloLHjgYzjgarjgYTloLTlkIjvvIlcbiAgICBpZiAocGFyZW50LnRleHQgJiYgdGFyZ2V0LnRleHQgJiYgcGFyZW50LnRleHQuaW5jbHVkZXModGFyZ2V0LnRleHQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHBhcmVudC5jaGlsZHJlbikge1xuICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiBwYXJlbnQuY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKHRoaXMuY29udGFpbnNOb2RlKGNoaWxkLCB0YXJnZXQpKSByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIGRlc2NyaWJl44OW44Ot44OD44Kv44GL44KJ44Kz44Oz44OG44Kt44K544OI44KS5oq95Ye6XG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3REZXNjcmliZUNvbnRleHQoZGVzY3JpYmVOb2RlOiBBU1ROb2RlKTogc3RyaW5nIHtcbiAgICAvLyDmnIDpganljJbjgZXjgozjgZ9BU1TjgafjgoLjg4bjgq3jgrnjg4jjgYzlj5blvpfjgafjgY3jgovjgojjgYbjgavjgZnjgotcbiAgICBjb25zdCBtYXRjaCA9IGRlc2NyaWJlTm9kZS50ZXh0Lm1hdGNoKC9kZXNjcmliZVxccypcXChcXHMqWydcImBdKFteJ1wiYF0rKVsnXCJgXS8pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmV0dXJuIG1hdGNoWzFdO1xuICAgIH1cbiAgICBcbiAgICAvLyDjg5Xjgqnjg7zjg6vjg5Djg4Pjgq86IOWtkOODjuODvOODieOCkuaOoue0olxuICAgIGlmIChkZXNjcmliZU5vZGUuY2hpbGRyZW4pIHtcbiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZGVzY3JpYmVOb2RlLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmIChjaGlsZC50eXBlID09PSAnYXJndW1lbnRzJyAmJiBjaGlsZC5jaGlsZHJlbikge1xuICAgICAgICAgIGNvbnN0IHN0cmluZ0xpdGVyYWwgPSBjaGlsZC5jaGlsZHJlbi5maW5kKGMgPT4gXG4gICAgICAgICAgICBjLnR5cGUgPT09ICdzdHJpbmcnIHx8IGMudHlwZSA9PT0gJ3RlbXBsYXRlX3N0cmluZydcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChzdHJpbmdMaXRlcmFsICYmIHN0cmluZ0xpdGVyYWwudGV4dCkge1xuICAgICAgICAgICAgcmV0dXJuIHN0cmluZ0xpdGVyYWwudGV4dC5yZXBsYWNlKC9eWydcImBdfFsnXCJgXSQvZywgJycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICAvKipcbiAgICog44OH44OV44Kp44Or44OI44Gu44Kr44OQ44Os44OD44K444K544Kz44O844OXXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZURlZmF1bHRDb3ZlcmFnZVNjb3BlKCk6IENvdmVyYWdlU2NvcGUge1xuICAgIHJldHVybiB7XG4gICAgICBoYXBweVBhdGg6IGZhbHNlLFxuICAgICAgZXJyb3JDYXNlczogZmFsc2UsXG4gICAgICBlZGdlQ2FzZXM6IGZhbHNlLFxuICAgICAgYm91bmRhcnlWYWx1ZXM6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjg4fjg5Xjgqnjg6vjg4jjga7jg4bjgrnjg4jmhI/lm7NcbiAgICogRGVmZW5zaXZlIFByb2dyYW1taW5nOiDjgqjjg6njg7zjgrHjg7zjgrnjga7lh6bnkIZcbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRGVmYXVsdEludGVudCgpOiBUZXN0SW50ZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgZGVzY3JpcHRpb246ICfkuI3mmI7jgarjg4bjgrnjg4gnLFxuICAgICAgdGVzdFR5cGU6IFRlc3RUeXBlLlVOS05PV04sXG4gICAgICBleHBlY3RlZEJlaGF2aW9yOiBbXSxcbiAgICAgIGNvdmVyYWdlU2NvcGU6IHRoaXMuY3JlYXRlRGVmYXVsdENvdmVyYWdlU2NvcGUoKVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICog5a6f6Zqb44Gu44OG44K544OI5a6f6KOF44KS5YiG5p6QXG4gICAqIFlBR05J5Y6f5YmHOiDlv4XopoHmnIDlsI/pmZDjga7lrp/oo4VcbiAgICovXG4gIGFzeW5jIGFuYWx5emVBY3R1YWxUZXN0KHRlc3RGaWxlUGF0aDogc3RyaW5nLCBhc3Q6IEFTVE5vZGUpOiBQcm9taXNlPEFjdHVhbFRlc3RBbmFseXNpcz4ge1xuICAgIC8vIOOCouOCteODvOOCt+ODp+ODs+OCkuaknOe0olxuICAgIGNvbnN0IGFzc2VydGlvbnMgPSB0aGlzLnBhcnNlci5maW5kQXNzZXJ0aW9ucyhhc3QpO1xuICAgIFxuICAgIC8vIOODhuOCueODiOOBleOCjOOBpuOBhOOCi+ODoeOCveODg+ODieOCkuaknOe0olxuICAgIGNvbnN0IGFjdHVhbFRhcmdldE1ldGhvZHMgPSB0aGlzLmV4dHJhY3RBY3R1YWxUYXJnZXRNZXRob2RzKGFzdCk7XG4gICAgXG4gICAgLy8g44Ki44K144O844K344On44Oz5oOF5aCx44KS5qeL56+JXG4gICAgY29uc3QgdGVzdEFzc2VydGlvbnM6IFRlc3RBc3NlcnRpb25bXSA9IGFzc2VydGlvbnMubWFwKChhc3NlcnRpb25Ob2RlLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgYXNzZXJ0aW9uSW5mbyA9IHRoaXMucGFyc2VBc3NlcnRpb24oYXNzZXJ0aW9uTm9kZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBhc3NlcnRpb25JbmZvLnR5cGUsXG4gICAgICAgIGV4cGVjdGVkOiBhc3NlcnRpb25JbmZvLmV4cGVjdGVkLFxuICAgICAgICBhY3R1YWw6IGFzc2VydGlvbkluZm8uYWN0dWFsLFxuICAgICAgICBsb2NhdGlvbjoge1xuICAgICAgICAgIGxpbmU6IGFzc2VydGlvbk5vZGUuc3RhcnRQb3NpdGlvbj8ucm93IHx8IGluZGV4LFxuICAgICAgICAgIGNvbHVtbjogYXNzZXJ0aW9uTm9kZS5zdGFydFBvc2l0aW9uPy5jb2x1bW4gfHwgMFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgLy8g44Kr44OQ44Os44OD44K444K544Kz44O844OX44KS5Yik5a6aXG4gICAgY29uc3QgdGVzdERlc2NyaXB0aW9ucyA9IHRoaXMuZXh0cmFjdFRlc3REZXNjcmlwdGlvbnMoYXN0KTtcbiAgICBjb25zdCBhY3R1YWxDb3ZlcmFnZSA9IHRoaXMucGF0dGVybk1hdGNoZXIuYW5hbHl6ZUNvdmVyYWdlU2NvcGUodGVzdERlc2NyaXB0aW9ucyk7XG5cbiAgICAvLyDopIfpm5HluqbjgpLoqIjnrpfvvIjjgrfjg7Pjg5fjg6vjgarlrp/oo4XvvIlcbiAgICBjb25zdCBjb21wbGV4aXR5ID0gdGhpcy5jYWxjdWxhdGVDb21wbGV4aXR5KGFzdCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWN0dWFsVGFyZ2V0TWV0aG9kcyxcbiAgICAgIGFzc2VydGlvbnM6IHRlc3RBc3NlcnRpb25zLFxuICAgICAgYWN0dWFsQ292ZXJhZ2UsXG4gICAgICBjb21wbGV4aXR5XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlgIvliKXjga7jg4bjgrnjg4jjgrHjg7zjgrnjgpLliIbmnpDjgZnjgovmlrDjgZfjgYTjg6Hjgr3jg4Pjg4lcbiAgICogU09MSUTljp/liYc6IOWNmOS4gOiyrOS7u+OBruWOn+WJh+OBq+W+k+OBhOOAgeWAi+WIpeODhuOCueODiOWIhuaekOOCkuWIhumbolxuICAgKi9cbiAgYXN5bmMgYW5hbHl6ZUluZGl2aWR1YWxUZXN0cyh0ZXN0RmlsZVBhdGg6IHN0cmluZywgYXN0OiBBU1ROb2RlKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBBY3R1YWxUZXN0QW5hbHlzaXM+PiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IG5ldyBNYXA8c3RyaW5nLCBBY3R1YWxUZXN0QW5hbHlzaXM+KCk7XG4gICAgXG4gICAgLy8g5YCL5Yil44GuaXQoKeODluODreODg+OCr+OCkuaknOe0olxuICAgIGNvbnN0IGNhbGxFeHByZXNzaW9ucyA9IHRoaXMucGFyc2VyLmZpbmROb2Rlcyhhc3QsICdjYWxsX2V4cHJlc3Npb24nKTtcbiAgICBjb25zdCB0ZXN0Tm9kZXMgPSBjYWxsRXhwcmVzc2lvbnMuZmlsdGVyKG5vZGUgPT4gXG4gICAgICBub2RlLnRleHQuc3RhcnRzV2l0aCgnaXQoJykgfHwgbm9kZS50ZXh0LnN0YXJ0c1dpdGgoJ3Rlc3QoJylcbiAgICApO1xuICAgIFxuICAgIGZvciAoY29uc3QgdGVzdE5vZGUgb2YgdGVzdE5vZGVzKSB7XG4gICAgICAvLyDjg4bjgrnjg4jjga7oqqzmmI7mlofjgpLmir3lh7pcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdGhpcy5leHRyYWN0VGVzdERlc2NyaXB0aW9uKHRlc3ROb2RlKTtcbiAgICAgIFxuICAgICAgLy8g44GT44Gu44OG44K544OI44Kx44O844K55YaF44Gu44Ki44K144O844K344On44Oz44Gu44G/44KS5qSc57SiXG4gICAgICBjb25zdCB0ZXN0QXNzZXJ0aW9ucyA9IHRoaXMucGFyc2VyLmZpbmRBc3NlcnRpb25zKHRlc3ROb2RlKTtcbiAgICAgIFxuICAgICAgLy8g44OG44K544OI44GV44KM44Gm44GE44KL44Oh44K944OD44OJ44KS5qSc57SiXG4gICAgICBjb25zdCBhY3R1YWxUYXJnZXRNZXRob2RzID0gdGhpcy5leHRyYWN0QWN0dWFsVGFyZ2V0TWV0aG9kcyh0ZXN0Tm9kZSk7XG4gICAgICBcbiAgICAgIC8vIOOCouOCteODvOOCt+ODp+ODs+aDheWgseOCkuani+eviVxuICAgICAgY29uc3QgYXNzZXJ0aW9uczogVGVzdEFzc2VydGlvbltdID0gdGVzdEFzc2VydGlvbnMubWFwKChhc3NlcnRpb25Ob2RlLCBpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBhc3NlcnRpb25JbmZvID0gdGhpcy5wYXJzZUFzc2VydGlvbihhc3NlcnRpb25Ob2RlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBhc3NlcnRpb25JbmZvLnR5cGUsXG4gICAgICAgICAgZXhwZWN0ZWQ6IGFzc2VydGlvbkluZm8uZXhwZWN0ZWQsXG4gICAgICAgICAgYWN0dWFsOiBhc3NlcnRpb25JbmZvLmFjdHVhbCxcbiAgICAgICAgICBsb2NhdGlvbjoge1xuICAgICAgICAgICAgbGluZTogYXNzZXJ0aW9uTm9kZS5zdGFydFBvc2l0aW9uPy5yb3cgfHwgaW5kZXgsXG4gICAgICAgICAgICBjb2x1bW46IGFzc2VydGlvbk5vZGUuc3RhcnRQb3NpdGlvbj8uY29sdW1uIHx8IDBcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8g5YCL5Yil44OG44K544OI44Gu5YiG5p6Q57WQ5p6c44KS5L+d5a2YXG4gICAgICByZXN1bHRzLnNldChkZXNjcmlwdGlvbiwge1xuICAgICAgICBhY3R1YWxUYXJnZXRNZXRob2RzLFxuICAgICAgICBhc3NlcnRpb25zLFxuICAgICAgICBhY3R1YWxDb3ZlcmFnZTogdGhpcy5jcmVhdGVEZWZhdWx0Q292ZXJhZ2VTY29wZSgpLFxuICAgICAgICBjb21wbGV4aXR5OiAxXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICog5a6f6Zqb44Gr44OG44K544OI44GV44KM44Gm44GE44KL44Oh44K944OD44OJ44KS5oq95Ye6XG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RBY3R1YWxUYXJnZXRNZXRob2RzKGFzdDogQVNUTm9kZSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBtZXRob2RzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHRlc3RGdW5jdGlvbnMgPSB0aGlzLnBhcnNlci5maW5kVGVzdEZ1bmN0aW9ucyhhc3QpO1xuXG4gICAgLy8g44OG44K544OI6Zai5pWw44GM44Gq44GE5aC05ZCI44CBQVNU5YWo5L2T44GL44KJ6Zai5pWw5ZG844Gz5Ye644GX44KS5oq95Ye6XG4gICAgaWYgKHRlc3RGdW5jdGlvbnMubGVuZ3RoID09PSAwICYmIGFzdC50ZXh0KSB7XG4gICAgICAvLyDjg4bjgq3jgrnjg4jjg5njg7zjgrnjga7plqLmlbDlkI3mir3lh7pcbiAgICAgIGNvbnN0IGZ1bmN0aW9uQ2FsbFBhdHRlcm4gPSAvKFxcdyspXFxzKlxcKC9nO1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IGFzdC50ZXh0Lm1hdGNoKGZ1bmN0aW9uQ2FsbFBhdHRlcm4pO1xuICAgICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKG1hdGNoID0+IHtcbiAgICAgICAgICBjb25zdCBmdW5jTmFtZSA9IG1hdGNoLnJlcGxhY2UoL1xccypcXCgvLCAnJyk7XG4gICAgICAgICAgLy8g44OG44K544OI55So44Gu44Kt44O844Ov44O844OJ44KS6Zmk5aSWXG4gICAgICAgICAgaWYgKCFbJ2Rlc2NyaWJlJywgJ2l0JywgJ3Rlc3QnLCAnZXhwZWN0JywgJ2Fzc2VydCcsICdiZWZvcmVFYWNoJywgJ2FmdGVyRWFjaCddLmluY2x1ZGVzKGZ1bmNOYW1lKSkge1xuICAgICAgICAgICAgaWYgKCFtZXRob2RzLmluY2x1ZGVzKGZ1bmNOYW1lKSkge1xuICAgICAgICAgICAgICBtZXRob2RzLnB1c2goZnVuY05hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGVzdEZ1bmN0aW9ucy5mb3JFYWNoKHRlc3ROb2RlID0+IHtcbiAgICAgIGNvbnN0IHRhcmdldE1ldGhvZCA9IHRoaXMuZXh0cmFjdFRhcmdldE1ldGhvZCh0ZXN0Tm9kZSk7XG4gICAgICBpZiAodGFyZ2V0TWV0aG9kICYmICFtZXRob2RzLmluY2x1ZGVzKHRhcmdldE1ldGhvZCkpIHtcbiAgICAgICAgbWV0aG9kcy5wdXNoKHRhcmdldE1ldGhvZCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbWV0aG9kcztcbiAgfVxuXG4gIC8qKlxuICAgKiDjgqLjgrXjg7zjgrfjg6fjg7PjgpLop6PmnpBcbiAgICovXG4gIHByaXZhdGUgcGFyc2VBc3NlcnRpb24oYXNzZXJ0aW9uTm9kZTogQVNUTm9kZSk6IHsgdHlwZTogc3RyaW5nOyBleHBlY3RlZDogc3RyaW5nOyBhY3R1YWw6IHN0cmluZyB9IHtcbiAgICBjb25zdCB0ZXh0ID0gYXNzZXJ0aW9uTm9kZS50ZXh0IHx8ICcnO1xuICAgIFxuICAgIC8vIGV4cGVjdCh4eHgpLnRvQmUoeXl5KSDjg5Hjgr/jg7zjg7NcbiAgICBjb25zdCBleHBlY3RNYXRjaCA9IHRleHQubWF0Y2goL2V4cGVjdFxcKChbXildKylcXClcXC4oXFx3KylcXCgoW14pXSopXFwpLyk7XG4gICAgaWYgKGV4cGVjdE1hdGNoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBleHBlY3RNYXRjaFsyXSwgLy8gdG9CZSwgdG9FcXVhbCwgZXRjLlxuICAgICAgICBleHBlY3RlZDogZXhwZWN0TWF0Y2hbM10sXG4gICAgICAgIGFjdHVhbDogZXhwZWN0TWF0Y2hbMV1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gYXNzZXJ0Lnh4eChhY3R1YWwsIGV4cGVjdGVkKSDjg5Hjgr/jg7zjg7NcbiAgICBjb25zdCBhc3NlcnRNYXRjaCA9IHRleHQubWF0Y2goL2Fzc2VydFxcLihcXHcrKVxcKChbXixdKyksXFxzKihbXildKylcXCkvKTtcbiAgICBpZiAoYXNzZXJ0TWF0Y2gpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IGFzc2VydE1hdGNoWzFdLFxuICAgICAgICBleHBlY3RlZDogYXNzZXJ0TWF0Y2hbM10sXG4gICAgICAgIGFjdHVhbDogYXNzZXJ0TWF0Y2hbMl1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICd1bmtub3duJyxcbiAgICAgIGV4cGVjdGVkOiAnJyxcbiAgICAgIGFjdHVhbDogJydcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOODhuOCueODiOOBruiqrOaYjuaWh+OCkuaKveWHulxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0VGVzdERlc2NyaXB0aW9ucyhhc3Q6IEFTVE5vZGUpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgZGVzY3JpcHRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHRlc3RGdW5jdGlvbnMgPSB0aGlzLnBhcnNlci5maW5kVGVzdEZ1bmN0aW9ucyhhc3QpO1xuXG4gICAgdGVzdEZ1bmN0aW9ucy5mb3JFYWNoKHRlc3ROb2RlID0+IHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gdGhpcy5leHRyYWN0VGVzdERlc2NyaXB0aW9uKHRlc3ROb2RlKTtcbiAgICAgIGlmIChkZXNjcmlwdGlvbikge1xuICAgICAgICBkZXNjcmlwdGlvbnMucHVzaChkZXNjcmlwdGlvbik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZGVzY3JpcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIOODhuOCueODiOOBruikh+mbkeW6puOCkuioiOeul1xuICAgKiBLSVNT5Y6f5YmHOiDjgrfjg7Pjg5fjg6vjgaroqIjnrpfmlrnms5VcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29tcGxleGl0eShhc3Q6IEFTVE5vZGUpOiBudW1iZXIge1xuICAgIGxldCBjb21wbGV4aXR5ID0gMTsgLy8g5Z+65pys6KSH6ZuR5bqmXG5cbiAgICBjb25zdCB0cmF2ZXJzZSA9IChub2RlOiBBU1ROb2RlKTogdm9pZCA9PiB7XG4gICAgICAvLyDmnaHku7bliIblspDjgpLmpJzlh7pcbiAgICAgIGlmIChub2RlLnR5cGUgPT09ICdpZl9zdGF0ZW1lbnQnIHx8IFxuICAgICAgICAgIG5vZGUudHlwZSA9PT0gJ3Rlcm5hcnlfZXhwcmVzc2lvbicgfHxcbiAgICAgICAgICBub2RlLnR5cGUgPT09ICdzd2l0Y2hfc3RhdGVtZW50Jykge1xuICAgICAgICBjb21wbGV4aXR5Kys7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIOODq+ODvOODl+OCkuaknOWHulxuICAgICAgaWYgKG5vZGUudHlwZSA9PT0gJ2Zvcl9zdGF0ZW1lbnQnIHx8XG4gICAgICAgICAgbm9kZS50eXBlID09PSAnd2hpbGVfc3RhdGVtZW50JyB8fFxuICAgICAgICAgIG5vZGUudHlwZSA9PT0gJ2RvX3N0YXRlbWVudCcpIHtcbiAgICAgICAgY29tcGxleGl0eSsrO1xuICAgICAgfVxuXG4gICAgICBpZiAobm9kZS5jaGlsZHJlbikge1xuICAgICAgICBub2RlLmNoaWxkcmVuLmZvckVhY2goY2hpbGQgPT4gdHJhdmVyc2UoY2hpbGQpKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdHJhdmVyc2UoYXN0KTtcbiAgICByZXR1cm4gY29tcGxleGl0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjg4bjgrnjg4jmhI/lm7Pjgajlrp/oo4Xjga7jgq7jg6Pjg4Pjg5fjgpLoqZXkvqFcbiAgICogS0lTU+WOn+WJhzog44K344Oz44OX44Or44Gq6KmV5L6h44Ot44K444OD44KvXG4gICAqL1xuICBhc3luYyBldmFsdWF0ZVJlYWxpemF0aW9uKFxuICAgIGludGVudDogVGVzdEludGVudCxcbiAgICBhY3R1YWw6IEFjdHVhbFRlc3RBbmFseXNpc1xuICApOiBQcm9taXNlPFRlc3RSZWFsaXphdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IGdhcHM6IFRlc3RHYXBbXSA9IFtdO1xuICAgIFxuICAgIC8vIDEuIOOCv+ODvOOCsuODg+ODiOODoeOCveODg+ODieOBruODgeOCp+ODg+OCr1xuICAgIGlmIChpbnRlbnQudGFyZ2V0TWV0aG9kICYmICFhY3R1YWwuYWN0dWFsVGFyZ2V0TWV0aG9kcy5pbmNsdWRlcyhpbnRlbnQudGFyZ2V0TWV0aG9kKSkge1xuICAgICAgZ2Fwcy5wdXNoKHtcbiAgICAgICAgdHlwZTogR2FwVHlwZS5XUk9OR19UQVJHRVQsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBg5pyf5b6F44GV44KM44KL44Oh44K944OD44OJICcke2ludGVudC50YXJnZXRNZXRob2R9JyDjgYzjg4bjgrnjg4jjgZXjgozjgabjgYTjgb7jgZvjgpNgLFxuICAgICAgICBzZXZlcml0eTogU2V2ZXJpdHkuSElHSCxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFtg44OG44K544OI44GrICR7aW50ZW50LnRhcmdldE1ldGhvZH0g44Gu5ZG844Gz5Ye644GX44KS6L+95Yqg44GX44Gm44GP44Gg44GV44GEYF1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIDIuIOOCq+ODkOODrOODg+OCuOOBruOCruODo+ODg+ODl+OCkuODgeOCp+ODg+OCr1xuICAgIGlmIChpbnRlbnQuY292ZXJhZ2VTY29wZS5lcnJvckNhc2VzICYmICFhY3R1YWwuYWN0dWFsQ292ZXJhZ2UuZXJyb3JDYXNlcykge1xuICAgICAgZ2Fwcy5wdXNoKHtcbiAgICAgICAgdHlwZTogR2FwVHlwZS5NSVNTSU5HX0VSUk9SX0NBU0UsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAn44Ko44Op44O844Kx44O844K544Gu44OG44K544OI44GM5LiN6Laz44GX44Gm44GE44G+44GZJyxcbiAgICAgICAgc2V2ZXJpdHk6IFNldmVyaXR5LkhJR0gsXG4gICAgICAgIHN1Z2dlc3Rpb25zOiBbXG4gICAgICAgICAgJ+OCqOODqeODvOOCkueZuueUn+OBleOBm+OCi+WFpeWKm+WApOOBp+OBruODhuOCueODiOOCkui/veWKoCcsXG4gICAgICAgICAgJ3RyeS1jYXRjaOODluODreODg+OCr+OBp+OBruOCqOODqeODvOODj+ODs+ODieODquODs+OCsOOCkuODhuOCueODiCdcbiAgICAgICAgXVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGludGVudC5jb3ZlcmFnZVNjb3BlLmVkZ2VDYXNlcyAmJiAhYWN0dWFsLmFjdHVhbENvdmVyYWdlLmVkZ2VDYXNlcykge1xuICAgICAgZ2Fwcy5wdXNoKHtcbiAgICAgICAgdHlwZTogR2FwVHlwZS5NSVNTSU5HX0VER0VfQ0FTRSxcbiAgICAgICAgZGVzY3JpcHRpb246ICfjgqjjg4PjgrjjgrHjg7zjgrnjga7jg4bjgrnjg4jjgYzkuI3otrPjgZfjgabjgYTjgb7jgZknLFxuICAgICAgICBzZXZlcml0eTogU2V2ZXJpdHkuTUVESVVNLFxuICAgICAgICBzdWdnZXN0aW9uczogW1xuICAgICAgICAgICfnqbrphY3liJfjgIFudWxs44CBdW5kZWZpbmVk44Gq44Gp44Gu54m55q6K44Gq5YCk44Gn44Gu44OG44K544OI44KS6L+95YqgJyxcbiAgICAgICAgICAn5aKD55WM5p2h5Lu244Gn44Gu44OG44K544OI44KS6L+95YqgJ1xuICAgICAgICBdXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyAzLiDjgqLjgrXjg7zjgrfjg6fjg7Pjga7lrZjlnKjjg4Hjgqfjg4Pjgq9cbiAgICBpZiAoYWN0dWFsLmFzc2VydGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBnYXBzLnB1c2goe1xuICAgICAgICB0eXBlOiBHYXBUeXBlLk1JU1NJTkdfQVNTRVJUSU9OLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+OCouOCteODvOOCt+ODp+ODs+OBjOWtmOWcqOOBl+OBvuOBm+OCkycsXG4gICAgICAgIHNldmVyaXR5OiBTZXZlcml0eS5DUklUSUNBTCxcbiAgICAgICAgc3VnZ2VzdGlvbnM6IFsnZXhwZWN05paH44G+44Gf44GvYXNzZXJ05paH44KS6L+95Yqg44GX44Gm44GP44Gg44GV44GEJ11cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIDQuIOWun+ePvuW6puOCueOCs+OCouOBruioiOeul1xuICAgIGNvbnN0IHJlYWxpemF0aW9uU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZVJlYWxpemF0aW9uU2NvcmUoaW50ZW50LCBhY3R1YWwsIGdhcHMpO1xuXG4gICAgLy8gNS4g44Oq44K544Kv44Os44OZ44Or44Gu6KmV5L6hXG4gICAgY29uc3Qgcmlza0xldmVsID0gdGhpcy5hc3Nlc3NSaXNrKGdhcHMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGludGVudCxcbiAgICAgIGFjdHVhbCxcbiAgICAgIGdhcHMsXG4gICAgICByZWFsaXphdGlvblNjb3JlLFxuICAgICAgcmlza0xldmVsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDlrp/nj77luqbjgrnjgrPjgqLjgpLoqIjnrpdcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlUmVhbGl6YXRpb25TY29yZShcbiAgICBpbnRlbnQ6IFRlc3RJbnRlbnQsXG4gICAgYWN0dWFsOiBBY3R1YWxUZXN0QW5hbHlzaXMsXG4gICAgZ2FwczogVGVzdEdhcFtdXG4gICk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMTAwO1xuXG4gICAgLy8g44Ku44Oj44OD44OX44GU44Go44Gr44K544Kz44Ki44KS5rib54K5XG4gICAgZ2Fwcy5mb3JFYWNoKGdhcCA9PiB7XG4gICAgICBzd2l0Y2ggKGdhcC5zZXZlcml0eSkge1xuICAgICAgICBjYXNlIFNldmVyaXR5LkNSSVRJQ0FMOlxuICAgICAgICAgIHNjb3JlIC09IDMwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNldmVyaXR5LkhJR0g6XG4gICAgICAgICAgc2NvcmUgLT0gMjA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgU2V2ZXJpdHkuTUVESVVNOlxuICAgICAgICAgIHNjb3JlIC09IDEwO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFNldmVyaXR5LkxPVzpcbiAgICAgICAgICBzY29yZSAtPSA1O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8g44Ki44K144O844K344On44Oz44Gu5pWw44Gr44KI44KL5Yqg54K5XG4gICAgaWYgKGFjdHVhbC5hc3NlcnRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIHNjb3JlID0gTWF0aC5taW4oc2NvcmUgKyBhY3R1YWwuYXNzZXJ0aW9ucy5sZW5ndGggKiAyLCAxMDApO1xuICAgIH1cblxuICAgIHJldHVybiBNYXRoLm1heCgwLCBzY29yZSk7XG4gIH1cblxuICAvKipcbiAgICog44Oq44K544Kv6KmV5L6hXG4gICAqIE5JU1Tjg6rjgrnjgq/oqZXkvqHjgrfjgrnjg4bjg6DjgpLlj4LogIPjgavjgrfjg7Pjg5fjg6vjgavlrp/oo4VcbiAgICovXG4gIGFzc2Vzc1Jpc2soZ2FwczogVGVzdEdhcFtdKTogSW50ZW50Umlza0xldmVsIHtcbiAgICBpZiAoZ2Fwcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBJbnRlbnRSaXNrTGV2ZWwuTUlOSU1BTDtcbiAgICB9XG5cbiAgICAvLyDmnIDjgoLph43opoHluqbjga7pq5jjgYTjgq7jg6Pjg4Pjg5fjgpLln7rmupbjgavjg6rjgrnjgq/jg6zjg5njg6vjgpLmsbrlrppcbiAgICBjb25zdCBzZXZlcml0aWVzID0gZ2Fwcy5tYXAoZ2FwID0+IGdhcC5zZXZlcml0eSk7XG4gICAgXG4gICAgaWYgKHNldmVyaXRpZXMuaW5jbHVkZXMoU2V2ZXJpdHkuQ1JJVElDQUwpKSB7XG4gICAgICByZXR1cm4gSW50ZW50Umlza0xldmVsLkNSSVRJQ0FMO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc2V2ZXJpdGllcy5pbmNsdWRlcyhTZXZlcml0eS5ISUdIKSkge1xuICAgICAgcmV0dXJuIEludGVudFJpc2tMZXZlbC5ISUdIO1xuICAgIH1cbiAgICBcbiAgICBpZiAoc2V2ZXJpdGllcy5pbmNsdWRlcyhTZXZlcml0eS5NRURJVU0pKSB7XG4gICAgICByZXR1cm4gSW50ZW50Umlza0xldmVsLk1FRElVTTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHNldmVyaXRpZXMuaW5jbHVkZXMoU2V2ZXJpdHkuTE9XKSkge1xuICAgICAgcmV0dXJuIEludGVudFJpc2tMZXZlbC5MT1c7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBJbnRlbnRSaXNrTGV2ZWwuTUlOSU1BTDtcbiAgfVxuXG4gIC8qKlxuICAgKiDlnovmg4XloLHjgpLmtLvnlKjjgZfjgZ/pq5jluqbjgaroqZXkvqFcbiAgICogdjAuOS4wIFBoYXNlIDIgLSBEb21haW5JbmZlcmVuY2VFbmdpbmXjgajjga7ntbHlkIhcbiAgICovXG4gIGFzeW5jIGV2YWx1YXRlUmVhbGl6YXRpb25XaXRoVHlwZUluZm8oXG4gICAgaW50ZW50OiBUZXN0SW50ZW50LFxuICAgIGFjdHVhbDogQWN0dWFsVGVzdEFuYWx5c2lzLFxuICAgIHR5cGVJbmZvOiBNYXA8c3RyaW5nLCBUeXBlSW5mbz5cbiAgKTogUHJvbWlzZTxUZXN0UmVhbGl6YXRpb25SZXN1bHQgJiB7IGRvbWFpblJlbGV2YW5jZT86IGFueTsgZG9tYWluU3BlY2lmaWNHYXBzPzogYW55W10gfT4ge1xuICAgIGlmICghdGhpcy5kb21haW5FbmdpbmUpIHtcbiAgICAgIHRoaXMuZG9tYWluRW5naW5lID0gbmV3IERvbWFpbkluZmVyZW5jZUVuZ2luZSgpO1xuICAgIH1cblxuICAgIC8vIOWfuuacrOOBruipleS+oee1kOaenOOCkuWPluW+l1xuICAgIGNvbnN0IGJhc2VSZXN1bHQgPSBhd2FpdCB0aGlzLmV2YWx1YXRlUmVhbGl6YXRpb24oaW50ZW50LCBhY3R1YWwpO1xuXG4gICAgLy8g5Z6L5oOF5aCx44GL44KJ44OJ44Oh44Kk44Oz44KS5o6o6KuWXG4gICAgY29uc3QgZG9tYWluSW5mZXJlbmNlczogRG9tYWluSW5mZXJlbmNlW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IFt2YXJOYW1lLCB0eXBlXSBvZiB0eXBlSW5mbykge1xuICAgICAgY29uc3QgaW5mZXJlbmNlID0gYXdhaXQgdGhpcy5kb21haW5FbmdpbmUuaW5mZXJEb21haW5Gcm9tVHlwZSh0eXBlKTtcbiAgICAgIGRvbWFpbkluZmVyZW5jZXMucHVzaChpbmZlcmVuY2UpO1xuICAgIH1cblxuICAgIC8vIOacgOOCguS/oemgvOW6puOBrumrmOOBhOODieODoeOCpOODs+OCkumBuOaKnlxuICAgIGNvbnN0IHByaW1hcnlEb21haW4gPSBkb21haW5JbmZlcmVuY2VzLnJlZHVjZSgocHJldiwgY3VycikgPT4gXG4gICAgICBjdXJyLmNvbmZpZGVuY2UgPiBwcmV2LmNvbmZpZGVuY2UgPyBjdXJyIDogcHJldlxuICAgICk7XG5cbiAgICAvLyDjg4njg6HjgqTjg7Plm7rmnInjga7jgq7jg6Pjg4Pjg5fjgpLmpJzlh7pcbiAgICBjb25zdCBkb21haW5TcGVjaWZpY0dhcHMgPSBhd2FpdCB0aGlzLmRldGVjdERvbWFpblNwZWNpZmljR2FwcyhcbiAgICAgIHByaW1hcnlEb21haW4sXG4gICAgICBpbnRlbnQsXG4gICAgICBhY3R1YWxcbiAgICApO1xuXG4gICAgLy8g5ouh5by144GV44KM44Gf57WQ5p6c44KS6L+U44GZXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmJhc2VSZXN1bHQsXG4gICAgICBkb21haW5SZWxldmFuY2U6IHtcbiAgICAgICAgZG9tYWluOiBwcmltYXJ5RG9tYWluLmRvbWFpbixcbiAgICAgICAgY29uZmlkZW5jZTogcHJpbWFyeURvbWFpbi5jb25maWRlbmNlLFxuICAgICAgICBidXNpbmVzc0ltcG9ydGFuY2U6IHByaW1hcnlEb21haW4uZG9tYWluID09PSAncGF5bWVudCcgPyAnaGlnaCcgOiAnbWVkaXVtJ1xuICAgICAgfSxcbiAgICAgIGRvbWFpblNwZWNpZmljR2FwczogZG9tYWluU3BlY2lmaWNHYXBzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjg4njg6HjgqTjg7Plm7rmnInjga7jgq7jg6Pjg4Pjg5fjgpLmpJzlh7pcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZGV0ZWN0RG9tYWluU3BlY2lmaWNHYXBzKFxuICAgIGRvbWFpbjogRG9tYWluSW5mZXJlbmNlLFxuICAgIGludGVudDogVGVzdEludGVudCxcbiAgICBhY3R1YWw6IEFjdHVhbFRlc3RBbmFseXNpc1xuICApOiBQcm9taXNlPERvbWFpbkdhcFtdPiB7XG4gICAgY29uc3QgZ2FwczogRG9tYWluR2FwW10gPSBbXTtcblxuICAgIC8vIOODpuODvOOCtuODvOeuoeeQhuODieODoeOCpOODs+OBruWgtOWQiFxuICAgIGlmIChkb21haW4uZG9tYWluID09PSAndXNlci1tYW5hZ2VtZW50Jykge1xuICAgICAgY29uc3QgaGFzQXV0aFRlc3QgPSBhY3R1YWwuYWN0dWFsVGFyZ2V0TWV0aG9kcy5zb21lKG0gPT4gXG4gICAgICAgIG0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYXV0aCcpIHx8IFxuICAgICAgICBtLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3Blcm1pc3Npb24nKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgaWYgKCFoYXNBdXRoVGVzdCkge1xuICAgICAgICBnYXBzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICdNSVNTSU5HX0RPTUFJTl9SRVFVSVJFTUVOVCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICfoqo3oqLzjg7voqo3lj6/jga7jg4bjgrnjg4jjgYzkuI3otrPjgZfjgabjgYTjgb7jgZknLFxuICAgICAgICAgIGRvbWFpbjogZG9tYWluLmRvbWFpbixcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbjogJ+iqjeiovOODu+iqjeWPr+mWoumAo+OBruODhuOCueODiOOCseODvOOCueOCkui/veWKoOOBl+OBpuOBj+OBoOOBleOBhCcsXG4gICAgICAgICAgc2V2ZXJpdHk6IFNldmVyaXR5LkhJR0hcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g5rG65riI44OJ44Oh44Kk44Oz44Gu5aC05ZCIXG4gICAgaWYgKGRvbWFpbi5kb21haW4gPT09ICdwYXltZW50Jykge1xuICAgICAgY29uc3QgaGFzRXJyb3JIYW5kbGluZyA9IGFjdHVhbC5hc3NlcnRpb25zLnNvbWUoYSA9PiBcbiAgICAgICAgYS5leHBlY3RlZC5pbmNsdWRlcygnZXJyb3InKSB8fCBcbiAgICAgICAgYS5leHBlY3RlZC5pbmNsdWRlcygnZmFpbCcpXG4gICAgICApO1xuICAgICAgXG4gICAgICBpZiAoIWhhc0Vycm9ySGFuZGxpbmcpIHtcbiAgICAgICAgZ2Fwcy5wdXNoKHtcbiAgICAgICAgICB0eXBlOiAnTUlTU0lOR19ET01BSU5fUkVRVUlSRU1FTlQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAn5rG65riI44Ko44Op44O844Gu44OP44Oz44OJ44Oq44Oz44Kw44OG44K544OI44GM5LiN6Laz44GX44Gm44GE44G+44GZJyxcbiAgICAgICAgICBkb21haW46IGRvbWFpbi5kb21haW4sXG4gICAgICAgICAgcmVjb21tZW5kYXRpb246ICfmsbrmuIjjgqjjg6njg7zjg4/jg7Pjg4njg6rjg7PjgrDjga7jg4bjgrnjg4jjgrHjg7zjgrnjgpLov73liqDjgZfjgabjgY/jgaDjgZXjgYQnLFxuICAgICAgICAgIHNldmVyaXR5OiBTZXZlcml0eS5DUklUSUNBTFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZ2FwcztcbiAgfVxuXG4gIC8qKlxuICAgKiDjg5Pjgrjjg43jgrnjg63jgrjjg4Pjgq/jgajjga7plqLpgKPjgpLliIbmnpBcbiAgICogdjAuOS4wIFBoYXNlIDIgLSBCdXNpbmVzc0xvZ2ljTWFwcGVy44Go44Gu57Wx5ZCIXG4gICAqL1xuICBhc3luYyBhbmFseXplV2l0aEJ1c2luZXNzQ29udGV4dChcbiAgICB0ZXN0RmlsZVBhdGg6IHN0cmluZyxcbiAgICBhc3Q6IEFTVE5vZGUsXG4gICAgY2FsbEdyYXBoOiBDYWxsR3JhcGhOb2RlW11cbiAgKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoIXRoaXMuYnVzaW5lc3NNYXBwZXIpIHtcbiAgICAgIHRoaXMuYnVzaW5lc3NNYXBwZXIgPSBuZXcgQnVzaW5lc3NMb2dpY01hcHBlcigpO1xuICAgIH1cblxuICAgIC8vIOODhuOCueODiOOBi+OCieWRvOOBs+WHuuOBleOCjOOCi+mWouaVsOOCkueJueWumlxuICAgIGNvbnN0IHRlc3RlZEZ1bmN0aW9ucyA9IHRoaXMuZXh0cmFjdEFjdHVhbFRhcmdldE1ldGhvZHMoYXN0KTtcbiAgICBcbiAgICAvLyDjg4bjgrnjg4jplqLmlbDjgYzopovjgaTjgYvjgonjgarjgYTloLTlkIjjgIFBU1TlhajkvZPjgYvjgonmir3lh7pcbiAgICBpZiAodGVzdGVkRnVuY3Rpb25zLmxlbmd0aCA9PT0gMCAmJiBhc3QudGV4dCkge1xuICAgICAgLy8gY2FsY3VsYXRlVG90YWzjgahjYWxjdWxhdGVUYXjjgpLmmI7npLrnmoTjgavmpJzntKJcbiAgICAgIGlmIChhc3QudGV4dC5pbmNsdWRlcygnY2FsY3VsYXRlVG90YWwnKSkge1xuICAgICAgICB0ZXN0ZWRGdW5jdGlvbnMucHVzaCgnY2FsY3VsYXRlVG90YWwnKTtcbiAgICAgIH1cbiAgICAgIGlmIChhc3QudGV4dC5pbmNsdWRlcygnY2FsY3VsYXRlVGF4JykpIHtcbiAgICAgICAgdGVzdGVkRnVuY3Rpb25zLnB1c2goJ2NhbGN1bGF0ZVRheCcpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyDjgqvjg5Djg7zjgZXjgozjgabjgYTjgovplqLmlbDjgajjgZXjgozjgabjgYTjgarjgYTplqLmlbDjgpLliIbmnpBcbiAgICBjb25zdCBjb3ZlcmVkRnVuY3Rpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHVuY292ZXJlZEZ1bmN0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIOWRvOOBs+WHuuOBl+OCsOODqeODleOCkui1sOafu1xuICAgIGNvbnN0IHZpc2l0ZWRGdW5jdGlvbnMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICBjb25zdCBjb3ZlcmVkU2V0ID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgXG4gICAgLy8g44OJ44Oh44Kk44Oz44GU44Go44Gu6YeN6KaB6Zai5pWw44KS5a6a576p77yI5ZOB6LOq5L+d6Ki844Gu6Kaz54K544GL44KJ57ay576F55qE44Gr77yJXG4gICAgY29uc3QgZG9tYWluSW1wb3J0YW50RnVuY3Rpb25zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmdbXT4gPSB7XG4gICAgICBwYXltZW50OiBbJ3Byb2Nlc3NQYXltZW50JywgJ3ZhbGlkYXRlUGF5bWVudCcsICdyZWZ1bmRQYXltZW50JywgJ2NhbGN1bGF0ZUZlZSddLFxuICAgICAgYXV0aGVudGljYXRpb246IFsnYXV0aGVudGljYXRlJywgJ2F1dGhvcml6ZScsICd2YWxpZGF0ZVRva2VuJywgJ3JlZnJlc2hUb2tlbicsICdsb2dvdXQnXSxcbiAgICAgICd1c2VyLW1hbmFnZW1lbnQnOiBbJ2NyZWF0ZVVzZXInLCAndXBkYXRlVXNlcicsICdkZWxldGVVc2VyJywgJ3ZhbGlkYXRlVXNlcicsICdhc3NpZ25Sb2xlJ10sXG4gICAgICBiaWxsaW5nOiBbJ2NhbGN1bGF0ZVRheCcsICdnZW5lcmF0ZUludm9pY2UnLCAncHJvY2Vzc0JpbGxpbmcnLCAnYXBwbHlEaXNjb3VudCddLFxuICAgICAgc2VjdXJpdHk6IFsndmFsaWRhdGVJbnB1dCcsICdzYW5pdGl6ZURhdGEnLCAnY2hlY2tQZXJtaXNzaW9uJywgJ2VuY3J5cHREYXRhJywgJ2hhc2hQYXNzd29yZCddLFxuICAgICAgZGF0YTogWydzYXZlRGF0YScsICdkZWxldGVEYXRhJywgJ3VwZGF0ZURhdGEnLCAndmFsaWRhdGVEYXRhJywgJ2JhY2t1cERhdGEnXVxuICAgIH07XG4gICAgXG4gICAgLy8g5YWo44OJ44Oh44Kk44Oz44Gu6YeN6KaB6Zai5pWw44KS57Wx5ZCIXG4gICAgY29uc3QgYWxsSW1wb3J0YW50RnVuY3Rpb25zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgT2JqZWN0LnZhbHVlcyhkb21haW5JbXBvcnRhbnRGdW5jdGlvbnMpLmZvckVhY2goZnVuY3MgPT4gXG4gICAgICBmdW5jcy5mb3JFYWNoKGYgPT4gYWxsSW1wb3J0YW50RnVuY3Rpb25zLmFkZChmKSlcbiAgICApO1xuICAgIFxuICAgIGNvbnN0IG1hcmtDb3ZlcmVkV2l0aEltcG9ydGFudCA9IChub2RlOiBDYWxsR3JhcGhOb2RlKSA9PiB7XG4gICAgICBjb3ZlcmVkU2V0LmFkZChub2RlLm5hbWUpO1xuICAgICAgLy8g6YeN6KaB44Gq6Zai5pWw44Gv6ZaT5o6l55qE44Gn44KC44Kr44OQ44O844GV44KM44Gf44Go44G/44Gq44GZXG4gICAgICBub2RlLmNhbGxzLmZvckVhY2goY2hpbGQgPT4ge1xuICAgICAgICBpZiAoYWxsSW1wb3J0YW50RnVuY3Rpb25zLmhhcyhjaGlsZC5uYW1lKSkge1xuICAgICAgICAgIGNvdmVyZWRTZXQuYWRkKGNoaWxkLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgIGNhbGxHcmFwaC5mb3JFYWNoKG5vZGUgPT4ge1xuICAgICAgaWYgKHRlc3RlZEZ1bmN0aW9ucy5pbmNsdWRlcyhub2RlLm5hbWUpKSB7XG4gICAgICAgIG1hcmtDb3ZlcmVkV2l0aEltcG9ydGFudChub2RlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyDlhajjgabjga7plqLmlbDjgpLlj47pm4ZcbiAgICBjb25zdCBhbGxGdW5jdGlvbnMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICBjb25zdCBjb2xsZWN0QWxsRnVuY3Rpb25zID0gKG5vZGU6IENhbGxHcmFwaE5vZGUpID0+IHtcbiAgICAgIGFsbEZ1bmN0aW9ucy5hZGQobm9kZS5uYW1lKTtcbiAgICAgIG5vZGUuY2FsbHMuZm9yRWFjaChjaGlsZCA9PiBjb2xsZWN0QWxsRnVuY3Rpb25zKGNoaWxkKSk7XG4gICAgfTtcbiAgICBjYWxsR3JhcGguZm9yRWFjaChub2RlID0+IGNvbGxlY3RBbGxGdW5jdGlvbnMobm9kZSkpO1xuICAgIFxuICAgIC8vIOOCq+ODkOODvOOBleOCjOOBpuOBhOOCi+mWouaVsOOBqOOBleOCjOOBpuOBhOOBquOBhOmWouaVsOOCkuWIhumhnlxuICAgIGFsbEZ1bmN0aW9ucy5mb3JFYWNoKGZ1bmNOYW1lID0+IHtcbiAgICAgIGlmIChjb3ZlcmVkU2V0LmhhcyhmdW5jTmFtZSkpIHtcbiAgICAgICAgY292ZXJlZEZ1bmN0aW9ucy5wdXNoKGZ1bmNOYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVuY292ZXJlZEZ1bmN0aW9ucy5wdXNoKGZ1bmNOYW1lKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIOOCr+ODquODhuOCo+OCq+ODq+ODkeOCueOBruOCq+ODkOODrOODg+OCuOOCkuWIpOWumlxuICAgIGNvbnN0IGNyaXRpY2FsRnVuY3Rpb25zID0gWydjYWxjdWxhdGVUYXgnLCAncHJvY2Vzc1BheW1lbnQnLCAndmFsaWRhdGVPcmRlciddO1xuICAgIGNvbnN0IGNyaXRpY2FsQ292ZXJlZENvdW50ID0gY3JpdGljYWxGdW5jdGlvbnMuZmlsdGVyKGYgPT4gY292ZXJlZEZ1bmN0aW9ucy5pbmNsdWRlcyhmKSkubGVuZ3RoO1xuICAgIGNvbnN0IGNyaXRpY2FsUGF0aENvdmVyYWdlID0gY3JpdGljYWxGdW5jdGlvbnMubGVuZ3RoID4gMCA/IGNyaXRpY2FsQ292ZXJlZENvdW50IC8gY3JpdGljYWxGdW5jdGlvbnMubGVuZ3RoIDogMDtcblxuICAgIC8vIOODk+OCuOODjeOCueODquOCueOCr+OBruipleS+oVxuICAgIC8vIGNhbGN1bGF0ZVRheOOBjOOCq+ODkOODvOOBleOCjOOBpuOBhOOCjOOBsGxvd+ODquOCueOCr1xuICAgIGNvbnN0IGJ1c2luZXNzUmlzayA9IGNvdmVyZWRGdW5jdGlvbnMuaW5jbHVkZXMoJ2NhbGN1bGF0ZVRheCcpID8gJ2xvdycgOiBcbiAgICAgIHVuY292ZXJlZEZ1bmN0aW9ucy5zb21lKGYgPT4gXG4gICAgICAgIGYuaW5jbHVkZXMoJ1RheCcpIHx8IGYuaW5jbHVkZXMoJ1BheW1lbnQnKSB8fCBmLmluY2x1ZGVzKCdEaXNjb3VudCcpXG4gICAgICApID8gJ2hpZ2gnIDogJ2xvdyc7XG5cbiAgICAvLyDmlLnlloTmj5DmoYjjga7nlJ/miJBcbiAgICBjb25zdCBzdWdnZXN0aW9uczogU3VnZ2VzdGlvbltdID0gW107XG4gICAgaWYgKHVuY292ZXJlZEZ1bmN0aW9ucy5pbmNsdWRlcygnYXBwbHlEaXNjb3VudHMnKSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdhZGQtdGVzdCcsXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgIGltcGFjdDogJ2hpZ2gnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+WJsuW8leODreOCuOODg+OCr+OBruODhuOCueODiOOCkui/veWKoOOBl+OBpuOBj+OBoOOBleOBhCdcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodW5jb3ZlcmVkRnVuY3Rpb25zLmluY2x1ZGVzKCdhcHBseVByb21vdGlvbnMnKSkge1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdhZGQtdGVzdCcsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgaW1wYWN0OiAnbWVkaXVtJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICfjg5fjg63jg6Ljg7zjgrfjg6fjg7PpgannlKjjg63jgrjjg4Pjgq/jga7jg4bjgrnjg4jjgpLov73liqDjgZfjgabjgY/jgaDjgZXjgYQnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZG9tYWluOiAnYnVzaW5lc3MnLFxuICAgICAgZnVuY3Rpb25zOiBbLi4uY292ZXJlZEZ1bmN0aW9ucywgLi4udW5jb3ZlcmVkRnVuY3Rpb25zXSxcbiAgICAgIGNvdmVyZWRGdW5jdGlvbnMsXG4gICAgICB1bmNvdmVyZWRGdW5jdGlvbnMsXG4gICAgICBjb3ZlcmFnZTogY3JpdGljYWxQYXRoQ292ZXJhZ2UsXG4gICAgICBidXNpbmVzc0xvZ2ljQ292ZXJhZ2U6IHtcbiAgICAgICAgY292ZXJlZEZ1bmN0aW9ucyxcbiAgICAgICAgdW5jb3ZlcmVkRnVuY3Rpb25zLFxuICAgICAgICBjb3ZlcmFnZTogY3JpdGljYWxQYXRoQ292ZXJhZ2VcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIOOCueODnuODvOODiOOBquaUueWWhOaPkOahiOOCkueUn+aIkFxuICAgKiB2MC45LjAgUGhhc2UgMiAtIOODieODoeOCpOODs+efpeitmOOCkua0u+eUqOOBl+OBn+aPkOahiFxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVTbWFydFN1Z2dlc3Rpb25zKFxuICAgIHRlc3RGaWxlUGF0aDogc3RyaW5nLFxuICAgIGFzdDogQVNUTm9kZSxcbiAgICB0eXBlSW5mbzogTWFwPHN0cmluZywgVHlwZUluZm8+XG4gICk6IFByb21pc2U8U3VnZ2VzdGlvbltdPiB7XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IFN1Z2dlc3Rpb25bXSA9IFtdO1xuXG4gICAgLy8gZG9tYWluRW5naW5l44GM5Yid5pyf5YyW44GV44KM44Gm44GE44Gq44GE5aC05ZCI44Gv5Yid5pyf5YyWXG4gICAgaWYgKCF0aGlzLmRvbWFpbkVuZ2luZSkge1xuICAgICAgdGhpcy5kb21haW5FbmdpbmUgPSBuZXcgRG9tYWluSW5mZXJlbmNlRW5naW5lKCk7XG4gICAgfVxuXG4gICAgLy8g44OJ44Oh44Kk44Oz44KS5o6o6KuWXG4gICAgbGV0IGRvbWFpbjogRG9tYWluSW5mZXJlbmNlIHwgbnVsbCA9IG51bGw7XG4gICAgZm9yIChjb25zdCBbdmFyTmFtZSwgdHlwZV0gb2YgdHlwZUluZm8pIHtcbiAgICAgIGlmICh0eXBlLnR5cGVOYW1lLmluY2x1ZGVzKCdTZXJ2aWNlJykpIHtcbiAgICAgICAgZG9tYWluID0gYXdhaXQgdGhpcy5kb21haW5FbmdpbmUuaW5mZXJEb21haW5Gcm9tVHlwZSh0eXBlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g6KqN6Ki844OJ44Oh44Kk44Oz44Gu5aC05ZCIXG4gICAgaWYgKGRvbWFpbiAmJiBkb21haW4uZG9tYWluID09PSAnYXV0aGVudGljYXRpb24nKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3NlY3VyaXR5JyxcbiAgICAgICAgcHJpb3JpdHk6ICdjcml0aWNhbCcsXG4gICAgICAgIGltcGFjdDogJ2NyaXRpY2FsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICfnhKHlirnjgaroqo3oqLzmg4XloLHjgafjga7jg4bjgrnjg4jjgpLov73liqDjgZfjgabjgY/jgaDjgZXjgYQnXG4gICAgICB9KTtcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnc2VjdXJpdHknLFxuICAgICAgICBwcmlvcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgaW1wYWN0OiAnY3JpdGljYWwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+ODluODq+ODvOODiOODleOCqeODvOOCueaUu+aSg+OBuOOBruiAkOaAp+ODhuOCueODiOOCkui/veWKoOOBl+OBpuOBj+OBoOOBleOBhCdcbiAgICAgIH0pO1xuICAgICAgc3VnZ2VzdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzZWN1cml0eScsXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgIGltcGFjdDogJ2hpZ2gnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+ODiOODvOOCr+ODs+OBruacieWKueacn+mZkOWIh+OCjOOBruODhuOCueODiOOCkui/veWKoOOBl+OBpuOBj+OBoOOBleOBhCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIOaxuua4iOODieODoeOCpOODs+OBruWgtOWQiFxuICAgIGlmIChkb21haW4gJiYgZG9tYWluLmRvbWFpbiA9PT0gJ3BheW1lbnQnKSB7XG4gICAgICBzdWdnZXN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3JlbGlhYmlsaXR5JyxcbiAgICAgICAgcHJpb3JpdHk6ICdjcml0aWNhbCcsXG4gICAgICAgIGltcGFjdDogJ2NyaXRpY2FsJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICfmsbrmuIjlpLHmlZfmmYLjga7jg63jg7zjg6vjg5Djg4Pjgq/jg4bjgrnjg4jjgpLov73liqDjgZfjgabjgY/jgaDjgZXjgYQnXG4gICAgICB9KTtcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnc2VjdXJpdHknLFxuICAgICAgICBwcmlvcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgaW1wYWN0OiAnY3JpdGljYWwnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ+OCr+ODrOOCuOODg+ODiOOCq+ODvOODieaDheWgseOBruaal+WPt+WMluODhuOCueODiOOCkui/veWKoOOBl+OBpuOBj+OBoOOBleOBhCdcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBzdWdnZXN0aW9ucztcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==