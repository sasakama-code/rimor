a87329a484672d468c9cb6737bb9a619
"use strict";
/**
 * ProjectDependencyAnalyzer
 * Issue #65: プロジェクトレベルの依存関係分析
 *
 * SOLID原則: 単一責任（プロジェクト依存関係のみ）
 * DRY原則: 共通ロジックを基底クラスに抽出
 * KISS原則: シンプルな分析ロジック
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProjectDependencyAnalyzer = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
/**
 * プロジェクトレベルの依存関係を分析
 */
class ProjectDependencyAnalyzer {
    /**
     * プロジェクトの依存関係を分析
     */
    async analyzeDependencies(projectPath) {
        const packageJsonPath = path.join(projectPath, 'package.json');
        if (!fs.existsSync(packageJsonPath)) {
            throw new Error('package.json not found');
        }
        const packageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf-8'));
        const result = {
            dependencies: this.extractDependencies(packageJson.dependencies || {}, 'production'),
            devDependencies: this.extractDependencies(packageJson.devDependencies || {}, 'development'),
            peerDependencies: packageJson.peerDependencies
                ? this.extractDependencies(packageJson.peerDependencies, 'peer')
                : undefined,
            optionalDependencies: packageJson.optionalDependencies
                ? this.extractDependencies(packageJson.optionalDependencies, 'optional')
                : undefined,
            vulnerabilities: await this.checkVulnerabilities(packageJson)
        };
        return result;
    }
    /**
     * インストール済みパッケージのリストを取得
     */
    async getInstalledPackages(projectPath) {
        const nodeModulesPath = path.join(projectPath, 'node_modules');
        if (!fs.existsSync(nodeModulesPath)) {
            return [];
        }
        const items = fs.readdirSync(nodeModulesPath);
        const packages = [];
        for (const item of items) {
            if (item.startsWith('.'))
                continue;
            const itemPath = path.join(nodeModulesPath, item);
            const stat = fs.statSync(itemPath);
            if (stat.isDirectory()) {
                if (item.startsWith('@')) {
                    // Scoped packages
                    const scopedItems = fs.readdirSync(itemPath);
                    for (const scopedItem of scopedItems) {
                        packages.push(`${item}/${scopedItem}`);
                    }
                }
                else {
                    packages.push(item);
                }
            }
        }
        return packages;
    }
    /**
     * 依存関係を抽出
     */
    extractDependencies(deps, depType = 'production') {
        return Object.entries(deps).map(([name, version]) => ({
            name,
            version,
            type: depType,
            usage: [] // TODO: 実際の使用状況を分析する必要がある
        }));
    }
    /**
     * バージョン制約のタイプを判定
     */
    getVersionConstraintType(version) {
        if (version.startsWith('^'))
            return 'caret';
        if (version.startsWith('~'))
            return 'tilde';
        if (version === '*' || version === 'latest')
            return 'wildcard';
        if (version.includes('-') || version.includes('>') || version.includes('<'))
            return 'range';
        return 'exact';
    }
    /**
     * 脆弱性をチェック（簡易実装）
     */
    async checkVulnerabilities(packageJson) {
        const vulnerabilities = [];
        // 実際の実装では、npm audit APIやnvdデータベースを使用
        // ここでは簡易的な例として特定のパッケージをチェック
        const knownVulnerablePackages = [
            'vulnerable-package',
            'old-lodash'
        ];
        const allDeps = {
            ...packageJson.dependencies,
            ...packageJson.devDependencies
        };
        for (const [name] of Object.entries(allDeps)) {
            if (knownVulnerablePackages.includes(name)) {
                vulnerabilities.push(`${name} has known vulnerabilities`);
            }
        }
        return vulnerabilities;
    }
    /**
     * パッケージマネージャーを検出
     */
    async detectPackageManager(projectPath) {
        if (fs.existsSync(path.join(projectPath, 'bun.lockb'))) {
            return 'bun';
        }
        if (fs.existsSync(path.join(projectPath, 'pnpm-lock.yaml'))) {
            return 'pnpm';
        }
        if (fs.existsSync(path.join(projectPath, 'yarn.lock'))) {
            return 'yarn';
        }
        if (fs.existsSync(path.join(projectPath, 'package-lock.json'))) {
            return 'npm';
        }
        // デフォルト
        return 'npm';
    }
}
exports.ProjectDependencyAnalyzer = ProjectDependencyAnalyzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9hbmFseXplcnMvZGVwZW5kZW5jeS1hbmFseXNpcy9wcm9qZWN0LWRlcHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUlILHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFHN0I7O0dBRUc7QUFDSCxNQUFhLHlCQUF5QjtJQUNwQzs7T0FFRztJQUNILEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxXQUFtQjtRQU8zQyxNQUFNLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUUvRCxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUM1QyxDQUFDO1FBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FDNUIsRUFBRSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsT0FBTyxDQUFDLENBQ3JCLENBQUM7UUFFdkIsTUFBTSxNQUFNLEdBQUc7WUFDYixZQUFZLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxZQUFZLElBQUksRUFBRSxFQUFFLFlBQVksQ0FBQztZQUNwRixlQUFlLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxlQUFlLElBQUksRUFBRSxFQUFFLGFBQWEsQ0FBQztZQUMzRixnQkFBZ0IsRUFBRSxXQUFXLENBQUMsZ0JBQWdCO2dCQUM1QyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUM7Z0JBQ2hFLENBQUMsQ0FBQyxTQUFTO1lBQ2Isb0JBQW9CLEVBQUUsV0FBVyxDQUFDLG9CQUFvQjtnQkFDcEQsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxX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QUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Q0FDRjtBQTdJRCw4REE2SUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9hbmFseXplcnMvZGVwZW5kZW5jeS1hbmFseXNpcy9wcm9qZWN0LWRlcHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9qZWN0RGVwZW5kZW5jeUFuYWx5emVyXG4gKiBJc3N1ZSAjNjU6IOODl+ODreOCuOOCp+OCr+ODiOODrOODmeODq+OBruS+neWtmOmWouS/guWIhuaekFxuICogXG4gKiBTT0xJROWOn+WJhzog5Y2Y5LiA6LKs5Lu777yI44OX44Ot44K444Kn44Kv44OI5L6d5a2Y6Zai5L+C44Gu44G/77yJXG4gKiBEUlnljp/liYc6IOWFsemAmuODreOCuOODg+OCr+OCkuWfuuW6leOCr+ODqeOCueOBq+aKveWHulxuICogS0lTU+WOn+WJhzog44K344Oz44OX44Or44Gq5YiG5p6Q44Ot44K444OD44KvXG4gKi9cblxuaW1wb3J0IHsgUHJvamVjdERlcGVuZGVuY3kgfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgeyBQYWNrYWdlSnNvbkNvbmZpZyB9IGZyb20gJy4uLy4uL2NvcmUvdHlwZXMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFBhdGhTZWN1cml0eSB9IGZyb20gJy4uLy4uL3V0aWxzL3BhdGhTZWN1cml0eSc7XG5cbi8qKlxuICog44OX44Ot44K444Kn44Kv44OI44Os44OZ44Or44Gu5L6d5a2Y6Zai5L+C44KS5YiG5p6QXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9qZWN0RGVwZW5kZW5jeUFuYWx5emVyIHtcbiAgLyoqXG4gICAqIOODl+ODreOCuOOCp+OCr+ODiOOBruS+neWtmOmWouS/guOCkuWIhuaekFxuICAgKi9cbiAgYXN5bmMgYW5hbHl6ZURlcGVuZGVuY2llcyhwcm9qZWN0UGF0aDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgZGVwZW5kZW5jaWVzOiBQcm9qZWN0RGVwZW5kZW5jeVtdO1xuICAgIGRldkRlcGVuZGVuY2llczogUHJvamVjdERlcGVuZGVuY3lbXTtcbiAgICBwZWVyRGVwZW5kZW5jaWVzPzogUHJvamVjdERlcGVuZGVuY3lbXTtcbiAgICBvcHRpb25hbERlcGVuZGVuY2llcz86IFByb2plY3REZXBlbmRlbmN5W107XG4gICAgdnVsbmVyYWJpbGl0aWVzPzogc3RyaW5nW107XG4gIH0+IHtcbiAgICBjb25zdCBwYWNrYWdlSnNvblBhdGggPSBwYXRoLmpvaW4ocHJvamVjdFBhdGgsICdwYWNrYWdlLmpzb24nKTtcbiAgICBcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMocGFja2FnZUpzb25QYXRoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdwYWNrYWdlLmpzb24gbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgY29uc3QgcGFja2FnZUpzb24gPSBKU09OLnBhcnNlKFxuICAgICAgZnMucmVhZEZpbGVTeW5jKHBhY2thZ2VKc29uUGF0aCwgJ3V0Zi04JylcbiAgICApIGFzIFBhY2thZ2VKc29uQ29uZmlnO1xuXG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgZGVwZW5kZW5jaWVzOiB0aGlzLmV4dHJhY3REZXBlbmRlbmNpZXMocGFja2FnZUpzb24uZGVwZW5kZW5jaWVzIHx8IHt9LCAncHJvZHVjdGlvbicpLFxuICAgICAgZGV2RGVwZW5kZW5jaWVzOiB0aGlzLmV4dHJhY3REZXBlbmRlbmNpZXMocGFja2FnZUpzb24uZGV2RGVwZW5kZW5jaWVzIHx8IHt9LCAnZGV2ZWxvcG1lbnQnKSxcbiAgICAgIHBlZXJEZXBlbmRlbmNpZXM6IHBhY2thZ2VKc29uLnBlZXJEZXBlbmRlbmNpZXMgXG4gICAgICAgID8gdGhpcy5leHRyYWN0RGVwZW5kZW5jaWVzKHBhY2thZ2VKc29uLnBlZXJEZXBlbmRlbmNpZXMsICdwZWVyJylcbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICBvcHRpb25hbERlcGVuZGVuY2llczogcGFja2FnZUpzb24ub3B0aW9uYWxEZXBlbmRlbmNpZXNcbiAgICAgICAgPyB0aGlzLmV4dHJhY3REZXBlbmRlbmNpZXMocGFja2FnZUpzb24ub3B0aW9uYWxEZXBlbmRlbmNpZXMsICdvcHRpb25hbCcpXG4gICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgdnVsbmVyYWJpbGl0aWVzOiBhd2FpdCB0aGlzLmNoZWNrVnVsbmVyYWJpbGl0aWVzKHBhY2thZ2VKc29uKVxuICAgIH07XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIOOCpOODs+OCueODiOODvOODq+a4iOOBv+ODkeODg+OCseODvOOCuOOBruODquOCueODiOOCkuWPluW+l1xuICAgKi9cbiAgYXN5bmMgZ2V0SW5zdGFsbGVkUGFja2FnZXMocHJvamVjdFBhdGg6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBub2RlTW9kdWxlc1BhdGggPSBwYXRoLmpvaW4ocHJvamVjdFBhdGgsICdub2RlX21vZHVsZXMnKTtcbiAgICBcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMobm9kZU1vZHVsZXNQYXRoKSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IGl0ZW1zID0gZnMucmVhZGRpclN5bmMobm9kZU1vZHVsZXNQYXRoKTtcbiAgICBjb25zdCBwYWNrYWdlczogc3RyaW5nW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgaWYgKGl0ZW0uc3RhcnRzV2l0aCgnLicpKSBjb250aW51ZTtcbiAgICAgIFxuICAgICAgY29uc3QgaXRlbVBhdGggPSBwYXRoLmpvaW4obm9kZU1vZHVsZXNQYXRoLCBpdGVtKTtcbiAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhpdGVtUGF0aCk7XG4gICAgICBcbiAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgaWYgKGl0ZW0uc3RhcnRzV2l0aCgnQCcpKSB7XG4gICAgICAgICAgLy8gU2NvcGVkIHBhY2thZ2VzXG4gICAgICAgICAgY29uc3Qgc2NvcGVkSXRlbXMgPSBmcy5yZWFkZGlyU3luYyhpdGVtUGF0aCk7XG4gICAgICAgICAgZm9yIChjb25zdCBzY29wZWRJdGVtIG9mIHNjb3BlZEl0ZW1zKSB7XG4gICAgICAgICAgICBwYWNrYWdlcy5wdXNoKGAke2l0ZW19LyR7c2NvcGVkSXRlbX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGFja2FnZXMucHVzaChpdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwYWNrYWdlcztcbiAgfVxuXG4gIC8qKlxuICAgKiDkvp3lrZjplqLkv4LjgpLmir3lh7pcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdERlcGVuZGVuY2llcyhkZXBzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LCBkZXBUeXBlOiAncHJvZHVjdGlvbicgfCAnZGV2ZWxvcG1lbnQnIHwgJ3BlZXInIHwgJ29wdGlvbmFsJyA9ICdwcm9kdWN0aW9uJyk6IFByb2plY3REZXBlbmRlbmN5W10ge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhkZXBzKS5tYXAoKFtuYW1lLCB2ZXJzaW9uXSkgPT4gKHtcbiAgICAgIG5hbWUsXG4gICAgICB2ZXJzaW9uLFxuICAgICAgdHlwZTogZGVwVHlwZSxcbiAgICAgIHVzYWdlOiBbXSAvLyBUT0RPOiDlrp/pmpvjga7kvb/nlKjnirbms4HjgpLliIbmnpDjgZnjgovlv4XopoHjgYzjgYLjgotcbiAgICB9KSk7XG4gIH1cblxuICAvKipcbiAgICog44OQ44O844K444On44Oz5Yi257SE44Gu44K/44Kk44OX44KS5Yik5a6aXG4gICAqL1xuICBwcml2YXRlIGdldFZlcnNpb25Db25zdHJhaW50VHlwZSh2ZXJzaW9uOiBzdHJpbmcpOiAnZXhhY3QnIHwgJ3JhbmdlJyB8ICdjYXJldCcgfCAndGlsZGUnIHwgJ3dpbGRjYXJkJyB7XG4gICAgaWYgKHZlcnNpb24uc3RhcnRzV2l0aCgnXicpKSByZXR1cm4gJ2NhcmV0JztcbiAgICBpZiAodmVyc2lvbi5zdGFydHNXaXRoKCd+JykpIHJldHVybiAndGlsZGUnO1xuICAgIGlmICh2ZXJzaW9uID09PSAnKicgfHwgdmVyc2lvbiA9PT0gJ2xhdGVzdCcpIHJldHVybiAnd2lsZGNhcmQnO1xuICAgIGlmICh2ZXJzaW9uLmluY2x1ZGVzKCctJykgfHwgdmVyc2lvbi5pbmNsdWRlcygnPicpIHx8IHZlcnNpb24uaW5jbHVkZXMoJzwnKSkgcmV0dXJuICdyYW5nZSc7XG4gICAgcmV0dXJuICdleGFjdCc7XG4gIH1cblxuICAvKipcbiAgICog6ISG5byx5oCn44KS44OB44Kn44OD44Kv77yI57Ch5piT5a6f6KOF77yJXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNoZWNrVnVsbmVyYWJpbGl0aWVzKHBhY2thZ2VKc29uOiBQYWNrYWdlSnNvbkNvbmZpZyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCB2dWxuZXJhYmlsaXRpZXM6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgLy8g5a6f6Zqb44Gu5a6f6KOF44Gn44Gv44CBbnBtIGF1ZGl0IEFQSeOChG52ZOODh+ODvOOCv+ODmeODvOOCueOCkuS9v+eUqFxuICAgIC8vIOOBk+OBk+OBp+OBr+ewoeaYk+eahOOBquS+i+OBqOOBl+OBpueJueWumuOBruODkeODg+OCseODvOOCuOOCkuODgeOCp+ODg+OCr1xuICAgIGNvbnN0IGtub3duVnVsbmVyYWJsZVBhY2thZ2VzID0gW1xuICAgICAgJ3Z1bG5lcmFibGUtcGFja2FnZScsXG4gICAgICAnb2xkLWxvZGFzaCdcbiAgICBdO1xuXG4gICAgY29uc3QgYWxsRGVwcyA9IHtcbiAgICAgIC4uLnBhY2thZ2VKc29uLmRlcGVuZGVuY2llcyxcbiAgICAgIC4uLnBhY2thZ2VKc29uLmRldkRlcGVuZGVuY2llc1xuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IFtuYW1lXSBvZiBPYmplY3QuZW50cmllcyhhbGxEZXBzKSkge1xuICAgICAgaWYgKGtub3duVnVsbmVyYWJsZVBhY2thZ2VzLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgIHZ1bG5lcmFiaWxpdGllcy5wdXNoKGAke25hbWV9IGhhcyBrbm93biB2dWxuZXJhYmlsaXRpZXNgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdnVsbmVyYWJpbGl0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIOODkeODg+OCseODvOOCuOODnuODjeODvOOCuOODo+ODvOOCkuaknOWHulxuICAgKi9cbiAgYXN5bmMgZGV0ZWN0UGFja2FnZU1hbmFnZXIocHJvamVjdFBhdGg6IHN0cmluZyk6IFByb21pc2U8J25wbScgfCAneWFybicgfCAncG5wbScgfCAnYnVuJz4ge1xuICAgIGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbihwcm9qZWN0UGF0aCwgJ2J1bi5sb2NrYicpKSkge1xuICAgICAgcmV0dXJuICdidW4nO1xuICAgIH1cbiAgICBpZiAoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4ocHJvamVjdFBhdGgsICdwbnBtLWxvY2sueWFtbCcpKSkge1xuICAgICAgcmV0dXJuICdwbnBtJztcbiAgICB9XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHByb2plY3RQYXRoLCAneWFybi5sb2NrJykpKSB7XG4gICAgICByZXR1cm4gJ3lhcm4nO1xuICAgIH1cbiAgICBpZiAoZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4ocHJvamVjdFBhdGgsICdwYWNrYWdlLWxvY2suanNvbicpKSkge1xuICAgICAgcmV0dXJuICducG0nO1xuICAgIH1cbiAgICBcbiAgICAvLyDjg4fjg5Xjgqnjg6vjg4hcbiAgICByZXR1cm4gJ25wbSc7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=