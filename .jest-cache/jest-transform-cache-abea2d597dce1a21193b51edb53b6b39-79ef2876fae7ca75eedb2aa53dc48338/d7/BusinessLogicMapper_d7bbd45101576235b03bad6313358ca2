802c94ea1a72c18645e0c7f410d57d0d
"use strict";
/**
 * Business Logic Mapper
 * v0.9.0 Phase 2 - テストとビジネスロジックの関連付け実装
 *
 * KISS原則: シンプルな実装から開始
 * YAGNI原則: 必要最小限の機能のみ実装
 * DRY原則: 重複を避ける
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.BusinessLogicMapper = void 0;
const DomainInferenceEngine_1 = require("./DomainInferenceEngine");
class BusinessLogicMapper {
    domainEngine;
    // ドメイン重要度設定
    importanceConfig = {
        weightMap: {
            critical: 70,
            high: 50,
            medium: 30,
            low: 15
        },
        criticalDomains: ['payment', 'authentication', 'user-management', 'security', 'billing'],
        domainBonus: 15,
        disableDomainOverrides: false
    };
    constructor() {
        this.domainEngine = new DomainInferenceEngine_1.DomainInferenceEngine();
    }
    async mapTestToBusinessLogic(testFilePath, callGraph, typeInfo) {
        // テストファイルから関連するビジネスロジックファイルを収集
        const businessLogicFiles = [];
        const processedFiles = new Set();
        const affectedDomains = new Set();
        // 呼び出しグラフを走査してビジネスロジックファイルを収集
        for (const node of callGraph) {
            await this.collectBusinessLogicFiles(node, businessLogicFiles, processedFiles, typeInfo, affectedDomains);
        }
        // カバレッジ深度の計算（KISS: シンプルな計算）
        const coverageDepth = this.calculateCoverageDepth(businessLogicFiles);
        // ビジネスクリティカル度の計算
        const allFunctions = businessLogicFiles.flatMap(f => f.functions);
        const primaryDomain = businessLogicFiles[0]?.domain || {
            domain: 'unknown',
            confidence: 0,
            concepts: [],
            businessImportance: 'low'
        };
        const businessCriticality = await this.calculateBusinessImportance(allFunctions, primaryDomain);
        // 影響範囲の分析
        const impactScope = {
            directImpact: businessLogicFiles.length,
            indirectImpact: 0, // YAGNI: 今は実装しない
            affectedDomains: Array.from(affectedDomains),
            onCriticalPath: await this.checkCriticalPath(businessLogicFiles)
        };
        // リスク評価
        const riskAssessment = this.assessRisk(businessLogicFiles, coverageDepth);
        return {
            testFilePath,
            businessLogicFiles,
            coverageDepth,
            businessCriticality,
            impactScope,
            riskAssessment
        };
    }
    async collectBusinessLogicFiles(node, businessLogicFiles, processedFiles, typeInfo, affectedDomains) {
        if (processedFiles.has(node.filePath)) {
            return;
        }
        processedFiles.add(node.filePath);
        // ドメイン推論
        const domain = await this.inferDomainFromFile(node.filePath, typeInfo);
        if (domain.domain !== 'unknown') {
            affectedDomains.add(domain.domain);
        }
        // ビジネス関数の作成
        const businessFunction = {
            name: node.name,
            line: node.line,
            isTested: true, // テストから到達可能なので
            complexity: this.estimateComplexity(node),
            dependencyCount: node.calls.length,
            containsBusinessRules: await this.checkBusinessRules(node.name)
        };
        // 既存のファイルに追加するか、新規作成
        let file = businessLogicFiles.find(f => f.filePath === node.filePath);
        if (!file) {
            file = {
                filePath: node.filePath,
                domain,
                functions: [],
                importanceScore: 0
            };
            businessLogicFiles.push(file);
        }
        file.functions.push(businessFunction);
        // 重要度スコアの計算
        file.importanceScore = this.calculateFileImportance(file);
        // 子ノードを再帰的に処理
        for (const child of node.calls) {
            await this.collectBusinessLogicFiles(child, businessLogicFiles, processedFiles, typeInfo, affectedDomains);
        }
    }
    async inferDomainFromFile(filePath, typeInfo) {
        // ファイルパスからドメインを推論
        const pathParts = filePath.split('/');
        const fileName = pathParts[pathParts.length - 1].replace(/\.(ts|js)$/, '');
        // ファイル名から型情報を探す
        const type = typeInfo.get(fileName);
        if (type) {
            return await this.domainEngine.inferDomainFromType(type);
        }
        // サービス名から関連する型を探す（UserService -> User）
        for (const [key, value] of typeInfo) {
            if (fileName.toLowerCase().includes(key.toLowerCase())) {
                return await this.domainEngine.inferDomainFromType(value);
            }
        }
        // パスベースの推論（信頼度を控えめに設定）
        if (filePath.includes('payment') || filePath.includes('Payment')) {
            return {
                domain: 'payment',
                confidence: 0.6,
                concepts: ['決済'],
                businessImportance: 'high' // criticalではなくhighをデフォルトに
            };
        }
        else if (filePath.includes('order') || filePath.includes('Order')) {
            return {
                domain: 'order-management',
                confidence: 0.6,
                concepts: ['注文'],
                businessImportance: 'high'
            };
        }
        else if (filePath.includes('user') || filePath.includes('User')) {
            return {
                domain: 'user-management',
                confidence: 0.6,
                concepts: ['ユーザー管理'],
                businessImportance: 'high'
            };
        }
        return {
            domain: 'unknown',
            confidence: 0.3,
            concepts: [],
            businessImportance: 'low'
        };
    }
    calculateCoverageDepth(files) {
        if (files.length === 0)
            return 0;
        // 高重要度ファイルの割合とテスト済み関数の割合から計算
        const importantFiles = files.filter(f => f.importanceScore > 70);
        const importanceRatio = importantFiles.length / files.length;
        const allFunctions = files.flatMap(f => f.functions);
        const testedFunctions = allFunctions.filter(f => f.isTested);
        const testRatio = testedFunctions.length / (allFunctions.length || 1);
        // 重み付け平均（KISS）
        return importanceRatio * 0.4 + testRatio * 0.6;
    }
    calculateFileImportance(file) {
        const domainWeight = this.getDomainWeight(file.domain.businessImportance);
        const complexityScore = Math.min(100, file.functions.reduce((sum, f) => sum + f.complexity * 5, 0));
        const businessRuleScore = file.functions.filter(f => f.containsBusinessRules).length * 20;
        // 設定されたクリティカルドメインに対してボーナスを付与
        const criticalDomains = this.importanceConfig.criticalDomains || [];
        const domainBonus = criticalDomains.includes(file.domain.domain)
            ? (this.importanceConfig.domainBonus || 15)
            : 0;
        return Math.min(100, domainWeight + complexityScore * 0.3 + businessRuleScore * 0.5 + domainBonus);
    }
    getDomainWeight(importance) {
        // 設定された重み付けを使用（設定がない場合はデフォルト値）
        if (this.importanceConfig.weightMap) {
            const key = importance;
            return this.importanceConfig.weightMap[key] ?? 15;
        }
        // デフォルト値
        const defaultWeights = {
            critical: 70,
            high: 50,
            medium: 30,
            low: 15
        };
        return defaultWeights[importance] || 15;
    }
    estimateComplexity(node) {
        // KISS: 簡単な推定
        return 5 + node.calls.length * 2;
    }
    async checkBusinessRules(functionName) {
        // KISS: 関数名からの簡単な推定
        const businessRulePatterns = [
            /calculate/i,
            /validate/i,
            /process/i,
            /check/i,
            /verify/i,
            /tax/i,
            /discount/i,
            /payment/i,
            /order/i
        ];
        return businessRulePatterns.some(pattern => pattern.test(functionName));
    }
    async checkCriticalPath(files) {
        // クリティカルなドメインに属するファイルがあるかチェック
        const criticalDomains = ['payment', 'authentication', 'billing', 'order-management'];
        return files.some(f => criticalDomains.includes(f.domain.domain));
    }
    assessRisk(files, coverageDepth) {
        // カバレッジリスク
        const coverageRisk = coverageDepth < 0.5 ? 'high' : coverageDepth < 0.7 ? 'medium' : 'low';
        // 複雑度リスク
        const avgComplexity = this.calculateAverageComplexity(files);
        const complexityRisk = avgComplexity > 10 ? 'high' : avgComplexity > 5 ? 'medium' : 'low';
        // 変更リスク（YAGNI: 今は簡単な実装）
        const changeRisk = 'medium';
        // 総合リスクスコア
        const riskScores = { high: 30, medium: 20, low: 10 };
        const overallRiskScore = riskScores[coverageRisk] +
            riskScores[complexityRisk] +
            riskScores[changeRisk];
        return {
            coverageRisk,
            complexityRisk,
            changeRisk,
            overallRiskScore
        };
    }
    calculateAverageComplexity(files) {
        const allFunctions = files.flatMap(f => f.functions);
        if (allFunctions.length === 0)
            return 0;
        const totalComplexity = allFunctions.reduce((sum, f) => sum + f.complexity, 0);
        return totalComplexity / allFunctions.length;
    }
    async calculateBusinessImportance(functions, domain) {
        const reasons = [];
        let score = 0;
        // 全ての関数が単純（複雑度低、依存なし）かチェック
        const allSimple = functions.every(f => f.complexity <= 7 && f.dependencyCount === 0);
        // 単純な関数のみの場合は、ドメインに関わらずlowとする
        if (allSimple && functions.length > 0) {
            reasons.push('全ての関数が単純（低複雑度、依存関係なし）');
            return {
                level: 'low',
                score: 30,
                reasons
            };
        }
        // ドメインの重要度を基準スコアとする
        score += this.getDomainWeight(domain.businessImportance);
        // ビジネスルールを含む関数の評価
        const businessRuleFunctions = functions.filter(f => f.containsBusinessRules);
        if (businessRuleFunctions.length > 0) {
            reasons.push('ビジネスルールを含む関数が存在');
            score += businessRuleFunctions.length * 10;
        }
        // 高複雑度関数の評価
        const complexFunctions = functions.filter(f => f.complexity >= 15);
        if (complexFunctions.length > 0) {
            reasons.push('高複雑度の関数が存在');
            score += complexFunctions.length * 10;
        }
        // 依存関係の多い関数の評価
        const highDependencyFunctions = functions.filter(f => f.dependencyCount > 3);
        if (highDependencyFunctions.length > 0) {
            reasons.push('依存関係の多い関数が存在');
            score += highDependencyFunctions.length * 3;
        }
        // レベルの判定
        let level;
        // billing ドメインかつビジネスルールを含む場合は特別扱い
        if (domain.domain === 'billing' && businessRuleFunctions.length > 0) {
            level = 'high';
            score = Math.max(score, 76); // 最低でも76点を保証
        }
        else if (score >= 80) {
            level = 'critical';
        }
        else if (score >= 60) {
            level = 'high';
        }
        else if (score >= 40) {
            level = 'medium';
        }
        else {
            level = 'low';
        }
        return {
            level,
            reasons,
            score: Math.min(100, score)
        };
    }
    async analyzeImpactScope(callGraph, startNode) {
        const visited = new Set();
        const affectedDomains = new Set();
        let directImpact = 0;
        // DFSで影響範囲を探索
        const traverse = (node, depth) => {
            const nodeId = `${node.filePath}:${node.name}`;
            if (visited.has(nodeId))
                return;
            visited.add(nodeId);
            if (depth > 0) { // 0より大きい場合は直接影響
                directImpact++;
            }
            // ドメイン推論（簡易版）
            if (node.filePath.includes('payment')) {
                affectedDomains.add('payment');
            }
            else if (node.filePath.includes('order')) {
                affectedDomains.add('order-management');
            }
            // 子ノードを走査
            for (const child of node.calls) {
                traverse(child, depth + 1);
            }
        };
        // startNodeの子ノードから開始
        for (const child of startNode.calls) {
            traverse(child, 1);
        }
        return {
            directImpact,
            indirectImpact: 0, // YAGNI
            affectedDomains: Array.from(affectedDomains),
            onCriticalPath: false // 別途判定
        };
    }
    async detectBusinessRules(functionBody, typeInfo) {
        // ビジネスルールのパターンを検出
        const businessPatterns = [
            /if\s*\([^)]*\>\s*\d+/, // 数値比較
            /if\s*\([^)]*\<\s*\d+/,
            /\*\s*0\.\d+/, // パーセンテージ計算
            /discount/i, // ビジネス用語
            /tax/i,
            /fee/i,
            /rate/i,
            /customer\.type/i, // ビジネスエンティティ
            /PREMIUM|STANDARD|BASIC/ // ビジネス定数
        ];
        // パターンマッチング
        const hasBusinessPattern = businessPatterns.some(pattern => pattern.test(functionBody));
        // 単純な文字列操作は除外
        const isSimpleUtility = /^\s*return\s+\w+\.(trim|toLowerCase|toUpperCase|split|join)/.test(functionBody);
        return hasBusinessPattern && !isSimpleUtility;
    }
    async isOnCriticalPath(node, domains) {
        // ファイルパスからドメインを推定
        const filePath = node.filePath.toLowerCase();
        // クリティカルなパターン
        const criticalPatterns = domains.map(d => new RegExp(d.replace('-', ''), 'i'));
        return criticalPatterns.some(pattern => pattern.test(filePath));
    }
    /**
     * ドメイン重要度設定を適用
     */
    setDomainImportanceConfig(config) {
        this.importanceConfig = { ...this.importanceConfig, ...config };
    }
}
exports.BusinessLogicMapper = BusinessLogicMapper;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9pbnRlbnQtYW5hbHlzaXMvQnVzaW5lc3NMb2dpY01hcHBlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7O0FBY0gsbUVBQWdFO0FBRWhFLE1BQWEsbUJBQW1CO0lBQ3RCLFlBQVksQ0FBd0I7SUFFNUMsWUFBWTtJQUNKLGdCQUFnQixHQUEyQjtRQUNqRCxTQUFTLEVBQUU7WUFDVCxRQUFRLEVBQUUsRUFBRTtZQUNaLElBQUksRUFBRSxFQUFFO1lBQ1IsTUFBTSxFQUFFLEVBQUU7WUFDVixHQUFHLEVBQUUsRUFBRTtTQUNSO1FBQ0QsZUFBZSxFQUFFLENBQUMsU0FBUyxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLFVBQVUsRUFBRSxTQUFTLENBQUM7UUFDeEYsV0FBVyxFQUFFLEVBQUU7UUFDZixzQkFBc0IsRUFBRSxLQUFLO0tBQzlCLENBQUM7SUFFRjtRQUNFLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSw2Q0FBcUIsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFRCxLQUFLLENBQUMsc0JBQXNCLENBQzFCLFlBQW9CLEVBQ3BCLFNBQTBCLEVBQzFCLFFBQStCO1FBRS9CLCtCQUErQjtRQUMvQixNQUFNLGtCQUFrQixHQUF3QixFQUFFLENBQUM7UUFDbkQsTUFBTSxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUN6QyxNQUFNLGVBQWUsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1FBRTFDLDhCQUE4QjtRQUM5QixLQUFLLE1BQU0sSUFBSSxJQUFJLFNBQVMsRUFBRSxDQUFDO1lBQzdCLE1BQU0sSUFBSSxDQUFDLHlCQUF5QixDQUNsQyxJQUFJLEVBQ0osa0JBQWtCLEVBQ2xCLGNBQWMsRUFDZCxRQUFRLEVBQ1IsZUFBZSxDQUNoQixDQUFDO1FBQ0osQ0FBQztRQUVELDRCQUE0QjtRQUM1QixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztR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c2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9pbnRlbnQtYW5hbHlzaXMvQnVzaW5lc3NMb2dpY01hcHBlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJ1c2luZXNzIExvZ2ljIE1hcHBlclxuICogdjAuOS4wIFBoYXNlIDIgLSDjg4bjgrnjg4jjgajjg5Pjgrjjg43jgrnjg63jgrjjg4Pjgq/jga7plqLpgKPku5jjgZHlrp/oo4VcbiAqIFxuICogS0lTU+WOn+WJhzog44K344Oz44OX44Or44Gq5a6f6KOF44GL44KJ6ZaL5aeLXG4gKiBZQUdOSeWOn+WJhzog5b+F6KaB5pyA5bCP6ZmQ44Gu5qmf6IO944Gu44G/5a6f6KOFXG4gKiBEUlnljp/liYc6IOmHjeikh+OCkumBv+OBkeOCi1xuICovXG5cbmltcG9ydCB7XG4gIElCdXNpbmVzc0xvZ2ljTWFwcGVyLFxuICBCdXNpbmVzc0xvZ2ljTWFwcGluZyxcbiAgQnVzaW5lc3NMb2dpY0ZpbGUsXG4gIEJ1c2luZXNzRnVuY3Rpb24sXG4gIEJ1c2luZXNzQ3JpdGljYWxpdHksXG4gIEltcGFjdFNjb3BlLFxuICBSaXNrQXNzZXNzbWVudCxcbiAgRG9tYWluSW1wb3J0YW5jZUNvbmZpZ1xufSBmcm9tICcuL0lCdXNpbmVzc0xvZ2ljTWFwcGVyJztcbmltcG9ydCB7IENhbGxHcmFwaE5vZGUsIFR5cGVJbmZvIH0gZnJvbSAnLi9JVHlwZVNjcmlwdEFuYWx5emVyJztcbmltcG9ydCB7IERvbWFpbkluZmVyZW5jZSB9IGZyb20gJy4vSURvbWFpbkluZmVyZW5jZUVuZ2luZSc7XG5pbXBvcnQgeyBEb21haW5JbmZlcmVuY2VFbmdpbmUgfSBmcm9tICcuL0RvbWFpbkluZmVyZW5jZUVuZ2luZSc7XG5cbmV4cG9ydCBjbGFzcyBCdXNpbmVzc0xvZ2ljTWFwcGVyIGltcGxlbWVudHMgSUJ1c2luZXNzTG9naWNNYXBwZXIge1xuICBwcml2YXRlIGRvbWFpbkVuZ2luZTogRG9tYWluSW5mZXJlbmNlRW5naW5lO1xuICBcbiAgLy8g44OJ44Oh44Kk44Oz6YeN6KaB5bqm6Kit5a6aXG4gIHByaXZhdGUgaW1wb3J0YW5jZUNvbmZpZzogRG9tYWluSW1wb3J0YW5jZUNvbmZpZyA9IHtcbiAgICB3ZWlnaHRNYXA6IHtcbiAgICAgIGNyaXRpY2FsOiA3MCxcbiAgICAgIGhpZ2g6IDUwLFxuICAgICAgbWVkaXVtOiAzMCxcbiAgICAgIGxvdzogMTVcbiAgICB9LFxuICAgIGNyaXRpY2FsRG9tYWluczogWydwYXltZW50JywgJ2F1dGhlbnRpY2F0aW9uJywgJ3VzZXItbWFuYWdlbWVudCcsICdzZWN1cml0eScsICdiaWxsaW5nJ10sXG4gICAgZG9tYWluQm9udXM6IDE1LFxuICAgIGRpc2FibGVEb21haW5PdmVycmlkZXM6IGZhbHNlXG4gIH07XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5kb21haW5FbmdpbmUgPSBuZXcgRG9tYWluSW5mZXJlbmNlRW5naW5lKCk7XG4gIH1cblxuICBhc3luYyBtYXBUZXN0VG9CdXNpbmVzc0xvZ2ljKFxuICAgIHRlc3RGaWxlUGF0aDogc3RyaW5nLFxuICAgIGNhbGxHcmFwaDogQ2FsbEdyYXBoTm9kZVtdLFxuICAgIHR5cGVJbmZvOiBNYXA8c3RyaW5nLCBUeXBlSW5mbz5cbiAgKTogUHJvbWlzZTxCdXNpbmVzc0xvZ2ljTWFwcGluZz4ge1xuICAgIC8vIOODhuOCueODiOODleOCoeOCpOODq+OBi+OCiemWoumAo+OBmeOCi+ODk+OCuOODjeOCueODreOCuOODg+OCr+ODleOCoeOCpOODq+OCkuWPjumbhlxuICAgIGNvbnN0IGJ1c2luZXNzTG9naWNGaWxlczogQnVzaW5lc3NMb2dpY0ZpbGVbXSA9IFtdO1xuICAgIGNvbnN0IHByb2Nlc3NlZEZpbGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgY29uc3QgYWZmZWN0ZWREb21haW5zID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICAvLyDlkbzjgbPlh7rjgZfjgrDjg6njg5XjgpLotbDmn7vjgZfjgabjg5Pjgrjjg43jgrnjg63jgrjjg4Pjgq/jg5XjgqHjgqTjg6vjgpLlj47pm4ZcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgY2FsbEdyYXBoKSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbGxlY3RCdXNpbmVzc0xvZ2ljRmlsZXMoXG4gICAgICAgIG5vZGUsXG4gICAgICAgIGJ1c2luZXNzTG9naWNGaWxlcyxcbiAgICAgICAgcHJvY2Vzc2VkRmlsZXMsXG4gICAgICAgIHR5cGVJbmZvLFxuICAgICAgICBhZmZlY3RlZERvbWFpbnNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8g44Kr44OQ44Os44OD44K45rex5bqm44Gu6KiI566X77yIS0lTUzog44K344Oz44OX44Or44Gq6KiI566X77yJXG4gICAgY29uc3QgY292ZXJhZ2VEZXB0aCA9IHRoaXMuY2FsY3VsYXRlQ292ZXJhZ2VEZXB0aChidXNpbmVzc0xvZ2ljRmlsZXMpO1xuXG4gICAgLy8g44OT44K444ON44K544Kv44Oq44OG44Kj44Kr44Or5bqm44Gu6KiI566XXG4gICAgY29uc3QgYWxsRnVuY3Rpb25zID0gYnVzaW5lc3NMb2dpY0ZpbGVzLmZsYXRNYXAoZiA9PiBmLmZ1bmN0aW9ucyk7XG4gICAgY29uc3QgcHJpbWFyeURvbWFpbiA9IGJ1c2luZXNzTG9naWNGaWxlc1swXT8uZG9tYWluIHx8IHtcbiAgICAgIGRvbWFpbjogJ3Vua25vd24nLFxuICAgICAgY29uZmlkZW5jZTogMCxcbiAgICAgIGNvbmNlcHRzOiBbXSxcbiAgICAgIGJ1c2luZXNzSW1wb3J0YW5jZTogJ2xvdycgYXMgY29uc3RcbiAgICB9O1xuICAgIGNvbnN0IGJ1c2luZXNzQ3JpdGljYWxpdHkgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZUJ1c2luZXNzSW1wb3J0YW5jZShhbGxGdW5jdGlvbnMsIHByaW1hcnlEb21haW4pO1xuXG4gICAgLy8g5b2x6Z+/56+E5Zuy44Gu5YiG5p6QXG4gICAgY29uc3QgaW1wYWN0U2NvcGU6IEltcGFjdFNjb3BlID0ge1xuICAgICAgZGlyZWN0SW1wYWN0OiBidXNpbmVzc0xvZ2ljRmlsZXMubGVuZ3RoLFxuICAgICAgaW5kaXJlY3RJbXBhY3Q6IDAsIC8vIFlBR05JOiDku4rjga/lrp/oo4XjgZfjgarjgYRcbiAgICAgIGFmZmVjdGVkRG9tYWluczogQXJyYXkuZnJvbShhZmZlY3RlZERvbWFpbnMpLFxuICAgICAgb25Dcml0aWNhbFBhdGg6IGF3YWl0IHRoaXMuY2hlY2tDcml0aWNhbFBhdGgoYnVzaW5lc3NMb2dpY0ZpbGVzKVxuICAgIH07XG5cbiAgICAvLyDjg6rjgrnjgq/oqZXkvqFcbiAgICBjb25zdCByaXNrQXNzZXNzbWVudCA9IHRoaXMuYXNzZXNzUmlzayhidXNpbmVzc0xvZ2ljRmlsZXMsIGNvdmVyYWdlRGVwdGgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRlc3RGaWxlUGF0aCxcbiAgICAgIGJ1c2luZXNzTG9naWNGaWxlcyxcbiAgICAgIGNvdmVyYWdlRGVwdGgsXG4gICAgICBidXNpbmVzc0NyaXRpY2FsaXR5LFxuICAgICAgaW1wYWN0U2NvcGUsXG4gICAgICByaXNrQXNzZXNzbWVudFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNvbGxlY3RCdXNpbmVzc0xvZ2ljRmlsZXMoXG4gICAgbm9kZTogQ2FsbEdyYXBoTm9kZSxcbiAgICBidXNpbmVzc0xvZ2ljRmlsZXM6IEJ1c2luZXNzTG9naWNGaWxlW10sXG4gICAgcHJvY2Vzc2VkRmlsZXM6IFNldDxzdHJpbmc+LFxuICAgIHR5cGVJbmZvOiBNYXA8c3RyaW5nLCBUeXBlSW5mbz4sXG4gICAgYWZmZWN0ZWREb21haW5zOiBTZXQ8c3RyaW5nPlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAocHJvY2Vzc2VkRmlsZXMuaGFzKG5vZGUuZmlsZVBhdGgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHByb2Nlc3NlZEZpbGVzLmFkZChub2RlLmZpbGVQYXRoKTtcblxuICAgIC8vIOODieODoeOCpOODs+aOqOirllxuICAgIGNvbnN0IGRvbWFpbiA9IGF3YWl0IHRoaXMuaW5mZXJEb21haW5Gcm9tRmlsZShub2RlLmZpbGVQYXRoLCB0eXBlSW5mbyk7XG4gICAgaWYgKGRvbWFpbi5kb21haW4gIT09ICd1bmtub3duJykge1xuICAgICAgYWZmZWN0ZWREb21haW5zLmFkZChkb21haW4uZG9tYWluKTtcbiAgICB9XG5cbiAgICAvLyDjg5Pjgrjjg43jgrnplqLmlbDjga7kvZzmiJBcbiAgICBjb25zdCBidXNpbmVzc0Z1bmN0aW9uOiBCdXNpbmVzc0Z1bmN0aW9uID0ge1xuICAgICAgbmFtZTogbm9kZS5uYW1lLFxuICAgICAgbGluZTogbm9kZS5saW5lLFxuICAgICAgaXNUZXN0ZWQ6IHRydWUsIC8vIOODhuOCueODiOOBi+OCieWIsOmBlOWPr+iDveOBquOBruOBp1xuICAgICAgY29tcGxleGl0eTogdGhpcy5lc3RpbWF0ZUNvbXBsZXhpdHkobm9kZSksXG4gICAgICBkZXBlbmRlbmN5Q291bnQ6IG5vZGUuY2FsbHMubGVuZ3RoLFxuICAgICAgY29udGFpbnNCdXNpbmVzc1J1bGVzOiBhd2FpdCB0aGlzLmNoZWNrQnVzaW5lc3NSdWxlcyhub2RlLm5hbWUpXG4gICAgfTtcblxuICAgIC8vIOaXouWtmOOBruODleOCoeOCpOODq+OBq+i/veWKoOOBmeOCi+OBi+OAgeaWsOimj+S9nOaIkFxuICAgIGxldCBmaWxlID0gYnVzaW5lc3NMb2dpY0ZpbGVzLmZpbmQoZiA9PiBmLmZpbGVQYXRoID09PSBub2RlLmZpbGVQYXRoKTtcbiAgICBpZiAoIWZpbGUpIHtcbiAgICAgIGZpbGUgPSB7XG4gICAgICAgIGZpbGVQYXRoOiBub2RlLmZpbGVQYXRoLFxuICAgICAgICBkb21haW4sXG4gICAgICAgIGZ1bmN0aW9uczogW10sXG4gICAgICAgIGltcG9ydGFuY2VTY29yZTogMFxuICAgICAgfTtcbiAgICAgIGJ1c2luZXNzTG9naWNGaWxlcy5wdXNoKGZpbGUpO1xuICAgIH1cbiAgICBmaWxlLmZ1bmN0aW9ucy5wdXNoKGJ1c2luZXNzRnVuY3Rpb24pO1xuXG4gICAgLy8g6YeN6KaB5bqm44K544Kz44Ki44Gu6KiI566XXG4gICAgZmlsZS5pbXBvcnRhbmNlU2NvcmUgPSB0aGlzLmNhbGN1bGF0ZUZpbGVJbXBvcnRhbmNlKGZpbGUpO1xuXG4gICAgLy8g5a2Q44OO44O844OJ44KS5YaN5biw55qE44Gr5Yem55CGXG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlLmNhbGxzKSB7XG4gICAgICBhd2FpdCB0aGlzLmNvbGxlY3RCdXNpbmVzc0xvZ2ljRmlsZXMoXG4gICAgICAgIGNoaWxkLFxuICAgICAgICBidXNpbmVzc0xvZ2ljRmlsZXMsXG4gICAgICAgIHByb2Nlc3NlZEZpbGVzLFxuICAgICAgICB0eXBlSW5mbyxcbiAgICAgICAgYWZmZWN0ZWREb21haW5zXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW5mZXJEb21haW5Gcm9tRmlsZShcbiAgICBmaWxlUGF0aDogc3RyaW5nLFxuICAgIHR5cGVJbmZvOiBNYXA8c3RyaW5nLCBUeXBlSW5mbz5cbiAgKTogUHJvbWlzZTxEb21haW5JbmZlcmVuY2U+IHtcbiAgICAvLyDjg5XjgqHjgqTjg6vjg5HjgrnjgYvjgonjg4njg6HjgqTjg7PjgpLmjqjoq5ZcbiAgICBjb25zdCBwYXRoUGFydHMgPSBmaWxlUGF0aC5zcGxpdCgnLycpO1xuICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aFBhcnRzW3BhdGhQYXJ0cy5sZW5ndGggLSAxXS5yZXBsYWNlKC9cXC4odHN8anMpJC8sICcnKTtcbiAgICBcbiAgICAvLyDjg5XjgqHjgqTjg6vlkI3jgYvjgonlnovmg4XloLHjgpLmjqLjgZlcbiAgICBjb25zdCB0eXBlID0gdHlwZUluZm8uZ2V0KGZpbGVOYW1lKTtcbiAgICBpZiAodHlwZSkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9tYWluRW5naW5lLmluZmVyRG9tYWluRnJvbVR5cGUodHlwZSk7XG4gICAgfVxuXG4gICAgLy8g44K144O844OT44K55ZCN44GL44KJ6Zai6YCj44GZ44KL5Z6L44KS5o6i44GZ77yIVXNlclNlcnZpY2UgLT4gVXNlcu+8iVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHR5cGVJbmZvKSB7XG4gICAgICBpZiAoZmlsZU5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrZXkudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZG9tYWluRW5naW5lLmluZmVyRG9tYWluRnJvbVR5cGUodmFsdWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOODkeOCueODmeODvOOCueOBruaOqOirlu+8iOS/oemgvOW6puOCkuaOp+OBiOOCgeOBq+ioreWumu+8iVxuICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygncGF5bWVudCcpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCdQYXltZW50JykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbWFpbjogJ3BheW1lbnQnLFxuICAgICAgICBjb25maWRlbmNlOiAwLjYsXG4gICAgICAgIGNvbmNlcHRzOiBbJ+axuua4iCddLFxuICAgICAgICBidXNpbmVzc0ltcG9ydGFuY2U6ICdoaWdoJyAgLy8gY3JpdGljYWzjgafjga/jgarjgY9oaWdo44KS44OH44OV44Kp44Or44OI44GrXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJ29yZGVyJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ09yZGVyJykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbWFpbjogJ29yZGVyLW1hbmFnZW1lbnQnLFxuICAgICAgICBjb25maWRlbmNlOiAwLjYsXG4gICAgICAgIGNvbmNlcHRzOiBbJ+azqOaWhyddLFxuICAgICAgICBidXNpbmVzc0ltcG9ydGFuY2U6ICdoaWdoJ1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCd1c2VyJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ1VzZXInKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tYWluOiAndXNlci1tYW5hZ2VtZW50JyxcbiAgICAgICAgY29uZmlkZW5jZTogMC42LFxuICAgICAgICBjb25jZXB0czogWyfjg6bjg7zjgrbjg7znrqHnkIYnXSxcbiAgICAgICAgYnVzaW5lc3NJbXBvcnRhbmNlOiAnaGlnaCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRvbWFpbjogJ3Vua25vd24nLFxuICAgICAgY29uZmlkZW5jZTogMC4zLFxuICAgICAgY29uY2VwdHM6IFtdLFxuICAgICAgYnVzaW5lc3NJbXBvcnRhbmNlOiAnbG93J1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUNvdmVyYWdlRGVwdGgoZmlsZXM6IEJ1c2luZXNzTG9naWNGaWxlW10pOiBudW1iZXIge1xuICAgIGlmIChmaWxlcy5sZW5ndGggPT09IDApIHJldHVybiAwO1xuICAgIFxuICAgIC8vIOmrmOmHjeimgeW6puODleOCoeOCpOODq+OBruWJsuWQiOOBqOODhuOCueODiOa4iOOBv+mWouaVsOOBruWJsuWQiOOBi+OCieioiOeul1xuICAgIGNvbnN0IGltcG9ydGFudEZpbGVzID0gZmlsZXMuZmlsdGVyKGYgPT4gZi5pbXBvcnRhbmNlU2NvcmUgPiA3MCk7XG4gICAgY29uc3QgaW1wb3J0YW5jZVJhdGlvID0gaW1wb3J0YW50RmlsZXMubGVuZ3RoIC8gZmlsZXMubGVuZ3RoO1xuICAgIFxuICAgIGNvbnN0IGFsbEZ1bmN0aW9ucyA9IGZpbGVzLmZsYXRNYXAoZiA9PiBmLmZ1bmN0aW9ucyk7XG4gICAgY29uc3QgdGVzdGVkRnVuY3Rpb25zID0gYWxsRnVuY3Rpb25zLmZpbHRlcihmID0+IGYuaXNUZXN0ZWQpO1xuICAgIGNvbnN0IHRlc3RSYXRpbyA9IHRlc3RlZEZ1bmN0aW9ucy5sZW5ndGggLyAoYWxsRnVuY3Rpb25zLmxlbmd0aCB8fCAxKTtcbiAgICBcbiAgICAvLyDph43jgb/ku5jjgZHlubPlnYfvvIhLSVNT77yJXG4gICAgcmV0dXJuIGltcG9ydGFuY2VSYXRpbyAqIDAuNCArIHRlc3RSYXRpbyAqIDAuNjtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlRmlsZUltcG9ydGFuY2UoZmlsZTogQnVzaW5lc3NMb2dpY0ZpbGUpOiBudW1iZXIge1xuICAgIGNvbnN0IGRvbWFpbldlaWdodCA9IHRoaXMuZ2V0RG9tYWluV2VpZ2h0KGZpbGUuZG9tYWluLmJ1c2luZXNzSW1wb3J0YW5jZSk7XG4gICAgY29uc3QgY29tcGxleGl0eVNjb3JlID0gTWF0aC5taW4oXG4gICAgICAxMDAsXG4gICAgICBmaWxlLmZ1bmN0aW9ucy5yZWR1Y2UoKHN1bSwgZikgPT4gc3VtICsgZi5jb21wbGV4aXR5ICogNSwgMClcbiAgICApO1xuICAgIGNvbnN0IGJ1c2luZXNzUnVsZVNjb3JlID0gZmlsZS5mdW5jdGlvbnMuZmlsdGVyKGYgPT4gZi5jb250YWluc0J1c2luZXNzUnVsZXMpLmxlbmd0aCAqIDIwO1xuICAgIFxuICAgIC8vIOioreWumuOBleOCjOOBn+OCr+ODquODhuOCo+OCq+ODq+ODieODoeOCpOODs+OBq+WvvuOBl+OBpuODnOODvOODiuOCueOCkuS7mOS4jlxuICAgIGNvbnN0IGNyaXRpY2FsRG9tYWlucyA9IHRoaXMuaW1wb3J0YW5jZUNvbmZpZy5jcml0aWNhbERvbWFpbnMgfHwgW107XG4gICAgY29uc3QgZG9tYWluQm9udXMgPSBjcml0aWNhbERvbWFpbnMuaW5jbHVkZXMoZmlsZS5kb21haW4uZG9tYWluKSBcbiAgICAgID8gKHRoaXMuaW1wb3J0YW5jZUNvbmZpZy5kb21haW5Cb251cyB8fCAxNSkgXG4gICAgICA6IDA7XG4gICAgXG4gICAgcmV0dXJuIE1hdGgubWluKDEwMCwgZG9tYWluV2VpZ2h0ICsgY29tcGxleGl0eVNjb3JlICogMC4zICsgYnVzaW5lc3NSdWxlU2NvcmUgKiAwLjUgKyBkb21haW5Cb251cyk7XG4gIH1cblxuICBwcml2YXRlIGdldERvbWFpbldlaWdodChpbXBvcnRhbmNlOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIC8vIOioreWumuOBleOCjOOBn+mHjeOBv+S7mOOBkeOCkuS9v+eUqO+8iOioreWumuOBjOOBquOBhOWgtOWQiOOBr+ODh+ODleOCqeODq+ODiOWApO+8iVxuICAgIGlmICh0aGlzLmltcG9ydGFuY2VDb25maWcud2VpZ2h0TWFwKSB7XG4gICAgICBjb25zdCBrZXkgPSBpbXBvcnRhbmNlIGFzIGtleW9mIHR5cGVvZiB0aGlzLmltcG9ydGFuY2VDb25maWcud2VpZ2h0TWFwO1xuICAgICAgcmV0dXJuIHRoaXMuaW1wb3J0YW5jZUNvbmZpZy53ZWlnaHRNYXBba2V5XSA/PyAxNTtcbiAgICB9XG4gICAgXG4gICAgLy8g44OH44OV44Kp44Or44OI5YCkXG4gICAgY29uc3QgZGVmYXVsdFdlaWdodHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgICBjcml0aWNhbDogNzAsXG4gICAgICBoaWdoOiA1MCxcbiAgICAgIG1lZGl1bTogMzAsXG4gICAgICBsb3c6IDE1XG4gICAgfTtcbiAgICByZXR1cm4gZGVmYXVsdFdlaWdodHNbaW1wb3J0YW5jZV0gfHwgMTU7XG4gIH1cblxuICBwcml2YXRlIGVzdGltYXRlQ29tcGxleGl0eShub2RlOiBDYWxsR3JhcGhOb2RlKTogbnVtYmVyIHtcbiAgICAvLyBLSVNTOiDnsKHljZjjgarmjqjlrppcbiAgICByZXR1cm4gNSArIG5vZGUuY2FsbHMubGVuZ3RoICogMjtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2hlY2tCdXNpbmVzc1J1bGVzKGZ1bmN0aW9uTmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gS0lTUzog6Zai5pWw5ZCN44GL44KJ44Gu57Ch5Y2Y44Gq5o6o5a6aXG4gICAgY29uc3QgYnVzaW5lc3NSdWxlUGF0dGVybnMgPSBbXG4gICAgICAvY2FsY3VsYXRlL2ksXG4gICAgICAvdmFsaWRhdGUvaSxcbiAgICAgIC9wcm9jZXNzL2ksXG4gICAgICAvY2hlY2svaSxcbiAgICAgIC92ZXJpZnkvaSxcbiAgICAgIC90YXgvaSxcbiAgICAgIC9kaXNjb3VudC9pLFxuICAgICAgL3BheW1lbnQvaSxcbiAgICAgIC9vcmRlci9pXG4gICAgXTtcbiAgICBcbiAgICByZXR1cm4gYnVzaW5lc3NSdWxlUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHBhdHRlcm4udGVzdChmdW5jdGlvbk5hbWUpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2hlY2tDcml0aWNhbFBhdGgoZmlsZXM6IEJ1c2luZXNzTG9naWNGaWxlW10pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyDjgq/jg6rjg4bjgqPjgqvjg6vjgarjg4njg6HjgqTjg7PjgavlsZ7jgZnjgovjg5XjgqHjgqTjg6vjgYzjgYLjgovjgYvjg4Hjgqfjg4Pjgq9cbiAgICBjb25zdCBjcml0aWNhbERvbWFpbnMgPSBbJ3BheW1lbnQnLCAnYXV0aGVudGljYXRpb24nLCAnYmlsbGluZycsICdvcmRlci1tYW5hZ2VtZW50J107XG4gICAgcmV0dXJuIGZpbGVzLnNvbWUoZiA9PiBjcml0aWNhbERvbWFpbnMuaW5jbHVkZXMoZi5kb21haW4uZG9tYWluKSk7XG4gIH1cblxuICBwcml2YXRlIGFzc2Vzc1Jpc2soZmlsZXM6IEJ1c2luZXNzTG9naWNGaWxlW10sIGNvdmVyYWdlRGVwdGg6IG51bWJlcik6IFJpc2tBc3Nlc3NtZW50IHtcbiAgICAvLyDjgqvjg5Djg6zjg4Pjgrjjg6rjgrnjgq9cbiAgICBjb25zdCBjb3ZlcmFnZVJpc2sgPSBjb3ZlcmFnZURlcHRoIDwgMC41ID8gJ2hpZ2gnIDogY292ZXJhZ2VEZXB0aCA8IDAuNyA/ICdtZWRpdW0nIDogJ2xvdyc7XG4gICAgXG4gICAgLy8g6KSH6ZuR5bqm44Oq44K544KvXG4gICAgY29uc3QgYXZnQ29tcGxleGl0eSA9IHRoaXMuY2FsY3VsYXRlQXZlcmFnZUNvbXBsZXhpdHkoZmlsZXMpO1xuICAgIGNvbnN0IGNvbXBsZXhpdHlSaXNrID0gYXZnQ29tcGxleGl0eSA+IDEwID8gJ2hpZ2gnIDogYXZnQ29tcGxleGl0eSA+IDUgPyAnbWVkaXVtJyA6ICdsb3cnO1xuICAgIFxuICAgIC8vIOWkieabtOODquOCueOCr++8iFlBR05JOiDku4rjga/nsKHljZjjgarlrp/oo4XvvIlcbiAgICBjb25zdCBjaGFuZ2VSaXNrID0gJ21lZGl1bSc7XG4gICAgXG4gICAgLy8g57eP5ZCI44Oq44K544Kv44K544Kz44KiXG4gICAgY29uc3Qgcmlza1Njb3JlcyA9IHsgaGlnaDogMzAsIG1lZGl1bTogMjAsIGxvdzogMTAgfTtcbiAgICBjb25zdCBvdmVyYWxsUmlza1Njb3JlID0gXG4gICAgICByaXNrU2NvcmVzW2NvdmVyYWdlUmlza10gKyBcbiAgICAgIHJpc2tTY29yZXNbY29tcGxleGl0eVJpc2tdICsgXG4gICAgICByaXNrU2NvcmVzW2NoYW5nZVJpc2tdO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBjb3ZlcmFnZVJpc2ssXG4gICAgICBjb21wbGV4aXR5UmlzayxcbiAgICAgIGNoYW5nZVJpc2ssXG4gICAgICBvdmVyYWxsUmlza1Njb3JlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQXZlcmFnZUNvbXBsZXhpdHkoZmlsZXM6IEJ1c2luZXNzTG9naWNGaWxlW10pOiBudW1iZXIge1xuICAgIGNvbnN0IGFsbEZ1bmN0aW9ucyA9IGZpbGVzLmZsYXRNYXAoZiA9PiBmLmZ1bmN0aW9ucyk7XG4gICAgaWYgKGFsbEZ1bmN0aW9ucy5sZW5ndGggPT09IDApIHJldHVybiAwO1xuICAgIFxuICAgIGNvbnN0IHRvdGFsQ29tcGxleGl0eSA9IGFsbEZ1bmN0aW9ucy5yZWR1Y2UoKHN1bSwgZikgPT4gc3VtICsgZi5jb21wbGV4aXR5LCAwKTtcbiAgICByZXR1cm4gdG90YWxDb21wbGV4aXR5IC8gYWxsRnVuY3Rpb25zLmxlbmd0aDtcbiAgfVxuXG4gIGFzeW5jIGNhbGN1bGF0ZUJ1c2luZXNzSW1wb3J0YW5jZShcbiAgICBmdW5jdGlvbnM6IEJ1c2luZXNzRnVuY3Rpb25bXSxcbiAgICBkb21haW46IERvbWFpbkluZmVyZW5jZVxuICApOiBQcm9taXNlPEJ1c2luZXNzQ3JpdGljYWxpdHk+IHtcbiAgICBjb25zdCByZWFzb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzY29yZSA9IDA7XG5cbiAgICAvLyDlhajjgabjga7plqLmlbDjgYzljZjntJTvvIjopIfpm5HluqbkvY7jgIHkvp3lrZjjgarjgZfvvInjgYvjg4Hjgqfjg4Pjgq9cbiAgICBjb25zdCBhbGxTaW1wbGUgPSBmdW5jdGlvbnMuZXZlcnkoZiA9PiBcbiAgICAgIGYuY29tcGxleGl0eSA8PSA3ICYmIGYuZGVwZW5kZW5jeUNvdW50ID09PSAwXG4gICAgKTtcblxuICAgIC8vIOWNmOe0lOOBqumWouaVsOOBruOBv+OBruWgtOWQiOOBr+OAgeODieODoeOCpOODs+OBq+mWouOCj+OCieOBmmxvd+OBqOOBmeOCi1xuICAgIGlmIChhbGxTaW1wbGUgJiYgZnVuY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlYXNvbnMucHVzaCgn5YWo44Gm44Gu6Zai5pWw44GM5Y2Y57SU77yI5L2O6KSH6ZuR5bqm44CB5L6d5a2Y6Zai5L+C44Gq44GX77yJJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZXZlbDogJ2xvdycsXG4gICAgICAgIHNjb3JlOiAzMCxcbiAgICAgICAgcmVhc29uc1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyDjg4njg6HjgqTjg7Pjga7ph43opoHluqbjgpLln7rmupbjgrnjgrPjgqLjgajjgZnjgotcbiAgICBzY29yZSArPSB0aGlzLmdldERvbWFpbldlaWdodChkb21haW4uYnVzaW5lc3NJbXBvcnRhbmNlKTtcblxuICAgIC8vIOODk+OCuOODjeOCueODq+ODvOODq+OCkuWQq+OCgOmWouaVsOOBruipleS+oVxuICAgIGNvbnN0IGJ1c2luZXNzUnVsZUZ1bmN0aW9ucyA9IGZ1bmN0aW9ucy5maWx0ZXIoZiA9PiBmLmNvbnRhaW5zQnVzaW5lc3NSdWxlcyk7XG4gICAgaWYgKGJ1c2luZXNzUnVsZUZ1bmN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICByZWFzb25zLnB1c2goJ+ODk+OCuOODjeOCueODq+ODvOODq+OCkuWQq+OCgOmWouaVsOOBjOWtmOWcqCcpO1xuICAgICAgc2NvcmUgKz0gYnVzaW5lc3NSdWxlRnVuY3Rpb25zLmxlbmd0aCAqIDEwO1xuICAgIH1cblxuICAgIC8vIOmrmOikh+mbkeW6pumWouaVsOOBruipleS+oVxuICAgIGNvbnN0IGNvbXBsZXhGdW5jdGlvbnMgPSBmdW5jdGlvbnMuZmlsdGVyKGYgPT4gZi5jb21wbGV4aXR5ID49IDE1KTtcbiAgICBpZiAoY29tcGxleEZ1bmN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICByZWFzb25zLnB1c2goJ+mrmOikh+mbkeW6puOBrumWouaVsOOBjOWtmOWcqCcpO1xuICAgICAgc2NvcmUgKz0gY29tcGxleEZ1bmN0aW9ucy5sZW5ndGggKiAxMDtcbiAgICB9XG5cbiAgICAvLyDkvp3lrZjplqLkv4Ljga7lpJrjgYTplqLmlbDjga7oqZXkvqFcbiAgICBjb25zdCBoaWdoRGVwZW5kZW5jeUZ1bmN0aW9ucyA9IGZ1bmN0aW9ucy5maWx0ZXIoZiA9PiBmLmRlcGVuZGVuY3lDb3VudCA+IDMpO1xuICAgIGlmIChoaWdoRGVwZW5kZW5jeUZ1bmN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICByZWFzb25zLnB1c2goJ+S+neWtmOmWouS/guOBruWkmuOBhOmWouaVsOOBjOWtmOWcqCcpO1xuICAgICAgc2NvcmUgKz0gaGlnaERlcGVuZGVuY3lGdW5jdGlvbnMubGVuZ3RoICogMztcbiAgICB9XG5cbiAgICAvLyDjg6zjg5njg6vjga7liKTlrppcbiAgICBsZXQgbGV2ZWw6ICdjcml0aWNhbCcgfCAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnO1xuICAgIC8vIGJpbGxpbmcg44OJ44Oh44Kk44Oz44GL44Gk44OT44K444ON44K544Or44O844Or44KS5ZCr44KA5aC05ZCI44Gv54m55Yil5omx44GEXG4gICAgaWYgKGRvbWFpbi5kb21haW4gPT09ICdiaWxsaW5nJyAmJiBidXNpbmVzc1J1bGVGdW5jdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgbGV2ZWwgPSAnaGlnaCc7XG4gICAgICBzY29yZSA9IE1hdGgubWF4KHNjb3JlLCA3Nik7IC8vIOacgOS9juOBp+OCgjc254K544KS5L+d6Ki8XG4gICAgfSBlbHNlIGlmIChzY29yZSA+PSA4MCkge1xuICAgICAgbGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gNjApIHtcbiAgICAgIGxldmVsID0gJ2hpZ2gnO1xuICAgIH0gZWxzZSBpZiAoc2NvcmUgPj0gNDApIHtcbiAgICAgIGxldmVsID0gJ21lZGl1bSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldmVsID0gJ2xvdyc7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxldmVsLFxuICAgICAgcmVhc29ucyxcbiAgICAgIHNjb3JlOiBNYXRoLm1pbigxMDAsIHNjb3JlKVxuICAgIH07XG4gIH1cblxuICBhc3luYyBhbmFseXplSW1wYWN0U2NvcGUoXG4gICAgY2FsbEdyYXBoOiBDYWxsR3JhcGhOb2RlW10sXG4gICAgc3RhcnROb2RlOiBDYWxsR3JhcGhOb2RlXG4gICk6IFByb21pc2U8SW1wYWN0U2NvcGU+IHtcbiAgICBjb25zdCB2aXNpdGVkID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgY29uc3QgYWZmZWN0ZWREb21haW5zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgbGV0IGRpcmVjdEltcGFjdCA9IDA7XG5cbiAgICAvLyBERlPjgaflvbHpn7/nr4Tlm7LjgpLmjqLntKJcbiAgICBjb25zdCB0cmF2ZXJzZSA9IChub2RlOiBDYWxsR3JhcGhOb2RlLCBkZXB0aDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBub2RlSWQgPSBgJHtub2RlLmZpbGVQYXRofToke25vZGUubmFtZX1gO1xuICAgICAgaWYgKHZpc2l0ZWQuaGFzKG5vZGVJZCkpIHJldHVybjtcbiAgICAgIHZpc2l0ZWQuYWRkKG5vZGVJZCk7XG5cbiAgICAgIGlmIChkZXB0aCA+IDApIHsgIC8vIDDjgojjgorlpKfjgY3jgYTloLTlkIjjga/nm7TmjqXlvbHpn79cbiAgICAgICAgZGlyZWN0SW1wYWN0Kys7XG4gICAgICB9XG5cbiAgICAgIC8vIOODieODoeOCpOODs+aOqOirlu+8iOewoeaYk+eJiO+8iVxuICAgICAgaWYgKG5vZGUuZmlsZVBhdGguaW5jbHVkZXMoJ3BheW1lbnQnKSkge1xuICAgICAgICBhZmZlY3RlZERvbWFpbnMuYWRkKCdwYXltZW50Jyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUuZmlsZVBhdGguaW5jbHVkZXMoJ29yZGVyJykpIHtcbiAgICAgICAgYWZmZWN0ZWREb21haW5zLmFkZCgnb3JkZXItbWFuYWdlbWVudCcpO1xuICAgICAgfVxuXG4gICAgICAvLyDlrZDjg47jg7zjg4njgpLotbDmn7tcbiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5jYWxscykge1xuICAgICAgICB0cmF2ZXJzZShjaGlsZCwgZGVwdGggKyAxKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gc3RhcnROb2Rl44Gu5a2Q44OO44O844OJ44GL44KJ6ZaL5aeLXG4gICAgZm9yIChjb25zdCBjaGlsZCBvZiBzdGFydE5vZGUuY2FsbHMpIHtcbiAgICAgIHRyYXZlcnNlKGNoaWxkLCAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGlyZWN0SW1wYWN0LFxuICAgICAgaW5kaXJlY3RJbXBhY3Q6IDAsIC8vIFlBR05JXG4gICAgICBhZmZlY3RlZERvbWFpbnM6IEFycmF5LmZyb20oYWZmZWN0ZWREb21haW5zKSxcbiAgICAgIG9uQ3JpdGljYWxQYXRoOiBmYWxzZSAvLyDliKXpgJTliKTlrppcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZGV0ZWN0QnVzaW5lc3NSdWxlcyhcbiAgICBmdW5jdGlvbkJvZHk6IHN0cmluZyxcbiAgICB0eXBlSW5mbzogTWFwPHN0cmluZywgVHlwZUluZm8+XG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIOODk+OCuOODjeOCueODq+ODvOODq+OBruODkeOCv+ODvOODs+OCkuaknOWHulxuICAgIGNvbnN0IGJ1c2luZXNzUGF0dGVybnMgPSBbXG4gICAgICAvaWZcXHMqXFwoW14pXSpcXD5cXHMqXFxkKy8sICAgICAvLyDmlbDlgKTmr5TovINcbiAgICAgIC9pZlxccypcXChbXildKlxcPFxccypcXGQrLyxcbiAgICAgIC9cXCpcXHMqMFxcLlxcZCsvLCAgICAgICAgICAgICAgLy8g44OR44O844K744Oz44OG44O844K46KiI566XXG4gICAgICAvZGlzY291bnQvaSwgICAgICAgICAgICAgICAgIC8vIOODk+OCuOODjeOCueeUqOiqnlxuICAgICAgL3RheC9pLFxuICAgICAgL2ZlZS9pLFxuICAgICAgL3JhdGUvaSxcbiAgICAgIC9jdXN0b21lclxcLnR5cGUvaSwgICAgICAgICAgLy8g44OT44K444ON44K544Ko44Oz44OG44Kj44OG44KjXG4gICAgICAvUFJFTUlVTXxTVEFOREFSRHxCQVNJQy8gICAgLy8g44OT44K444ON44K55a6a5pWwXG4gICAgXTtcblxuICAgIC8vIOODkeOCv+ODvOODs+ODnuODg+ODgeODs+OCsFxuICAgIGNvbnN0IGhhc0J1c2luZXNzUGF0dGVybiA9IGJ1c2luZXNzUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHBhdHRlcm4udGVzdChmdW5jdGlvbkJvZHkpKTtcbiAgICBcbiAgICAvLyDljZjntJTjgarmloflrZfliJfmk43kvZzjga/pmaTlpJZcbiAgICBjb25zdCBpc1NpbXBsZVV0aWxpdHkgPSAvXlxccypyZXR1cm5cXHMrXFx3K1xcLih0cmltfHRvTG93ZXJDYXNlfHRvVXBwZXJDYXNlfHNwbGl0fGpvaW4pLy50ZXN0KGZ1bmN0aW9uQm9keSk7XG4gICAgXG4gICAgcmV0dXJuIGhhc0J1c2luZXNzUGF0dGVybiAmJiAhaXNTaW1wbGVVdGlsaXR5O1xuICB9XG5cbiAgYXN5bmMgaXNPbkNyaXRpY2FsUGF0aChcbiAgICBub2RlOiBDYWxsR3JhcGhOb2RlLFxuICAgIGRvbWFpbnM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIOODleOCoeOCpOODq+ODkeOCueOBi+OCieODieODoeOCpOODs+OCkuaOqOWumlxuICAgIGNvbnN0IGZpbGVQYXRoID0gbm9kZS5maWxlUGF0aC50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIC8vIOOCr+ODquODhuOCo+OCq+ODq+OBquODkeOCv+ODvOODs1xuICAgIGNvbnN0IGNyaXRpY2FsUGF0dGVybnMgPSBkb21haW5zLm1hcChkID0+IG5ldyBSZWdFeHAoZC5yZXBsYWNlKCctJywgJycpLCAnaScpKTtcbiAgICBcbiAgICByZXR1cm4gY3JpdGljYWxQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gcGF0dGVybi50ZXN0KGZpbGVQYXRoKSk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiDjg4njg6HjgqTjg7Pph43opoHluqboqK3lrprjgpLpgannlKhcbiAgICovXG4gIHNldERvbWFpbkltcG9ydGFuY2VDb25maWcoY29uZmlnOiBEb21haW5JbXBvcnRhbmNlQ29uZmlnKTogdm9pZCB7XG4gICAgdGhpcy5pbXBvcnRhbmNlQ29uZmlnID0geyAuLi50aGlzLmltcG9ydGFuY2VDb25maWcsIC4uLmNvbmZpZyB9O1xuICB9XG59Il0sInZlcnNpb24iOjN9