d24bcbcc2ad78ae03230d803a392e05b
"use strict";
/**
 * Domain Inference Engine
 * v0.9.0 Phase 2 - 型名からドメイン概念を推論する実装
 *
 * KISS原則: シンプルなパターンマッチングから開始
 * YAGNI原則: 必要最小限の機能のみ実装
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DomainInferenceEngine = void 0;
class DomainInferenceEngine {
    // ドメイン辞書（シンプルなマップとして実装）
    domainDictionary = {
        terms: [],
        rules: []
    };
    // 信頼度設定
    confidenceConfig = {
        defaultConfidence: 0.5,
        evidenceBoostFactor: 0.1
    };
    // 組み込みのドメインパターン（設定可能な信頼度を持つ）
    builtInPatterns = new Map([
        ['User', { domain: 'user-management', confidence: 0.7, concepts: ['ユーザー', '認証', 'アカウント管理'], importance: 'high' }],
        ['PaymentService', { domain: 'payment', confidence: 0.75, concepts: ['決済', '支払い', 'トランザクション'], importance: 'high' }],
        ['Order', { domain: 'order-management', confidence: 0.65, concepts: ['注文'], importance: 'high' }],
        ['AuthenticationService', { domain: 'authentication', confidence: 0.75, concepts: ['認証', 'アクセス制御', 'セキュリティ'], importance: 'high' }],
        ['Invoice', { domain: 'billing', confidence: 0.7, concepts: ['請求', '課金'], importance: 'high' }],
        ['InvoiceProcessor', { domain: 'billing', confidence: 0.7, concepts: ['請求', '課金', '会計', '税務'], importance: 'high' }]
    ]);
    // ドメイン重要度マップ（控えめなデフォルト値）
    domainImportanceMap = new Map([
        ['payment', 'high'],
        ['authentication', 'high'],
        ['billing', 'high'],
        ['user-management', 'high'],
        ['order-management', 'high'],
        ['logging', 'medium'],
        ['utility', 'low'],
        ['general', 'low']
    ]);
    async inferDomainFromType(typeInfo) {
        // プリミティブ型の場合
        if (typeInfo.isPrimitive) {
            return {
                domain: 'general',
                confidence: 0.1,
                concepts: [],
                businessImportance: 'low'
            };
        }
        // ジェネリック型の場合、型引数も考慮
        if (typeInfo.typeArguments && typeInfo.typeArguments.length > 0) {
            const baseType = this.builtInPatterns.get(typeInfo.typeName);
            const argType = typeInfo.typeArguments[0];
            const argPattern = this.builtInPatterns.get(argType.typeName);
            if (typeInfo.typeName === 'Repository' && argPattern) {
                return {
                    domain: argPattern.domain,
                    confidence: Math.min(0.8, argPattern.confidence + 0.1), // 複合証拠によるわずかな増加
                    concepts: [...argPattern.concepts, 'リポジトリ', 'データアクセス'],
                    businessImportance: argPattern.importance
                };
            }
        }
        // 組み込みパターンから検索
        const pattern = this.builtInPatterns.get(typeInfo.typeName);
        if (pattern) {
            return {
                domain: pattern.domain,
                confidence: this.getConfidence(typeInfo.typeName, pattern.confidence),
                concepts: pattern.concepts,
                businessImportance: pattern.importance
            };
        }
        // 辞書から検索（YAGNI: 今は基本的な実装のみ）
        const dictEntry = this.domainDictionary.terms.find(t => t.term === typeInfo.typeName);
        if (dictEntry) {
            const importance = await this.getDomainImportance(dictEntry.domain);
            return {
                domain: dictEntry.domain,
                confidence: dictEntry.weight,
                concepts: this.inferConceptsFromDomain(dictEntry.domain),
                businessImportance: importance
            };
        }
        // ルールベースのマッチング
        let bestMatch = null;
        let maxConfidence = 0;
        for (const rule of this.domainDictionary.rules) {
            if (rule.pattern.test(typeInfo.typeName)) {
                const importance = await this.getDomainImportance(rule.domain);
                const concepts = this.inferConceptsFromDomain(rule.domain);
                // Service系の場合は追加の概念を付与
                if (typeInfo.typeName.endsWith('Service')) {
                    concepts.push('サービス層');
                }
                // 複合的な名前の場合（例：UserService）、複数のパターンを考慮
                let combinedConfidence = rule.weight;
                const baseConcepts = [];
                // 複合名の各部分をチェック
                for (const [name, pattern] of this.builtInPatterns) {
                    if (typeInfo.typeName.includes(name) && name !== typeInfo.typeName) {
                        combinedConfidence = Math.min(1.0, combinedConfidence + pattern.confidence * 0.3);
                        baseConcepts.push(...pattern.concepts);
                    }
                }
                // 辞書の用語も考慮
                for (const term of this.domainDictionary.terms) {
                    if (typeInfo.typeName.includes(term.term) && term.term !== typeInfo.typeName) {
                        combinedConfidence = Math.min(1.0, combinedConfidence + term.weight * 0.3);
                        baseConcepts.push(...this.inferConceptsFromDomain(term.domain));
                    }
                }
                // ユニークな概念のみを保持
                const uniqueConcepts = [...new Set([...baseConcepts, ...concepts])];
                if (combinedConfidence > maxConfidence) {
                    maxConfidence = combinedConfidence;
                    bestMatch = {
                        domain: rule.domain,
                        confidence: combinedConfidence,
                        concepts: uniqueConcepts,
                        businessImportance: importance
                    };
                }
            }
        }
        if (bestMatch) {
            return bestMatch;
        }
        // デフォルト
        return {
            domain: 'unknown',
            confidence: 0.3,
            concepts: [],
            businessImportance: 'low'
        };
    }
    async inferDomainFromContext(context) {
        // ファイルパスからドメインを推論
        const pathParts = context.filePath.split('/');
        let inferredDomain = '';
        let confidence = 0;
        const concepts = [];
        // パスベースの推論（設定可能な信頼度を使用）
        if (pathParts.includes('auth') || pathParts.includes('authentication')) {
            inferredDomain = 'authentication';
            confidence = this.confidenceConfig.domainConfidenceMap?.['authentication'] || 0.9;
            concepts.push('認証', 'アクセス制御', 'セキュリティ');
        }
        else if (pathParts.includes('billing')) {
            inferredDomain = 'billing';
            confidence = this.confidenceConfig.domainConfidenceMap?.['billing'] || 0.88;
            concepts.push('請求', '課金');
        }
        else if (pathParts.includes('payment')) {
            inferredDomain = 'payment';
            confidence = this.confidenceConfig.domainConfidenceMap?.['payment'] || 0.9;
            concepts.push('決済', '支払い');
        }
        // クラス名からの推論
        if (context.className) {
            const classPattern = this.builtInPatterns.get(context.className);
            if (classPattern) {
                inferredDomain = classPattern.domain;
                confidence = Math.max(confidence, classPattern.confidence);
                classPattern.concepts.forEach(c => {
                    if (!concepts.includes(c))
                        concepts.push(c);
                });
            }
        }
        // インポートからの推論
        const importDomains = new Set();
        const uniqueRelatedDomains = new Set();
        for (const imp of context.imports) {
            const pattern = this.builtInPatterns.get(imp);
            if (pattern) {
                importDomains.add(pattern.domain);
                // inferDomainFromContextで概念を追加する際、クラス名由来の概念と重複しないようにする
                if (context.className !== imp) {
                    pattern.concepts.forEach(c => {
                        if (!concepts.includes(c))
                            concepts.push(c);
                    });
                }
            }
            // 特定のインポートパターン
            if (imp === 'TaxCalculator') {
                if (!concepts.includes('税務'))
                    concepts.push('税務');
                if (inferredDomain === 'billing' && !concepts.includes('会計')) {
                    concepts.push('会計');
                }
            }
            if (imp === 'Token' || imp === 'Permission') {
                uniqueRelatedDomains.add('security');
            }
            if (imp === 'Customer') {
                uniqueRelatedDomains.add('accounting');
            }
        }
        // 関連ドメインの設定
        if (inferredDomain === 'authentication') {
            uniqueRelatedDomains.add('user-management');
        }
        else if (inferredDomain === 'billing') {
            // Paymentインポートがあるかチェック
            for (const imp of context.imports) {
                if (imp === 'Payment') {
                    uniqueRelatedDomains.add('payment');
                    break;
                }
            }
        }
        // uniqueRelatedDomainsからrelatedDomains配列を生成（順序付き）
        const orderedRelatedDomains = Array.from(uniqueRelatedDomains).sort();
        const importance = await this.getDomainImportance(inferredDomain);
        return {
            domain: inferredDomain,
            confidence,
            concepts,
            businessImportance: importance,
            relatedDomains: orderedRelatedDomains.length > 0 ? orderedRelatedDomains : undefined
        };
    }
    async getDomainImportance(domain) {
        return this.domainImportanceMap.get(domain) || 'medium';
    }
    async loadDictionary(dictionary) {
        // 辞書をマージ（DRY原則: 既存の辞書に追加）
        this.domainDictionary.terms.push(...dictionary.terms);
        this.domainDictionary.rules.push(...dictionary.rules);
    }
    mergeInferences(inferences) {
        if (inferences.length === 0) {
            return {
                domain: 'unknown',
                confidence: 0,
                concepts: [],
                businessImportance: 'low'
            };
        }
        // 最も信頼度の高い推論を選択（KISS原則）
        const best = inferences.reduce((prev, curr) => curr.confidence > prev.confidence ? curr : prev);
        // 全ての概念を統合
        const allConcepts = new Set();
        inferences.forEach(inf => inf.concepts.forEach(c => allConcepts.add(c)));
        return {
            ...best,
            concepts: Array.from(allConcepts)
        };
    }
    // プライベートヘルパーメソッド
    inferConceptsFromDomain(domain) {
        const conceptMap = {
            'user-management': ['ユーザー'],
            'service-layer': [],
            'data-access': ['データアクセス']
        };
        return conceptMap[domain] || [];
    }
    /**
     * 信頼度設定を適用
     */
    setConfidenceConfig(config) {
        this.confidenceConfig = { ...this.confidenceConfig, ...config };
        // typeConfidenceMapが設定されている場合、builtInPatternsを更新
        if (config.typeConfidenceMap) {
            for (const [typeName, confidence] of Object.entries(config.typeConfidenceMap)) {
                const pattern = this.builtInPatterns.get(typeName);
                if (pattern) {
                    pattern.confidence = confidence;
                }
            }
        }
    }
    /**
     * 設定された信頼度を取得（設定がない場合はデフォルト値を返す）
     */
    getConfidence(typeName, defaultValue) {
        // 設定された信頼度マップから取得
        if (this.confidenceConfig.typeConfidenceMap?.[typeName] !== undefined) {
            return this.confidenceConfig.typeConfidenceMap[typeName];
        }
        // builtInPatternsから取得
        const pattern = this.builtInPatterns.get(typeName);
        if (pattern) {
            return pattern.confidence;
        }
        // デフォルト値を返す
        return defaultValue;
    }
}
exports.DomainInferenceEngine = DomainInferenceEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9pbnRlbnQtYW5hbHlzaXMvRG9tYWluSW5mZXJlbmNlRW5naW5lLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQVlILE1BQWEscUJBQXFCO0lBQ2hDLHdCQUF3QjtJQUNoQixnQkFBZ0IsR0FBcUI7UUFDM0MsS0FBSyxFQUFFLEVBQUU7UUFDVCxLQUFLLEVBQUUsRUFBRTtLQUNWLENBQUM7SUFFRixRQUFRO0lBQ0EsZ0JBQWdCLEdBQXFCO1FBQzNDLGlCQUFpQixFQUFFLEdBQUc7UUFDdEIsbUJBQW1CLEVBQUUsR0FBRztLQUN6QixDQUFDO0lBRUYsNkJBQTZCO0lBQ3JCLGVBQWUsR0FBRyxJQUFJLEdBQUcsQ0FBcUc7UUFDcEksQ0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQztRQUNqSCxDQUFDLGdCQUFnQixFQUFFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDO1FBQ3BILENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDO1FBQ2pHLENBQUMsdUJBQXVCLEVBQUUsRUFBRSxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsQ0FBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsQ0FBQztR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QUFZLENBQUM7SUFDdEIsQ0FBQztDQUNGO0FBaFVELHNEQWdVQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc2FzYWthbWEvUHJvamVjdHMvUmltb3Ivc3JjL2ludGVudC1hbmFseXNpcy9Eb21haW5JbmZlcmVuY2VFbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEb21haW4gSW5mZXJlbmNlIEVuZ2luZVxuICogdjAuOS4wIFBoYXNlIDIgLSDlnovlkI3jgYvjgonjg4njg6HjgqTjg7PmpoLlv7XjgpLmjqjoq5bjgZnjgovlrp/oo4VcbiAqIFxuICogS0lTU+WOn+WJhzog44K344Oz44OX44Or44Gq44OR44K/44O844Oz44Oe44OD44OB44Oz44Kw44GL44KJ6ZaL5aeLXG4gKiBZQUdOSeWOn+WJhzog5b+F6KaB5pyA5bCP6ZmQ44Gu5qmf6IO944Gu44G/5a6f6KOFXG4gKi9cblxuaW1wb3J0IHsgXG4gIElEb21haW5JbmZlcmVuY2VFbmdpbmUsIFxuICBEb21haW5JbmZlcmVuY2UsIFxuICBEb21haW5Db250ZXh0LFxuICBCdXNpbmVzc0ltcG9ydGFuY2UsXG4gIERvbWFpbkRpY3Rpb25hcnksXG4gIENvbmZpZGVuY2VDb25maWdcbn0gZnJvbSAnLi9JRG9tYWluSW5mZXJlbmNlRW5naW5lJztcbmltcG9ydCB7IFR5cGVJbmZvIH0gZnJvbSAnLi9JVHlwZVNjcmlwdEFuYWx5emVyJztcblxuZXhwb3J0IGNsYXNzIERvbWFpbkluZmVyZW5jZUVuZ2luZSBpbXBsZW1lbnRzIElEb21haW5JbmZlcmVuY2VFbmdpbmUge1xuICAvLyDjg4njg6HjgqTjg7Povp7mm7jvvIjjgrfjg7Pjg5fjg6vjgarjg57jg4Pjg5fjgajjgZfjgablrp/oo4XvvIlcbiAgcHJpdmF0ZSBkb21haW5EaWN0aW9uYXJ5OiBEb21haW5EaWN0aW9uYXJ5ID0ge1xuICAgIHRlcm1zOiBbXSxcbiAgICBydWxlczogW11cbiAgfTtcbiAgXG4gIC8vIOS/oemgvOW6puioreWumlxuICBwcml2YXRlIGNvbmZpZGVuY2VDb25maWc6IENvbmZpZGVuY2VDb25maWcgPSB7XG4gICAgZGVmYXVsdENvbmZpZGVuY2U6IDAuNSxcbiAgICBldmlkZW5jZUJvb3N0RmFjdG9yOiAwLjFcbiAgfTtcblxuICAvLyDntYTjgb/ovrzjgb/jga7jg4njg6HjgqTjg7Pjg5Hjgr/jg7zjg7PvvIjoqK3lrprlj6/og73jgarkv6HpoLzluqbjgpLmjIHjgaTvvIlcbiAgcHJpdmF0ZSBidWlsdEluUGF0dGVybnMgPSBuZXcgTWFwPHN0cmluZywgeyBkb21haW46IHN0cmluZzsgY29uZmlkZW5jZTogbnVtYmVyOyBjb25jZXB0czogc3RyaW5nW107IGltcG9ydGFuY2U6IEJ1c2luZXNzSW1wb3J0YW5jZSB9PihbXG4gICAgWydVc2VyJywgeyBkb21haW46ICd1c2VyLW1hbmFnZW1lbnQnLCBjb25maWRlbmNlOiAwLjcsIGNvbmNlcHRzOiBbJ+ODpuODvOOCtuODvCcsICfoqo3oqLwnLCAn44Ki44Kr44Km44Oz44OI566h55CGJ10sIGltcG9ydGFuY2U6ICdoaWdoJyB9XSxcbiAgICBbJ1BheW1lbnRTZXJ2aWNlJywgeyBkb21haW46ICdwYXltZW50JywgY29uZmlkZW5jZTogMC43NSwgY29uY2VwdHM6IFsn5rG65riIJywgJ+aUr+aJleOBhCcsICfjg4jjg6njg7Pjgrbjgq/jgrfjg6fjg7MnXSwgaW1wb3J0YW5jZTogJ2hpZ2gnIH1dLFxuICAgIFsnT3JkZXInLCB7IGRvbWFpbjogJ29yZGVyLW1hbmFnZW1lbnQnLCBjb25maWRlbmNlOiAwLjY1LCBjb25jZXB0czogWyfms6jmlocnXSwgaW1wb3J0YW5jZTogJ2hpZ2gnIH1dLFxuICAgIFsnQXV0aGVudGljYXRpb25TZXJ2aWNlJywgeyBkb21haW46ICdhdXRoZW50aWNhdGlvbicsIGNvbmZpZGVuY2U6IDAuNzUsIGNvbmNlcHRzOiBbJ+iqjeiovCcsICfjgqLjgq/jgrvjgrnliLblvqEnLCAn44K744Kt44Ol44Oq44OG44KjJ10sIGltcG9ydGFuY2U6ICdoaWdoJyB9XSxcbiAgICBbJ0ludm9pY2UnLCB7IGRvbWFpbjogJ2JpbGxpbmcnLCBjb25maWRlbmNlOiAwLjcsIGNvbmNlcHRzOiBbJ+iri+axgicsICfoqrLph5EnXSwgaW1wb3J0YW5jZTogJ2hpZ2gnIH1dLFxuICAgIFsnSW52b2ljZVByb2Nlc3NvcicsIHsgZG9tYWluOiAnYmlsbGluZycsIGNvbmZpZGVuY2U6IDAuNywgY29uY2VwdHM6IFsn6KuL5rGCJywgJ+iqsumHkScsICfkvJroqIgnLCAn56iO5YuZJ10sIGltcG9ydGFuY2U6ICdoaWdoJyB9XVxuICBdKTtcblxuICAvLyDjg4njg6HjgqTjg7Pph43opoHluqbjg57jg4Pjg5fvvIjmjqfjgYjjgoHjgarjg4fjg5Xjgqnjg6vjg4jlgKTvvIlcbiAgcHJpdmF0ZSByZWFkb25seSBkb21haW5JbXBvcnRhbmNlTWFwID0gbmV3IE1hcDxzdHJpbmcsIEJ1c2luZXNzSW1wb3J0YW5jZT4oW1xuICAgIFsncGF5bWVudCcsICdoaWdoJ10sXG4gICAgWydhdXRoZW50aWNhdGlvbicsICdoaWdoJ10sXG4gICAgWydiaWxsaW5nJywgJ2hpZ2gnXSxcbiAgICBbJ3VzZXItbWFuYWdlbWVudCcsICdoaWdoJ10sXG4gICAgWydvcmRlci1tYW5hZ2VtZW50JywgJ2hpZ2gnXSxcbiAgICBbJ2xvZ2dpbmcnLCAnbWVkaXVtJ10sXG4gICAgWyd1dGlsaXR5JywgJ2xvdyddLFxuICAgIFsnZ2VuZXJhbCcsICdsb3cnXVxuICBdKTtcblxuICBhc3luYyBpbmZlckRvbWFpbkZyb21UeXBlKHR5cGVJbmZvOiBUeXBlSW5mbyk6IFByb21pc2U8RG9tYWluSW5mZXJlbmNlPiB7XG4gICAgLy8g44OX44Oq44Of44OG44Kj44OW5Z6L44Gu5aC05ZCIXG4gICAgaWYgKHR5cGVJbmZvLmlzUHJpbWl0aXZlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb21haW46ICdnZW5lcmFsJyxcbiAgICAgICAgY29uZmlkZW5jZTogMC4xLFxuICAgICAgICBjb25jZXB0czogW10sXG4gICAgICAgIGJ1c2luZXNzSW1wb3J0YW5jZTogJ2xvdydcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8g44K444Kn44ON44Oq44OD44Kv5Z6L44Gu5aC05ZCI44CB5Z6L5byV5pWw44KC6ICD5oWuXG4gICAgaWYgKHR5cGVJbmZvLnR5cGVBcmd1bWVudHMgJiYgdHlwZUluZm8udHlwZUFyZ3VtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBiYXNlVHlwZSA9IHRoaXMuYnVpbHRJblBhdHRlcm5zLmdldCh0eXBlSW5mby50eXBlTmFtZSk7XG4gICAgICBjb25zdCBhcmdUeXBlID0gdHlwZUluZm8udHlwZUFyZ3VtZW50c1swXTtcbiAgICAgIGNvbnN0IGFyZ1BhdHRlcm4gPSB0aGlzLmJ1aWx0SW5QYXR0ZXJucy5nZXQoYXJnVHlwZS50eXBlTmFtZSk7XG5cbiAgICAgIGlmICh0eXBlSW5mby50eXBlTmFtZSA9PT0gJ1JlcG9zaXRvcnknICYmIGFyZ1BhdHRlcm4pIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkb21haW46IGFyZ1BhdHRlcm4uZG9tYWluLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IE1hdGgubWluKDAuOCwgYXJnUGF0dGVybi5jb25maWRlbmNlICsgMC4xKSwgIC8vIOikh+WQiOiovOaLoOOBq+OCiOOCi+OCj+OBmuOBi+OBquWil+WKoFxuICAgICAgICAgIGNvbmNlcHRzOiBbLi4uYXJnUGF0dGVybi5jb25jZXB0cywgJ+ODquODneOCuOODiOODqicsICfjg4fjg7zjgr/jgqLjgq/jgrvjgrknXSxcbiAgICAgICAgICBidXNpbmVzc0ltcG9ydGFuY2U6IGFyZ1BhdHRlcm4uaW1wb3J0YW5jZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIOe1hOOBv+i+vOOBv+ODkeOCv+ODvOODs+OBi+OCieaknOe0olxuICAgIGNvbnN0IHBhdHRlcm4gPSB0aGlzLmJ1aWx0SW5QYXR0ZXJucy5nZXQodHlwZUluZm8udHlwZU5hbWUpO1xuICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkb21haW46IHBhdHRlcm4uZG9tYWluLFxuICAgICAgICBjb25maWRlbmNlOiB0aGlzLmdldENvbmZpZGVuY2UodHlwZUluZm8udHlwZU5hbWUsIHBhdHRlcm4uY29uZmlkZW5jZSksXG4gICAgICAgIGNvbmNlcHRzOiBwYXR0ZXJuLmNvbmNlcHRzLFxuICAgICAgICBidXNpbmVzc0ltcG9ydGFuY2U6IHBhdHRlcm4uaW1wb3J0YW5jZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyDovp7mm7jjgYvjgonmpJzntKLvvIhZQUdOSTog5LuK44Gv5Z+65pys55qE44Gq5a6f6KOF44Gu44G/77yJXG4gICAgY29uc3QgZGljdEVudHJ5ID0gdGhpcy5kb21haW5EaWN0aW9uYXJ5LnRlcm1zLmZpbmQodCA9PiB0LnRlcm0gPT09IHR5cGVJbmZvLnR5cGVOYW1lKTtcbiAgICBpZiAoZGljdEVudHJ5KSB7XG4gICAgICBjb25zdCBpbXBvcnRhbmNlID0gYXdhaXQgdGhpcy5nZXREb21haW5JbXBvcnRhbmNlKGRpY3RFbnRyeS5kb21haW4pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZG9tYWluOiBkaWN0RW50cnkuZG9tYWluLFxuICAgICAgICBjb25maWRlbmNlOiBkaWN0RW50cnkud2VpZ2h0LFxuICAgICAgICBjb25jZXB0czogdGhpcy5pbmZlckNvbmNlcHRzRnJvbURvbWFpbihkaWN0RW50cnkuZG9tYWluKSxcbiAgICAgICAgYnVzaW5lc3NJbXBvcnRhbmNlOiBpbXBvcnRhbmNlXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIOODq+ODvOODq+ODmeODvOOCueOBruODnuODg+ODgeODs+OCsFxuICAgIGxldCBiZXN0TWF0Y2g6IERvbWFpbkluZmVyZW5jZSB8IG51bGwgPSBudWxsO1xuICAgIGxldCBtYXhDb25maWRlbmNlID0gMDtcbiAgICBcbiAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgdGhpcy5kb21haW5EaWN0aW9uYXJ5LnJ1bGVzKSB7XG4gICAgICBpZiAocnVsZS5wYXR0ZXJuLnRlc3QodHlwZUluZm8udHlwZU5hbWUpKSB7XG4gICAgICAgIGNvbnN0IGltcG9ydGFuY2UgPSBhd2FpdCB0aGlzLmdldERvbWFpbkltcG9ydGFuY2UocnVsZS5kb21haW4pO1xuICAgICAgICBjb25zdCBjb25jZXB0cyA9IHRoaXMuaW5mZXJDb25jZXB0c0Zyb21Eb21haW4ocnVsZS5kb21haW4pO1xuICAgICAgICBcbiAgICAgICAgLy8gU2VydmljZeezu+OBruWgtOWQiOOBr+i/veWKoOOBruamguW/teOCkuS7mOS4jlxuICAgICAgICBpZiAodHlwZUluZm8udHlwZU5hbWUuZW5kc1dpdGgoJ1NlcnZpY2UnKSkge1xuICAgICAgICAgIGNvbmNlcHRzLnB1c2goJ+OCteODvOODk+OCueWxpCcpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDopIflkIjnmoTjgarlkI3liY3jga7loLTlkIjvvIjkvovvvJpVc2VyU2VydmljZe+8ieOAgeikh+aVsOOBruODkeOCv+ODvOODs+OCkuiAg+aFrlxuICAgICAgICBsZXQgY29tYmluZWRDb25maWRlbmNlID0gcnVsZS53ZWlnaHQ7XG4gICAgICAgIGNvbnN0IGJhc2VDb25jZXB0czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIOikh+WQiOWQjeOBruWQhOmDqOWIhuOCkuODgeOCp+ODg+OCr1xuICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBwYXR0ZXJuXSBvZiB0aGlzLmJ1aWx0SW5QYXR0ZXJucykge1xuICAgICAgICAgIGlmICh0eXBlSW5mby50eXBlTmFtZS5pbmNsdWRlcyhuYW1lKSAmJiBuYW1lICE9PSB0eXBlSW5mby50eXBlTmFtZSkge1xuICAgICAgICAgICAgY29tYmluZWRDb25maWRlbmNlID0gTWF0aC5taW4oMS4wLCBjb21iaW5lZENvbmZpZGVuY2UgKyBwYXR0ZXJuLmNvbmZpZGVuY2UgKiAwLjMpO1xuICAgICAgICAgICAgYmFzZUNvbmNlcHRzLnB1c2goLi4ucGF0dGVybi5jb25jZXB0cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyDovp7mm7jjga7nlKjoqp7jgoLogIPmha5cbiAgICAgICAgZm9yIChjb25zdCB0ZXJtIG9mIHRoaXMuZG9tYWluRGljdGlvbmFyeS50ZXJtcykge1xuICAgICAgICAgIGlmICh0eXBlSW5mby50eXBlTmFtZS5pbmNsdWRlcyh0ZXJtLnRlcm0pICYmIHRlcm0udGVybSAhPT0gdHlwZUluZm8udHlwZU5hbWUpIHtcbiAgICAgICAgICAgIGNvbWJpbmVkQ29uZmlkZW5jZSA9IE1hdGgubWluKDEuMCwgY29tYmluZWRDb25maWRlbmNlICsgdGVybS53ZWlnaHQgKiAwLjMpO1xuICAgICAgICAgICAgYmFzZUNvbmNlcHRzLnB1c2goLi4udGhpcy5pbmZlckNvbmNlcHRzRnJvbURvbWFpbih0ZXJtLmRvbWFpbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8g44Om44OL44O844Kv44Gq5qaC5b+144Gu44G/44KS5L+d5oyBXG4gICAgICAgIGNvbnN0IHVuaXF1ZUNvbmNlcHRzID0gWy4uLm5ldyBTZXQoWy4uLmJhc2VDb25jZXB0cywgLi4uY29uY2VwdHNdKV07XG4gICAgICAgIFxuICAgICAgICBpZiAoY29tYmluZWRDb25maWRlbmNlID4gbWF4Q29uZmlkZW5jZSkge1xuICAgICAgICAgIG1heENvbmZpZGVuY2UgPSBjb21iaW5lZENvbmZpZGVuY2U7XG4gICAgICAgICAgYmVzdE1hdGNoID0ge1xuICAgICAgICAgICAgZG9tYWluOiBydWxlLmRvbWFpbixcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IGNvbWJpbmVkQ29uZmlkZW5jZSxcbiAgICAgICAgICAgIGNvbmNlcHRzOiB1bmlxdWVDb25jZXB0cyxcbiAgICAgICAgICAgIGJ1c2luZXNzSW1wb3J0YW5jZTogaW1wb3J0YW5jZVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKGJlc3RNYXRjaCkge1xuICAgICAgcmV0dXJuIGJlc3RNYXRjaDtcbiAgICB9XG5cbiAgICAvLyDjg4fjg5Xjgqnjg6vjg4hcbiAgICByZXR1cm4ge1xuICAgICAgZG9tYWluOiAndW5rbm93bicsXG4gICAgICBjb25maWRlbmNlOiAwLjMsXG4gICAgICBjb25jZXB0czogW10sXG4gICAgICBidXNpbmVzc0ltcG9ydGFuY2U6ICdsb3cnXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGluZmVyRG9tYWluRnJvbUNvbnRleHQoY29udGV4dDogRG9tYWluQ29udGV4dCk6IFByb21pc2U8RG9tYWluSW5mZXJlbmNlPiB7XG4gICAgLy8g44OV44Kh44Kk44Or44OR44K544GL44KJ44OJ44Oh44Kk44Oz44KS5o6o6KuWXG4gICAgY29uc3QgcGF0aFBhcnRzID0gY29udGV4dC5maWxlUGF0aC5zcGxpdCgnLycpO1xuICAgIGxldCBpbmZlcnJlZERvbWFpbiA9ICcnO1xuICAgIGxldCBjb25maWRlbmNlID0gMDtcbiAgICBjb25zdCBjb25jZXB0czogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIOODkeOCueODmeODvOOCueOBruaOqOirlu+8iOioreWumuWPr+iDveOBquS/oemgvOW6puOCkuS9v+eUqO+8iVxuICAgIGlmIChwYXRoUGFydHMuaW5jbHVkZXMoJ2F1dGgnKSB8fCBwYXRoUGFydHMuaW5jbHVkZXMoJ2F1dGhlbnRpY2F0aW9uJykpIHtcbiAgICAgIGluZmVycmVkRG9tYWluID0gJ2F1dGhlbnRpY2F0aW9uJztcbiAgICAgIGNvbmZpZGVuY2UgPSB0aGlzLmNvbmZpZGVuY2VDb25maWcuZG9tYWluQ29uZmlkZW5jZU1hcD8uWydhdXRoZW50aWNhdGlvbiddIHx8IDAuOTtcbiAgICAgIGNvbmNlcHRzLnB1c2goJ+iqjeiovCcsICfjgqLjgq/jgrvjgrnliLblvqEnLCAn44K744Kt44Ol44Oq44OG44KjJyk7XG4gICAgfSBlbHNlIGlmIChwYXRoUGFydHMuaW5jbHVkZXMoJ2JpbGxpbmcnKSkge1xuICAgICAgaW5mZXJyZWREb21haW4gPSAnYmlsbGluZyc7XG4gICAgICBjb25maWRlbmNlID0gdGhpcy5jb25maWRlbmNlQ29uZmlnLmRvbWFpbkNvbmZpZGVuY2VNYXA/LlsnYmlsbGluZyddIHx8IDAuODg7XG4gICAgICBjb25jZXB0cy5wdXNoKCfoq4vmsYInLCAn6Kqy6YeRJyk7XG4gICAgfSBlbHNlIGlmIChwYXRoUGFydHMuaW5jbHVkZXMoJ3BheW1lbnQnKSkge1xuICAgICAgaW5mZXJyZWREb21haW4gPSAncGF5bWVudCc7XG4gICAgICBjb25maWRlbmNlID0gdGhpcy5jb25maWRlbmNlQ29uZmlnLmRvbWFpbkNvbmZpZGVuY2VNYXA/LlsncGF5bWVudCddIHx8IDAuOTtcbiAgICAgIGNvbmNlcHRzLnB1c2goJ+axuua4iCcsICfmlK/miZXjgYQnKTtcbiAgICB9XG5cbiAgICAvLyDjgq/jg6njgrnlkI3jgYvjgonjga7mjqjoq5ZcbiAgICBpZiAoY29udGV4dC5jbGFzc05hbWUpIHtcbiAgICAgIGNvbnN0IGNsYXNzUGF0dGVybiA9IHRoaXMuYnVpbHRJblBhdHRlcm5zLmdldChjb250ZXh0LmNsYXNzTmFtZSk7XG4gICAgICBpZiAoY2xhc3NQYXR0ZXJuKSB7XG4gICAgICAgIGluZmVycmVkRG9tYWluID0gY2xhc3NQYXR0ZXJuLmRvbWFpbjtcbiAgICAgICAgY29uZmlkZW5jZSA9IE1hdGgubWF4KGNvbmZpZGVuY2UsIGNsYXNzUGF0dGVybi5jb25maWRlbmNlKTtcbiAgICAgICAgY2xhc3NQYXR0ZXJuLmNvbmNlcHRzLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgaWYgKCFjb25jZXB0cy5pbmNsdWRlcyhjKSkgY29uY2VwdHMucHVzaChjKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g44Kk44Oz44Od44O844OI44GL44KJ44Gu5o6o6KuWXG4gICAgY29uc3QgaW1wb3J0RG9tYWlucyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIGNvbnN0IHVuaXF1ZVJlbGF0ZWREb21haW5zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgXG4gICAgZm9yIChjb25zdCBpbXAgb2YgY29udGV4dC5pbXBvcnRzKSB7XG4gICAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy5idWlsdEluUGF0dGVybnMuZ2V0KGltcCk7XG4gICAgICBpZiAocGF0dGVybikge1xuICAgICAgICBpbXBvcnREb21haW5zLmFkZChwYXR0ZXJuLmRvbWFpbik7XG4gICAgICAgIC8vIGluZmVyRG9tYWluRnJvbUNvbnRleHTjgafmpoLlv7XjgpLov73liqDjgZnjgovpmpvjgIHjgq/jg6njgrnlkI3nlLHmnaXjga7mpoLlv7Xjgajph43opIfjgZfjgarjgYTjgojjgYbjgavjgZnjgotcbiAgICAgICAgaWYgKGNvbnRleHQuY2xhc3NOYW1lICE9PSBpbXApIHtcbiAgICAgICAgICBwYXR0ZXJuLmNvbmNlcHRzLmZvckVhY2goYyA9PiB7XG4gICAgICAgICAgICBpZiAoIWNvbmNlcHRzLmluY2x1ZGVzKGMpKSBjb25jZXB0cy5wdXNoKGMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIOeJueWumuOBruOCpOODs+ODneODvOODiOODkeOCv+ODvOODs1xuICAgICAgaWYgKGltcCA9PT0gJ1RheENhbGN1bGF0b3InKSB7XG4gICAgICAgIGlmICghY29uY2VwdHMuaW5jbHVkZXMoJ+eojuWLmScpKSBjb25jZXB0cy5wdXNoKCfnqI7li5knKTtcbiAgICAgICAgaWYgKGluZmVycmVkRG9tYWluID09PSAnYmlsbGluZycgJiYgIWNvbmNlcHRzLmluY2x1ZGVzKCfkvJroqIgnKSkge1xuICAgICAgICAgIGNvbmNlcHRzLnB1c2goJ+S8muioiCcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoaW1wID09PSAnVG9rZW4nIHx8IGltcCA9PT0gJ1Blcm1pc3Npb24nKSB7XG4gICAgICAgIHVuaXF1ZVJlbGF0ZWREb21haW5zLmFkZCgnc2VjdXJpdHknKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbXAgPT09ICdDdXN0b21lcicpIHtcbiAgICAgICAgdW5pcXVlUmVsYXRlZERvbWFpbnMuYWRkKCdhY2NvdW50aW5nJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g6Zai6YCj44OJ44Oh44Kk44Oz44Gu6Kit5a6aXG4gICAgaWYgKGluZmVycmVkRG9tYWluID09PSAnYXV0aGVudGljYXRpb24nKSB7XG4gICAgICB1bmlxdWVSZWxhdGVkRG9tYWlucy5hZGQoJ3VzZXItbWFuYWdlbWVudCcpO1xuICAgIH0gZWxzZSBpZiAoaW5mZXJyZWREb21haW4gPT09ICdiaWxsaW5nJykge1xuICAgICAgLy8gUGF5bWVudOOCpOODs+ODneODvOODiOOBjOOBguOCi+OBi+ODgeOCp+ODg+OCr1xuICAgICAgZm9yIChjb25zdCBpbXAgb2YgY29udGV4dC5pbXBvcnRzKSB7XG4gICAgICAgIGlmIChpbXAgPT09ICdQYXltZW50Jykge1xuICAgICAgICAgIHVuaXF1ZVJlbGF0ZWREb21haW5zLmFkZCgncGF5bWVudCcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gdW5pcXVlUmVsYXRlZERvbWFpbnPjgYvjgolyZWxhdGVkRG9tYWluc+mFjeWIl+OCkueUn+aIkO+8iOmghuW6j+S7mOOBje+8iVxuICAgIGNvbnN0IG9yZGVyZWRSZWxhdGVkRG9tYWlucyA9IEFycmF5LmZyb20odW5pcXVlUmVsYXRlZERvbWFpbnMpLnNvcnQoKTtcblxuICAgIGNvbnN0IGltcG9ydGFuY2UgPSBhd2FpdCB0aGlzLmdldERvbWFpbkltcG9ydGFuY2UoaW5mZXJyZWREb21haW4pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRvbWFpbjogaW5mZXJyZWREb21haW4sXG4gICAgICBjb25maWRlbmNlLFxuICAgICAgY29uY2VwdHMsXG4gICAgICBidXNpbmVzc0ltcG9ydGFuY2U6IGltcG9ydGFuY2UsXG4gICAgICByZWxhdGVkRG9tYWluczogb3JkZXJlZFJlbGF0ZWREb21haW5zLmxlbmd0aCA+IDAgPyBvcmRlcmVkUmVsYXRlZERvbWFpbnMgOiB1bmRlZmluZWRcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZ2V0RG9tYWluSW1wb3J0YW5jZShkb21haW46IHN0cmluZyk6IFByb21pc2U8QnVzaW5lc3NJbXBvcnRhbmNlPiB7XG4gICAgcmV0dXJuIHRoaXMuZG9tYWluSW1wb3J0YW5jZU1hcC5nZXQoZG9tYWluKSB8fCAnbWVkaXVtJztcbiAgfVxuXG4gIGFzeW5jIGxvYWREaWN0aW9uYXJ5KGRpY3Rpb25hcnk6IERvbWFpbkRpY3Rpb25hcnkpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyDovp7mm7jjgpLjg57jg7zjgrjvvIhEUlnljp/liYc6IOaXouWtmOOBrui+nuabuOOBq+i/veWKoO+8iVxuICAgIHRoaXMuZG9tYWluRGljdGlvbmFyeS50ZXJtcy5wdXNoKC4uLmRpY3Rpb25hcnkudGVybXMpO1xuICAgIHRoaXMuZG9tYWluRGljdGlvbmFyeS5ydWxlcy5wdXNoKC4uLmRpY3Rpb25hcnkucnVsZXMpO1xuICB9XG5cbiAgbWVyZ2VJbmZlcmVuY2VzKGluZmVyZW5jZXM6IERvbWFpbkluZmVyZW5jZVtdKTogRG9tYWluSW5mZXJlbmNlIHtcbiAgICBpZiAoaW5mZXJlbmNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRvbWFpbjogJ3Vua25vd24nLFxuICAgICAgICBjb25maWRlbmNlOiAwLFxuICAgICAgICBjb25jZXB0czogW10sXG4gICAgICAgIGJ1c2luZXNzSW1wb3J0YW5jZTogJ2xvdydcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8g5pyA44KC5L+h6aC85bqm44Gu6auY44GE5o6o6KuW44KS6YG45oqe77yIS0lTU+WOn+WJh++8iVxuICAgIGNvbnN0IGJlc3QgPSBpbmZlcmVuY2VzLnJlZHVjZSgocHJldiwgY3VycikgPT4gXG4gICAgICBjdXJyLmNvbmZpZGVuY2UgPiBwcmV2LmNvbmZpZGVuY2UgPyBjdXJyIDogcHJldlxuICAgICk7XG5cbiAgICAvLyDlhajjgabjga7mpoLlv7XjgpLntbHlkIhcbiAgICBjb25zdCBhbGxDb25jZXB0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIGluZmVyZW5jZXMuZm9yRWFjaChpbmYgPT4gaW5mLmNvbmNlcHRzLmZvckVhY2goYyA9PiBhbGxDb25jZXB0cy5hZGQoYykpKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5iZXN0LFxuICAgICAgY29uY2VwdHM6IEFycmF5LmZyb20oYWxsQ29uY2VwdHMpXG4gICAgfTtcbiAgfVxuXG4gIC8vIOODl+ODqeOCpOODmeODvOODiOODmOODq+ODkeODvOODoeOCveODg+ODiVxuICBwcml2YXRlIGluZmVyQ29uY2VwdHNGcm9tRG9tYWluKGRvbWFpbjogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNvbmNlcHRNYXA6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAgICd1c2VyLW1hbmFnZW1lbnQnOiBbJ+ODpuODvOOCtuODvCddLFxuICAgICAgJ3NlcnZpY2UtbGF5ZXInOiBbXSxcbiAgICAgICdkYXRhLWFjY2Vzcyc6IFsn44OH44O844K/44Ki44Kv44K744K5J11cbiAgICB9O1xuXG4gICAgcmV0dXJuIGNvbmNlcHRNYXBbZG9tYWluXSB8fCBbXTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIOS/oemgvOW6puioreWumuOCkumBqeeUqFxuICAgKi9cbiAgc2V0Q29uZmlkZW5jZUNvbmZpZyhjb25maWc6IENvbmZpZGVuY2VDb25maWcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpZGVuY2VDb25maWcgPSB7IC4uLnRoaXMuY29uZmlkZW5jZUNvbmZpZywgLi4uY29uZmlnIH07XG4gICAgXG4gICAgLy8gdHlwZUNvbmZpZGVuY2VNYXDjgYzoqK3lrprjgZXjgozjgabjgYTjgovloLTlkIjjgIFidWlsdEluUGF0dGVybnPjgpLmm7TmlrBcbiAgICBpZiAoY29uZmlnLnR5cGVDb25maWRlbmNlTWFwKSB7XG4gICAgICBmb3IgKGNvbnN0IFt0eXBlTmFtZSwgY29uZmlkZW5jZV0gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnLnR5cGVDb25maWRlbmNlTWFwKSkge1xuICAgICAgICBjb25zdCBwYXR0ZXJuID0gdGhpcy5idWlsdEluUGF0dGVybnMuZ2V0KHR5cGVOYW1lKTtcbiAgICAgICAgaWYgKHBhdHRlcm4pIHtcbiAgICAgICAgICBwYXR0ZXJuLmNvbmZpZGVuY2UgPSBjb25maWRlbmNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICog6Kit5a6a44GV44KM44Gf5L+h6aC85bqm44KS5Y+W5b6X77yI6Kit5a6a44GM44Gq44GE5aC05ZCI44Gv44OH44OV44Kp44Or44OI5YCk44KS6L+U44GZ77yJXG4gICAqL1xuICBwcml2YXRlIGdldENvbmZpZGVuY2UodHlwZU5hbWU6IHN0cmluZywgZGVmYXVsdFZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIOioreWumuOBleOCjOOBn+S/oemgvOW6puODnuODg+ODl+OBi+OCieWPluW+l1xuICAgIGlmICh0aGlzLmNvbmZpZGVuY2VDb25maWcudHlwZUNvbmZpZGVuY2VNYXA/Llt0eXBlTmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29uZmlkZW5jZUNvbmZpZy50eXBlQ29uZmlkZW5jZU1hcFt0eXBlTmFtZV07XG4gICAgfVxuICAgIFxuICAgIC8vIGJ1aWx0SW5QYXR0ZXJuc+OBi+OCieWPluW+l1xuICAgIGNvbnN0IHBhdHRlcm4gPSB0aGlzLmJ1aWx0SW5QYXR0ZXJucy5nZXQodHlwZU5hbWUpO1xuICAgIGlmIChwYXR0ZXJuKSB7XG4gICAgICByZXR1cm4gcGF0dGVybi5jb25maWRlbmNlO1xuICAgIH1cbiAgICBcbiAgICAvLyDjg4fjg5Xjgqnjg6vjg4jlgKTjgpLov5TjgZlcbiAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICB9XG59Il0sInZlcnNpb24iOjN9