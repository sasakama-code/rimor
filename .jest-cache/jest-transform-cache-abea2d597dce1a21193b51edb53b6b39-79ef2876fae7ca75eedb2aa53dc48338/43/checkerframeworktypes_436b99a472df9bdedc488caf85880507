4ccb37611c07da248f93442584975648
"use strict";
/**
 * Checker Framework互換の型定義
 * arXiv:2504.18529v2 "Practical Type-Based Taint Checking and Inference" の実装
 *
 * このファイルは論文で提案されている型システムをTypeScriptで実装します。
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeQualifierError = exports.PolyTaintInstantiation = exports.TypeCompatibility = exports.FlowSensitiveChecker = exports.TypePropagation = exports.TypePromotion = exports.SubtypingChecker = exports.TypeConstructors = exports.TypeGuards = void 0;
exports.isTainted = isTainted;
exports.isUntainted = isUntainted;
exports.sanitize = sanitize;
exports.taint = taint;
/**
 * 型クオリファイアのガード関数
 */
exports.TypeGuards = {
    isTainted(value) {
        return value !== null && typeof value === 'object' &&
            '__brand' in value && value.__brand === '@Tainted';
    },
    isUntainted(value) {
        return value !== null && typeof value === 'object' &&
            '__brand' in value && value.__brand === '@Untainted';
    },
    isPolyTaint(value) {
        return value !== null && typeof value === 'object' &&
            '__brand' in value && value.__brand === '@PolyTaint';
    }
};
/**
 * 型コンストラクタ
 * 論文のSection 3で説明されている型構築
 */
exports.TypeConstructors = {
    /**
     * 汚染された値を作成
     */
    tainted(value, source, confidence = 1.0) {
        return {
            __brand: '@Tainted',
            __value: value,
            __source: source,
            __confidence: confidence
        };
    },
    /**
     * 清浄な値を作成
     */
    untainted(value, sanitizedBy) {
        return {
            __brand: '@Untainted',
            __value: value,
            __sanitizedBy: sanitizedBy,
            __validatedAt: Date.now()
        };
    },
    /**
     * ポリモーフィック汚染値を作成
     */
    polyTaint(value, parameterIndices = [], propagationRule = 'any') {
        return {
            __brand: '@PolyTaint',
            __value: value,
            __parameterIndices: parameterIndices,
            __propagationRule: propagationRule
        };
    }
};
/**
 * サブタイピング関係のチェック
 * 論文のSection 2.2で定義されている規則
 */
class SubtypingChecker {
    /**
     * aがbのサブタイプかどうかをチェック
     * @Untainted <: @Tainted (untaintedはtaintedのサブタイプ)
     */
    static isSubtype(a, b) {
        if (a === b)
            return true;
        if (a === '@Untainted' && b === '@Tainted')
            return true;
        if (a === '@PolyTaint')
            return true; // PolyTaintは文脈依存
        return false;
    }
    /**
     * 代入の安全性をチェック
     * 右辺が左辺のサブタイプである必要がある
     */
    static isAssignmentSafe(lhs, rhs) {
        // @Untainted を @Tainted に代入するのは安全
        if (exports.TypeGuards.isUntainted(rhs) && exports.TypeGuards.isTainted(lhs)) {
            return true;
        }
        // @Tainted を @Untainted に代入するのは危険
        if (exports.TypeGuards.isTainted(rhs) && exports.TypeGuards.isUntainted(lhs)) {
            return false;
        }
        // 同じ型クオリファイア同士は安全
        if (lhs.__brand === rhs.__brand) {
            return true;
        }
        // PolyTaintは文脈依存
        if (exports.TypeGuards.isPolyTaint(lhs) || exports.TypeGuards.isPolyTaint(rhs)) {
            return true; // 実行時に判定
        }
        return false;
    }
}
exports.SubtypingChecker = SubtypingChecker;
/**
 * 型の昇格・降格
 * 論文のSection 3.2で説明されている操作
 */
class TypePromotion {
    /**
     * サニタイザーによる型の昇格
     * @Tainted -> @Untainted
     */
    static sanitize(tainted, sanitizerName) {
        return exports.TypeConstructors.untainted(tainted.__value, sanitizerName);
    }
    /**
     * 汚染源による型の降格
     * @Untainted -> @Tainted
     */
    static taint(untainted, source) {
        return exports.TypeConstructors.tainted(untainted.__value, source, 1.0);
    }
    /**
     * 条件付き昇格（検証による）
     */
    static conditionalPromote(value, condition, sanitizerName) {
        if (exports.TypeGuards.isTainted(value) && condition(value.__value)) {
            return exports.TypeConstructors.untainted(value.__value, sanitizerName);
        }
        return value;
    }
}
exports.TypePromotion = TypePromotion;
/**
 * 型の伝播規則
 * 論文のSection 3.3で定義されている規則
 */
class TypePropagation {
    /**
     * 二項演算の結果の型を決定
     * より制限的な型（@Tainted）が優先される
     */
    static binaryOperation(lhs, rhs, operation) {
        const result = operation(lhs.__value, rhs.__value);
        // どちらかが@Taintedなら結果も@Tainted
        if (exports.TypeGuards.isTainted(lhs) || exports.TypeGuards.isTainted(rhs)) {
            const source = exports.TypeGuards.isTainted(lhs) ? lhs.__source :
                exports.TypeGuards.isTainted(rhs) ? rhs.__source : 'unknown';
            return exports.TypeConstructors.tainted(result, source);
        }
        // 両方が@Untaintedなら結果も@Untainted
        if (exports.TypeGuards.isUntainted(lhs) && exports.TypeGuards.isUntainted(rhs)) {
            return exports.TypeConstructors.untainted(result);
        }
        // PolyTaintが含まれる場合は文脈依存
        return exports.TypeConstructors.polyTaint(result);
    }
    /**
     * メソッド呼び出しの結果の型を決定
     */
    static methodCall(receiver, methodName, args, method) {
        const argValues = args.map(arg => arg.__value);
        const result = method.apply(receiver.__value, argValues);
        // レシーバーまたは引数のいずれかが汚染されていれば結果も汚染
        const taintedInputs = [receiver, ...args].filter(exports.TypeGuards.isTainted);
        if (taintedInputs.length > 0) {
            return exports.TypeConstructors.tainted(result, taintedInputs[0].__source);
        }
        return exports.TypeConstructors.untainted(result);
    }
}
exports.TypePropagation = TypePropagation;
/**
 * フロー感度の型チェック
 * 論文のSection 4で説明されている手法
 */
class FlowSensitiveChecker {
    typeEnvironment;
    constructor() {
        this.typeEnvironment = new Map();
    }
    /**
     * 変数の型を更新
     */
    updateType(varName, type) {
        this.typeEnvironment.set(varName, type);
    }
    /**
     * 変数の現在の型を取得
     */
    getType(varName) {
        return this.typeEnvironment.get(varName);
    }
    /**
     * 条件分岐での型の精緻化
     */
    refineType(varName, condition, trueType, falseType) {
        const currentType = this.typeEnvironment.get(varName);
        if (!currentType)
            return;
        if (condition(currentType.__value)) {
            // 条件が真の場合の型
            if (trueType === '@Untainted') {
                this.typeEnvironment.set(varName, exports.TypeConstructors.untainted(currentType.__value, 'flow-refinement'));
            }
        }
        else {
            // 条件が偽の場合の型
            if (falseType === '@Tainted' && !exports.TypeGuards.isTainted(currentType)) {
                this.typeEnvironment.set(varName, exports.TypeConstructors.tainted(currentType.__value, 'flow-refinement'));
            }
        }
    }
}
exports.FlowSensitiveChecker = FlowSensitiveChecker;
/**
 * 簡便なヘルパー関数
 */
function isTainted(value) {
    return exports.TypeGuards.isTainted(value);
}
function isUntainted(value) {
    return exports.TypeGuards.isUntainted(value);
}
function sanitize(value, sanitizer) {
    return exports.TypeConstructors.untainted(sanitizer(value.__value), 'sanitized');
}
function taint(value, source) {
    return exports.TypeConstructors.tainted(value, source, 1.0);
}
/**
 * 型の互換性チェック
 * 論文のSection 5で定義されている規則
 */
class TypeCompatibility {
    /**
     * メソッドオーバーライドの安全性をチェック
     * 共変・反変の規則を適用
     */
    static isOverrideSafe(baseMethod, overrideMethod) {
        // パラメータは反変（より一般的な型を受け入れる）
        // オーバーライドメソッドは、ベースメソッドより一般的なパラメータを受け入れる必要がある
        // つまり、base param <: override param でなければならない
        for (let i = 0; i < baseMethod.params.length; i++) {
            if (!SubtypingChecker.isSubtype(baseMethod.params[i], overrideMethod.params[i])) {
                return false;
            }
        }
        // 戻り値は共変（より具体的な型を返す）
        // オーバーライドメソッドは、ベースメソッドより具体的な型を返す必要がある
        // つまり、override return <: base return でなければならない
        return SubtypingChecker.isSubtype(overrideMethod.return, baseMethod.return);
    }
}
exports.TypeCompatibility = TypeCompatibility;
/**
 * ポリモーフィック型のインスタンス化
 */
class PolyTaintInstantiation {
    /**
     * PolyTaint型を具体的な型にインスタンス化
     */
    static instantiate(polyType, argumentTypes) {
        const relevantArgs = polyType.__parameterIndices.map(i => argumentTypes[i]);
        if (polyType.__propagationRule === 'any') {
            // いずれかが@Taintedなら結果も@Tainted
            if (relevantArgs.some(arg => arg === '@Tainted')) {
                return exports.TypeConstructors.tainted(polyType.__value, 'poly-instantiation');
            }
        }
        else {
            // すべてが@Taintedなら結果も@Tainted
            if (relevantArgs.every(arg => arg === '@Tainted')) {
                return exports.TypeConstructors.tainted(polyType.__value, 'poly-instantiation');
            }
        }
        return exports.TypeConstructors.untainted(polyType.__value, 'poly-instantiation');
    }
}
exports.PolyTaintInstantiation = PolyTaintInstantiation;
/**
 * 型エラー
 */
class TypeQualifierError extends Error {
    expected;
    actual;
    location;
    constructor(message, expected, actual, location) {
        super(message);
        this.expected = expected;
        this.actual = actual;
        this.location = location;
        this.name = 'TypeQualifierError';
    }
}
exports.TypeQualifierError = TypeQualifierError;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9zZWN1cml0eS90eXBlcy9jaGVja2VyLWZyYW1ld29yay10eXBlcy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQWlWSCw4QkFFQztBQUVELGtDQUVDO0FBRUQsNEJBRUM7QUFFRCxzQkFFQztBQXRSRDs7R0FFRztBQUNVLFFBQUEsVUFBVSxHQUFHO0lBQ3hCLFNBQVMsQ0FBSSxLQUFjO1FBQ3pCLE9BQU8sS0FBSyxLQUFLLElBQUksSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRO1lBQzNDLFNBQVMsSUFBSSxLQUFLLElBQUssS0FBaUMsQ0FBQyxPQUFPLEtBQUssVUFBVSxDQUFDO0lBQ3pGLENBQUM7SUFFRCxXQUFXLENBQUksS0FBYztRQUMzQixPQUFPLEtBQUssS0FBSyxJQUFJLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUTtZQUMzQyxTQUFTLElBQUksS0FBSyxJQUFLLEtBQWlDLENBQUMsT0FBTyxLQUFLLFlBQVksQ0FBQztJQUMzRixDQUFDO0lBRUQsV0FBVyxDQUFJLEtBQWM7UUFDM0IsT0FBTyxLQUFLLEtBQUssSUFBSSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVE7WUFDM0MsU0FBUyxJQUFJLEtBQUssSUFBSyxLQUFpQyxDQUFDLE9BQU8sS0FBSyxZQUFZLENBQUM7SUFDM0YsQ0FBQztDQUNGLENBQUM7QUFFRjs7O0dBR0c7QUFDVSxRQUFBLGdCQUFnQixHQUFHO0lBQzlCOztPQUVHO0lBQ0gsT0FBTyxDQUFJLEtBQVEsRUFBRSxNQUFjLEVBQUUsYUFBcUIsR0FBRztRQUMzRCxPQUFPO1lBQ0wsT0FBTyxFQUFFLFVBQVU7WUFDbkIsT0FBTyxFQUFFLEtBQUs7WUFDZCxRQUFRLEVBQUUsTUFBTTtZQUNoQixZQUFZLEVBQUUsVUFBVTtTQUN6QixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUyxDQUFJLEtBQVEsRUFBRSxXQUFvQjtRQUN6QyxPQUFPO1lBQ0wsT0FBTyxFQUFFLFlBQVk7WUFDckIsT0FBTyxFQUFFLEtBQUs7WUFDZCxhQUFhLEVBQUUsV0FBVztZQUMxQixhQUFhLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtTQUMxQixDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVHO0lBQ0gsU0FBUyxDQUNQLEtBQVEsRUFDUixtQkFBNkIsRUFBRSxFQUMvQixrQkFBbUMsS0FBSztRQUV4QyxPQUFPO1lBQ0wsT0FBTyxFQUFFLFlBQVk7WUFDckIsT0FBTyxFQUFFLEtBQUs7WUFDZCxrQkFBa0IsRUFBRSxnQkFBZ0I7WUFDcEMsaUJBQWlCLEVBQUUsZUFBZTtTQUNuQyxDQUFDO0lBQ0osQ0FBQztDQUNGLENBQUM7QUFFRjs7O0dBR0c7QUFDSCxNQUFhLGdCQUFnQjtJQUMzQjs7O09BR0c7SUFDSCxNQUFNLENBQUMsU0FBUyxDQUFDLENBQWlCLEVBQUUsQ0FBaUI7UUFDbkQsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLFlBQVksSUFBSSxDQUFDLEtBQUssVUFBVTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ3hELElBQUksQ0FBQyxLQUFLLFlBQVk7WUFBRSxPQUFPLElBQUksQ0FBQyxDQUFDLGlCQUFpQjtRQUN0RCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsZ0JBQWdCLENBQ3JCLEdBQXFCLEVBQ3JCLEdBQXFCO1FBRXJCLGtDQUFrQztRQUNsQyxJQUFJLGtCQUFVLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxJQUFJLGtCQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDN0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsa0NBQWtDO1FBQ2xDLElBQUksa0JBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUM3RCxPQUFPLEtBQUssQ0FBQztRQUNmLENBQUM7UUFFRCxrQkFBa0I7UUFDbEIsSUFBSSxHQUFHLENBQUMsT0FBTyxLQUFLLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNoQyxPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7UUFFRCxpQkFBaUI7UUFDakIsSUFBSSxrQkFBVSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxrQkFBVSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQy9ELE9BQU8sSUFBSSxDQUFDLENBQUMsU0FBUztRQUN4QixDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0NBQ0Y7QUExQ0QsNENBMENDO0FBRUQ7OztHQUdHO0FBQ0gsTUFBYSxhQUFhO0lBQ3hCOzs7T0FHRztJQUNILE1BQU0sQ0FBQyxRQUFRLENBQUksT0FBdUIsRUFBRSxhQUFxQjtRQUMvRCxPQUFPLHdCQUFnQixDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFFRDs7O09BR0c7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFJLFNBQTJCLEVBQUUsTUFBYztRQUN6RCxPQUFPLHdCQUFnQixDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsa0JBQWtCLENBQ3ZCLEtBQXVCLEVBQ3ZCLFNBQTRCLEVBQzVCLGFBQXFCO1FBRXJCLElBQUksa0JBQVUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQzVELE9BQU8sd0JBQWdCLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDbEUsQ0FBQztRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztDQUNGO0FBOUJELHNDQThCQztBQUVEOzs7R0FHRztBQUNILE1BQWEsZUFBZTtJQUMxQjs7O09BR0c7SUFDSCxNQUFNLENBQUMsZUFBZSxDQUNwQixHQUFxQixFQUNyQixHQUFxQixFQUNyQixTQUE0QjtRQUU1QixNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFbkQsNkJBQTZCO1FBQzdCLElBQUksa0JBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksa0JBQVUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUMzRCxNQUFNLE1BQU0sR0FBRyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUMzQyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQ25FLE9BQU8sd0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRCxDQUFDO1FBRUQsK0JBQStCO1FBQy9CLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksa0JBQVUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUMvRCxPQUFPLHdCQUFnQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QyxDQUFDO1FBRUQsd0JBQXdCO1FBQ3hCLE9BQU8sd0JBQWdCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxVQUFVLENBQ2YsUUFBMEIsRUFDMUIsVUFBa0IsRUFDbEIsSUFBOEIsRUFDOUIsTUFBaUM7UUFFakMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMvQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFFekQsZ0NBQWdDO1FBQ2hDLE1BQU0sYUFBYSxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLGtCQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkUsSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzdCLE9BQU8sd0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckUsQ0FBQztRQUVELE9BQU8sd0JBQWdCLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVDLENBQUM7Q0FDRjtBQWhERCwwQ0FnREM7QUFFRDs7O0dBR0c7QUFDSCxNQUFhLG9CQUFvQjtJQUN2QixlQUFlLENBQXNDO0lBRTdEO1FBQ0UsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVUsQ0FBQyxPQUFlLEVBQUUsSUFBNEI7UUFDdEQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFFRDs7T0FFRztJQUNILE9BQU8sQ0FBQyxPQUFlO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDM0MsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVSxDQUNSLE9BQWUsRUFDZixTQUFzQyxFQUN0QyxRQUF3QixFQUN4QixTQUF5QjtRQUV6QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN0RCxJQUFJLENBQUMsV0FBVztZQUFFLE9BQU87UUFFekIsSUFBSSxTQUFTLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDbkMsWUFBWTtZQUNaLElBQUksUUFBUSxLQUFLLFlBQVksRUFBRSxDQUFDO2dCQUM5QixJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FDdEIsT0FBTyxFQUNQLHdCQUFnQixDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLGlCQUFpQixDQUFDLENBQ25FLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixZQUFZO1lBQ1osSUFBSSxTQUFTLEtBQUssVUFBVSxJQUFJLENBQUMsa0JBQVUsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztnQkFDbkUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQ3RCLE9BQU8sRUFDUCx3QkFBZ0IsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxpQkFBaUIsQ0FBQyxDQUNqRSxDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFuREQsb0RBbURDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixTQUFTLENBQUksS0FBYztJQUN6QyxPQUFPLGtCQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3JDLENBQUM7QUFFRCxTQUFnQixXQUFXLENBQUksS0FBYztJQUMzQyxPQUFPLGtCQUFVLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFFRCxTQUFnQixRQUFRLENBQUksS0FBcUIsRUFBRSxTQUF3QjtJQUN6RSxPQUFPLHdCQUFnQixDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQzNFLENBQUM7QUFFRCxTQUFnQixLQUFLLENBQUksS0FBUSxFQUFFLE1BQWM7SUFDL0MsT0FBTyx3QkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN0RCxDQUFDO0FBRUQ7OztHQUdHO0FBQ0gsTUFBYSxpQkFBaUI7SUFDNUI7OztPQUdHO0lBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FDbkIsVUFHQyxFQUNELGNBR0M7UUFFRCwwQkFBMEI7UUFDMUIsNkNBQTZDO1FBQzdDLDZDQUE2QztRQUM3QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNsRCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ2hGLE9BQU8sS0FBSyxDQUFDO1lBQ2YsQ0FBQztRQUNILENBQUM7UUFFRCxxQkFBcUI7UUFDckIsc0NBQXNDO1FBQ3RDLCtDQUErQztRQUMvQyxPQUFPLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM5RSxDQUFDO0NBQ0Y7QUE3QkQsOENBNkJDO0FBNEJEOztHQUVHO0FBQ0gsTUFBYSxzQkFBc0I7SUFDakM7O09BRUc7SUFDSCxNQUFNLENBQUMsV0FBVyxDQUNoQixRQUEwQixFQUMxQixhQUErQjtRQUUvQixNQUFNLFlBQVksR0FBRyxRQUFRLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFNUUsSUFBSSxRQUFRLENBQUMsaUJBQWlCLEtBQU0sS0FBeUIsRUFBRSxDQUFDO1lBQzlELDZCQUE2QjtZQUM3QixJQUFJLFlBQVksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDakQsT0FBTyx3QkFBZ0IsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1lBQzFFLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNOLDRCQUE0QjtZQUM1QixJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDbEQsT0FBTyx3QkFBZ0IsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO1lBQzFFLENBQUM7UUFDSCxDQUFDO1FBRUQsT0FBTyx3QkFBZ0IsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO0lBQzVFLENBQUM7Q0FDRjtBQXhCRCx3REF3QkM7QUFFRDs7R0FFRztBQUNILE1BQWEsa0JBQW1CLFNBQVEsS0FBSztJQUd6QjtJQUNBO0lBQ0E7SUFKbEIsWUFDRSxPQUFlLEVBQ0MsUUFBd0IsRUFDeEIsTUFBc0IsRUFDdEIsUUFBeUQ7UUFFekUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBSkMsYUFBUSxHQUFSLFFBQVEsQ0FBZ0I7UUFDeEIsV0FBTSxHQUFOLE1BQU0sQ0FBZ0I7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBaUQ7UUFHekUsSUFBSSxDQUFDLElBQUksR0FBRyxvQkFBb0IsQ0FBQztJQUNuQyxDQUFDO0NBQ0Y7QUFWRCxnREFVQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc2FzYWthbWEvUHJvamVjdHMvUmltb3Ivc3JjL3NlY3VyaXR5L3R5cGVzL2NoZWNrZXItZnJhbWV3b3JrLXR5cGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2hlY2tlciBGcmFtZXdvcmvkupLmj5vjga7lnovlrprnvqlcbiAqIGFyWGl2OjI1MDQuMTg1Mjl2MiBcIlByYWN0aWNhbCBUeXBlLUJhc2VkIFRhaW50IENoZWNraW5nIGFuZCBJbmZlcmVuY2VcIiDjga7lrp/oo4VcbiAqIFxuICog44GT44Gu44OV44Kh44Kk44Or44Gv6KuW5paH44Gn5o+Q5qGI44GV44KM44Gm44GE44KL5Z6L44K344K544OG44Og44KSVHlwZVNjcmlwdOOBp+Wun+ijheOBl+OBvuOBmeOAglxuICovXG5cbmltcG9ydCB7IFRhaW50TGV2ZWwgfSBmcm9tICcuL3RhaW50JztcblxuLyoqXG4gKiDmsZrmn5Pkv67po77lrZDjga7lnotcbiAqIOirluaWh+OBrlNlY3Rpb24gMi4x44Gn5a6a576p44GV44KM44Gm44GE44KL5Z6L5L+u6aO+5a2QXG4gKi9cbmV4cG9ydCB0eXBlIFRhaW50UXVhbGlmaWVyID0gJ0BUYWludGVkJyB8ICdAVW50YWludGVkJyB8ICdAUG9seVRhaW50JztcblxuLyoqXG4gKiDkvJ3mkq3opo/liYfjga7lnotcbiAqL1xuZXhwb3J0IHR5cGUgUHJvcGFnYXRpb25SdWxlID0gJ2FueScgfCAnYWxsJztcblxuLyoqXG4gKiDlnovjgq/jgqrjg6rjg5XjgqHjgqTjgqLpmo7lsaRcbiAqIEBUYWludGVkIOOBjCBAVW50YWludGVkIOOBruOCueODvOODkeODvOOCv+OCpOODl1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFR5cGVRdWFsaWZpZXJIaWVyYXJjaHkge1xuICAnQFRhaW50ZWQnOiB7XG4gICAgc3VidHlwZXM6IFsnQFVudGFpbnRlZCddO1xuICAgIHN1cGVydHlwZXM6IFtdO1xuICB9O1xuICAnQFVudGFpbnRlZCc6IHtcbiAgICBzdWJ0eXBlczogW107XG4gICAgc3VwZXJ0eXBlczogWydAVGFpbnRlZCddO1xuICB9O1xuICAnQFBvbHlUYWludCc6IHtcbiAgICBzdWJ0eXBlczogWydAVGFpbnRlZCcsICdAVW50YWludGVkJ107XG4gICAgc3VwZXJ0eXBlczogWydAVGFpbnRlZCcsICdAVW50YWludGVkJ107XG4gIH07XG59XG5cbi8qKlxuICog5rGa5p+T44GV44KM44Gf5Z6LIC0gQFRhaW50ZWRcbiAqIOaUu+aSg+iAheOBq+W9semfv+OBleOCjOOCi+WPr+iDveaAp+OBruOBguOCi+WApOOCkuihqOOBmVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRhaW50ZWRUeXBlPFQ+IHtcbiAgcmVhZG9ubHkgX19icmFuZDogJ0BUYWludGVkJztcbiAgcmVhZG9ubHkgX192YWx1ZTogVDtcbiAgcmVhZG9ubHkgX19zb3VyY2U6IHN0cmluZztcbiAgcmVhZG9ubHkgX19jb25maWRlbmNlOiBudW1iZXI7XG59XG5cbi8qKlxuICog5riF5rWE44Gq5Z6LIC0gQFVudGFpbnRlZFxuICog5a6M5YWo44Gr5a6J5YWo44Gn5L+h6aC844Gn44GN44KL5YCk44KS6KGo44GZXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVW50YWludGVkVHlwZTxUPiB7XG4gIHJlYWRvbmx5IF9fYnJhbmQ6ICdAVW50YWludGVkJztcbiAgcmVhZG9ubHkgX192YWx1ZTogVDtcbiAgcmVhZG9ubHkgX19zYW5pdGl6ZWRCeT86IHN0cmluZztcbiAgcmVhZG9ubHkgX192YWxpZGF0ZWRBdD86IG51bWJlcjtcbn1cblxuLyoqXG4gKiDjg53jg6rjg6Ljg7zjg5XjgqPjg4Pjgq/msZrmn5PlnosgLSBAUG9seVRhaW50XG4gKiDjg6Hjgr3jg4Pjg4njga7msZrmn5PmjJnli5XjgYzlvJXmlbDjgavkvp3lrZjjgZnjgovloLTlkIjjgavkvb/nlKhcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQb2x5VGFpbnRUeXBlPFQ+IHtcbiAgcmVhZG9ubHkgX19icmFuZDogJ0BQb2x5VGFpbnQnO1xuICByZWFkb25seSBfX3ZhbHVlOiBUO1xuICByZWFkb25seSBfX3BhcmFtZXRlckluZGljZXM6IG51bWJlcltdO1xuICByZWFkb25seSBfX3Byb3BhZ2F0aW9uUnVsZTogUHJvcGFnYXRpb25SdWxlO1xufVxuXG4vKipcbiAqIOWei+OCr+OCquODquODleOCoeOCpOOCouOBruODpuODi+OCquODs+Wei1xuICog6KuW5paH44GuRmlndXJlIDHjgavlr77lv5xcbiAqL1xuZXhwb3J0IHR5cGUgUXVhbGlmaWVkVHlwZTxUPiA9IFRhaW50ZWRUeXBlPFQ+IHwgVW50YWludGVkVHlwZTxUPiB8IFBvbHlUYWludFR5cGU8VD47XG5cbi8qKlxuICog5Z6L44Kv44Kq44Oq44OV44Kh44Kk44Ki44Gu44Ks44O844OJ6Zai5pWwXG4gKi9cbmV4cG9ydCBjb25zdCBUeXBlR3VhcmRzID0ge1xuICBpc1RhaW50ZWQ8VD4odmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBUYWludGVkVHlwZTxUPiB7XG4gICAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICAgICAgICdfX2JyYW5kJyBpbiB2YWx1ZSAmJiAodmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLl9fYnJhbmQgPT09ICdAVGFpbnRlZCc7XG4gIH0sXG4gIFxuICBpc1VudGFpbnRlZDxUPih2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIFVudGFpbnRlZFR5cGU8VD4ge1xuICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIFxuICAgICAgICAgICAnX19icmFuZCcgaW4gdmFsdWUgJiYgKHZhbHVlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5fX2JyYW5kID09PSAnQFVudGFpbnRlZCc7XG4gIH0sXG4gIFxuICBpc1BvbHlUYWludDxUPih2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIFBvbHlUYWludFR5cGU8VD4ge1xuICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIFxuICAgICAgICAgICAnX19icmFuZCcgaW4gdmFsdWUgJiYgKHZhbHVlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5fX2JyYW5kID09PSAnQFBvbHlUYWludCc7XG4gIH1cbn07XG5cbi8qKlxuICog5Z6L44Kz44Oz44K544OI44Op44Kv44K/XG4gKiDoq5bmlofjga5TZWN0aW9uIDPjgafoqqzmmI7jgZXjgozjgabjgYTjgovlnovmp4vnr4lcbiAqL1xuZXhwb3J0IGNvbnN0IFR5cGVDb25zdHJ1Y3RvcnMgPSB7XG4gIC8qKlxuICAgKiDmsZrmn5PjgZXjgozjgZ/lgKTjgpLkvZzmiJBcbiAgICovXG4gIHRhaW50ZWQ8VD4odmFsdWU6IFQsIHNvdXJjZTogc3RyaW5nLCBjb25maWRlbmNlOiBudW1iZXIgPSAxLjApOiBUYWludGVkVHlwZTxUPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYnJhbmQ6ICdAVGFpbnRlZCcsXG4gICAgICBfX3ZhbHVlOiB2YWx1ZSxcbiAgICAgIF9fc291cmNlOiBzb3VyY2UsXG4gICAgICBfX2NvbmZpZGVuY2U6IGNvbmZpZGVuY2VcbiAgICB9O1xuICB9LFxuICBcbiAgLyoqXG4gICAqIOa4hea1hOOBquWApOOCkuS9nOaIkFxuICAgKi9cbiAgdW50YWludGVkPFQ+KHZhbHVlOiBULCBzYW5pdGl6ZWRCeT86IHN0cmluZyk6IFVudGFpbnRlZFR5cGU8VD4ge1xuICAgIHJldHVybiB7XG4gICAgICBfX2JyYW5kOiAnQFVudGFpbnRlZCcsXG4gICAgICBfX3ZhbHVlOiB2YWx1ZSxcbiAgICAgIF9fc2FuaXRpemVkQnk6IHNhbml0aXplZEJ5LFxuICAgICAgX192YWxpZGF0ZWRBdDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH0sXG4gIFxuICAvKipcbiAgICog44Od44Oq44Oi44O844OV44Kj44OD44Kv5rGa5p+T5YCk44KS5L2c5oiQXG4gICAqL1xuICBwb2x5VGFpbnQ8VD4oXG4gICAgdmFsdWU6IFQsIFxuICAgIHBhcmFtZXRlckluZGljZXM6IG51bWJlcltdID0gW10sIFxuICAgIHByb3BhZ2F0aW9uUnVsZTogUHJvcGFnYXRpb25SdWxlID0gJ2FueSdcbiAgKTogUG9seVRhaW50VHlwZTxUPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9fYnJhbmQ6ICdAUG9seVRhaW50JyxcbiAgICAgIF9fdmFsdWU6IHZhbHVlLFxuICAgICAgX19wYXJhbWV0ZXJJbmRpY2VzOiBwYXJhbWV0ZXJJbmRpY2VzLFxuICAgICAgX19wcm9wYWdhdGlvblJ1bGU6IHByb3BhZ2F0aW9uUnVsZVxuICAgIH07XG4gIH1cbn07XG5cbi8qKlxuICog44K144OW44K/44Kk44OU44Oz44Kw6Zai5L+C44Gu44OB44Kn44OD44KvXG4gKiDoq5bmlofjga5TZWN0aW9uIDIuMuOBp+Wumue+qeOBleOCjOOBpuOBhOOCi+imj+WJh1xuICovXG5leHBvcnQgY2xhc3MgU3VidHlwaW5nQ2hlY2tlciB7XG4gIC8qKlxuICAgKiBh44GMYuOBruOCteODluOCv+OCpOODl+OBi+OBqeOBhuOBi+OCkuODgeOCp+ODg+OCr1xuICAgKiBAVW50YWludGVkIDw6IEBUYWludGVkICh1bnRhaW50ZWTjga90YWludGVk44Gu44K144OW44K/44Kk44OXKVxuICAgKi9cbiAgc3RhdGljIGlzU3VidHlwZShhOiBUYWludFF1YWxpZmllciwgYjogVGFpbnRRdWFsaWZpZXIpOiBib29sZWFuIHtcbiAgICBpZiAoYSA9PT0gYikgcmV0dXJuIHRydWU7XG4gICAgaWYgKGEgPT09ICdAVW50YWludGVkJyAmJiBiID09PSAnQFRhaW50ZWQnKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoYSA9PT0gJ0BQb2x5VGFpbnQnKSByZXR1cm4gdHJ1ZTsgLy8gUG9seVRhaW5044Gv5paH6ISI5L6d5a2YXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICAvKipcbiAgICog5Luj5YWl44Gu5a6J5YWo5oCn44KS44OB44Kn44OD44KvXG4gICAqIOWPs+i+uuOBjOW3pui+uuOBruOCteODluOCv+OCpOODl+OBp+OBguOCi+W/heimgeOBjOOBguOCi1xuICAgKi9cbiAgc3RhdGljIGlzQXNzaWdubWVudFNhZmU8VD4oXG4gICAgbGhzOiBRdWFsaWZpZWRUeXBlPFQ+LCBcbiAgICByaHM6IFF1YWxpZmllZFR5cGU8VD5cbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gQFVudGFpbnRlZCDjgpIgQFRhaW50ZWQg44Gr5Luj5YWl44GZ44KL44Gu44Gv5a6J5YWoXG4gICAgaWYgKFR5cGVHdWFyZHMuaXNVbnRhaW50ZWQocmhzKSAmJiBUeXBlR3VhcmRzLmlzVGFpbnRlZChsaHMpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgLy8gQFRhaW50ZWQg44KSIEBVbnRhaW50ZWQg44Gr5Luj5YWl44GZ44KL44Gu44Gv5Y2x6Zm6XG4gICAgaWYgKFR5cGVHdWFyZHMuaXNUYWludGVkKHJocykgJiYgVHlwZUd1YXJkcy5pc1VudGFpbnRlZChsaHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIOWQjOOBmOWei+OCr+OCquODquODleOCoeOCpOOCouWQjOWjq+OBr+WuieWFqFxuICAgIGlmIChsaHMuX19icmFuZCA9PT0gcmhzLl9fYnJhbmQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBcbiAgICAvLyBQb2x5VGFpbnTjga/mlofohIjkvp3lrZhcbiAgICBpZiAoVHlwZUd1YXJkcy5pc1BvbHlUYWludChsaHMpIHx8IFR5cGVHdWFyZHMuaXNQb2x5VGFpbnQocmhzKSkge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIOWun+ihjOaZguOBq+WIpOWumlxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiDlnovjga7mmIfmoLzjg7vpmY3moLxcbiAqIOirluaWh+OBrlNlY3Rpb24gMy4y44Gn6Kqs5piO44GV44KM44Gm44GE44KL5pON5L2cXG4gKi9cbmV4cG9ydCBjbGFzcyBUeXBlUHJvbW90aW9uIHtcbiAgLyoqXG4gICAqIOOCteODi+OCv+OCpOOCtuODvOOBq+OCiOOCi+Wei+OBruaYh+agvFxuICAgKiBAVGFpbnRlZCAtPiBAVW50YWludGVkXG4gICAqL1xuICBzdGF0aWMgc2FuaXRpemU8VD4odGFpbnRlZDogVGFpbnRlZFR5cGU8VD4sIHNhbml0aXplck5hbWU6IHN0cmluZyk6IFVudGFpbnRlZFR5cGU8VD4ge1xuICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnVudGFpbnRlZCh0YWludGVkLl9fdmFsdWUsIHNhbml0aXplck5hbWUpO1xuICB9XG4gIFxuICAvKipcbiAgICog5rGa5p+T5rqQ44Gr44KI44KL5Z6L44Gu6ZmN5qC8XG4gICAqIEBVbnRhaW50ZWQgLT4gQFRhaW50ZWRcbiAgICovXG4gIHN0YXRpYyB0YWludDxUPih1bnRhaW50ZWQ6IFVudGFpbnRlZFR5cGU8VD4sIHNvdXJjZTogc3RyaW5nKTogVGFpbnRlZFR5cGU8VD4ge1xuICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnRhaW50ZWQodW50YWludGVkLl9fdmFsdWUsIHNvdXJjZSwgMS4wKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIOadoeS7tuS7mOOBjeaYh+agvO+8iOaknOiovOOBq+OCiOOCi++8iVxuICAgKi9cbiAgc3RhdGljIGNvbmRpdGlvbmFsUHJvbW90ZTxUPihcbiAgICB2YWx1ZTogUXVhbGlmaWVkVHlwZTxUPiwgXG4gICAgY29uZGl0aW9uOiAodjogVCkgPT4gYm9vbGVhbixcbiAgICBzYW5pdGl6ZXJOYW1lOiBzdHJpbmdcbiAgKTogUXVhbGlmaWVkVHlwZTxUPiB7XG4gICAgaWYgKFR5cGVHdWFyZHMuaXNUYWludGVkKHZhbHVlKSAmJiBjb25kaXRpb24odmFsdWUuX192YWx1ZSkpIHtcbiAgICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnVudGFpbnRlZCh2YWx1ZS5fX3ZhbHVlLCBzYW5pdGl6ZXJOYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59XG5cbi8qKlxuICog5Z6L44Gu5Lyd5pKt6KaP5YmHXG4gKiDoq5bmlofjga5TZWN0aW9uIDMuM+OBp+Wumue+qeOBleOCjOOBpuOBhOOCi+imj+WJh1xuICovXG5leHBvcnQgY2xhc3MgVHlwZVByb3BhZ2F0aW9uIHtcbiAgLyoqXG4gICAqIOS6jOmghea8lOeul+OBrue1kOaenOOBruWei+OCkuaxuuWumlxuICAgKiDjgojjgorliLbpmZDnmoTjgarlnovvvIhAVGFpbnRlZO+8ieOBjOWEquWFiOOBleOCjOOCi1xuICAgKi9cbiAgc3RhdGljIGJpbmFyeU9wZXJhdGlvbjxULCBVLCBSPihcbiAgICBsaHM6IFF1YWxpZmllZFR5cGU8VD4sXG4gICAgcmhzOiBRdWFsaWZpZWRUeXBlPFU+LFxuICAgIG9wZXJhdGlvbjogKGE6IFQsIGI6IFUpID0+IFJcbiAgKTogUXVhbGlmaWVkVHlwZTxSPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gb3BlcmF0aW9uKGxocy5fX3ZhbHVlLCByaHMuX192YWx1ZSk7XG4gICAgXG4gICAgLy8g44Gp44Gh44KJ44GL44GMQFRhaW50ZWTjgarjgonntZDmnpzjgoJAVGFpbnRlZFxuICAgIGlmIChUeXBlR3VhcmRzLmlzVGFpbnRlZChsaHMpIHx8IFR5cGVHdWFyZHMuaXNUYWludGVkKHJocykpIHtcbiAgICAgIGNvbnN0IHNvdXJjZSA9IFR5cGVHdWFyZHMuaXNUYWludGVkKGxocykgPyBsaHMuX19zb3VyY2UgOiBcbiAgICAgICAgICAgICAgICAgICAgVHlwZUd1YXJkcy5pc1RhaW50ZWQocmhzKSA/IHJocy5fX3NvdXJjZSA6ICd1bmtub3duJztcbiAgICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnRhaW50ZWQocmVzdWx0LCBzb3VyY2UpO1xuICAgIH1cbiAgICBcbiAgICAvLyDkuKHmlrnjgYxAVW50YWludGVk44Gq44KJ57WQ5p6c44KCQFVudGFpbnRlZFxuICAgIGlmIChUeXBlR3VhcmRzLmlzVW50YWludGVkKGxocykgJiYgVHlwZUd1YXJkcy5pc1VudGFpbnRlZChyaHMpKSB7XG4gICAgICByZXR1cm4gVHlwZUNvbnN0cnVjdG9ycy51bnRhaW50ZWQocmVzdWx0KTtcbiAgICB9XG4gICAgXG4gICAgLy8gUG9seVRhaW5044GM5ZCr44G+44KM44KL5aC05ZCI44Gv5paH6ISI5L6d5a2YXG4gICAgcmV0dXJuIFR5cGVDb25zdHJ1Y3RvcnMucG9seVRhaW50KHJlc3VsdCk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiDjg6Hjgr3jg4Pjg4nlkbzjgbPlh7rjgZfjga7ntZDmnpzjga7lnovjgpLmsbrlrppcbiAgICovXG4gIHN0YXRpYyBtZXRob2RDYWxsPFQsIFI+KFxuICAgIHJlY2VpdmVyOiBRdWFsaWZpZWRUeXBlPFQ+LFxuICAgIG1ldGhvZE5hbWU6IHN0cmluZyxcbiAgICBhcmdzOiBRdWFsaWZpZWRUeXBlPHVua25vd24+W10sXG4gICAgbWV0aG9kOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiBSXG4gICk6IFF1YWxpZmllZFR5cGU8Uj4ge1xuICAgIGNvbnN0IGFyZ1ZhbHVlcyA9IGFyZ3MubWFwKGFyZyA9PiBhcmcuX192YWx1ZSk7XG4gICAgY29uc3QgcmVzdWx0ID0gbWV0aG9kLmFwcGx5KHJlY2VpdmVyLl9fdmFsdWUsIGFyZ1ZhbHVlcyk7XG4gICAgXG4gICAgLy8g44Os44K344O844OQ44O844G+44Gf44Gv5byV5pWw44Gu44GE44Ga44KM44GL44GM5rGa5p+T44GV44KM44Gm44GE44KM44Gw57WQ5p6c44KC5rGa5p+TXG4gICAgY29uc3QgdGFpbnRlZElucHV0cyA9IFtyZWNlaXZlciwgLi4uYXJnc10uZmlsdGVyKFR5cGVHdWFyZHMuaXNUYWludGVkKTtcbiAgICBpZiAodGFpbnRlZElucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gVHlwZUNvbnN0cnVjdG9ycy50YWludGVkKHJlc3VsdCwgdGFpbnRlZElucHV0c1swXS5fX3NvdXJjZSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnVudGFpbnRlZChyZXN1bHQpO1xuICB9XG59XG5cbi8qKlxuICog44OV44Ot44O85oSf5bqm44Gu5Z6L44OB44Kn44OD44KvXG4gKiDoq5bmlofjga5TZWN0aW9uIDTjgafoqqzmmI7jgZXjgozjgabjgYTjgovmiYvms5VcbiAqL1xuZXhwb3J0IGNsYXNzIEZsb3dTZW5zaXRpdmVDaGVja2VyIHtcbiAgcHJpdmF0ZSB0eXBlRW52aXJvbm1lbnQ6IE1hcDxzdHJpbmcsIFF1YWxpZmllZFR5cGU8dW5rbm93bj4+O1xuICBcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50eXBlRW52aXJvbm1lbnQgPSBuZXcgTWFwKCk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiDlpInmlbDjga7lnovjgpLmm7TmlrBcbiAgICovXG4gIHVwZGF0ZVR5cGUodmFyTmFtZTogc3RyaW5nLCB0eXBlOiBRdWFsaWZpZWRUeXBlPHVua25vd24+KTogdm9pZCB7XG4gICAgdGhpcy50eXBlRW52aXJvbm1lbnQuc2V0KHZhck5hbWUsIHR5cGUpO1xuICB9XG4gIFxuICAvKipcbiAgICog5aSJ5pWw44Gu54++5Zyo44Gu5Z6L44KS5Y+W5b6XXG4gICAqL1xuICBnZXRUeXBlKHZhck5hbWU6IHN0cmluZyk6IFF1YWxpZmllZFR5cGU8dW5rbm93bj4gfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLnR5cGVFbnZpcm9ubWVudC5nZXQodmFyTmFtZSk7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiDmnaHku7bliIblspDjgafjga7lnovjga7nsr7nt7vljJZcbiAgICovXG4gIHJlZmluZVR5cGUoXG4gICAgdmFyTmFtZTogc3RyaW5nLCBcbiAgICBjb25kaXRpb246ICh2YWx1ZTogdW5rbm93bikgPT4gYm9vbGVhbixcbiAgICB0cnVlVHlwZTogVGFpbnRRdWFsaWZpZXIsXG4gICAgZmFsc2VUeXBlOiBUYWludFF1YWxpZmllclxuICApOiB2b2lkIHtcbiAgICBjb25zdCBjdXJyZW50VHlwZSA9IHRoaXMudHlwZUVudmlyb25tZW50LmdldCh2YXJOYW1lKTtcbiAgICBpZiAoIWN1cnJlbnRUeXBlKSByZXR1cm47XG4gICAgXG4gICAgaWYgKGNvbmRpdGlvbihjdXJyZW50VHlwZS5fX3ZhbHVlKSkge1xuICAgICAgLy8g5p2h5Lu244GM55yf44Gu5aC05ZCI44Gu5Z6LXG4gICAgICBpZiAodHJ1ZVR5cGUgPT09ICdAVW50YWludGVkJykge1xuICAgICAgICB0aGlzLnR5cGVFbnZpcm9ubWVudC5zZXQoXG4gICAgICAgICAgdmFyTmFtZSwgXG4gICAgICAgICAgVHlwZUNvbnN0cnVjdG9ycy51bnRhaW50ZWQoY3VycmVudFR5cGUuX192YWx1ZSwgJ2Zsb3ctcmVmaW5lbWVudCcpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOadoeS7tuOBjOWBveOBruWgtOWQiOOBruWei1xuICAgICAgaWYgKGZhbHNlVHlwZSA9PT0gJ0BUYWludGVkJyAmJiAhVHlwZUd1YXJkcy5pc1RhaW50ZWQoY3VycmVudFR5cGUpKSB7XG4gICAgICAgIHRoaXMudHlwZUVudmlyb25tZW50LnNldChcbiAgICAgICAgICB2YXJOYW1lLFxuICAgICAgICAgIFR5cGVDb25zdHJ1Y3RvcnMudGFpbnRlZChjdXJyZW50VHlwZS5fX3ZhbHVlLCAnZmxvdy1yZWZpbmVtZW50JylcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiDnsKHkvr/jgarjg5jjg6vjg5Hjg7zplqLmlbBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVGFpbnRlZDxUPih2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIFRhaW50ZWRUeXBlPFQ+IHtcbiAgcmV0dXJuIFR5cGVHdWFyZHMuaXNUYWludGVkKHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzVW50YWludGVkPFQ+KHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgVW50YWludGVkVHlwZTxUPiB7XG4gIHJldHVybiBUeXBlR3VhcmRzLmlzVW50YWludGVkKHZhbHVlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNhbml0aXplPFQ+KHZhbHVlOiBUYWludGVkVHlwZTxUPiwgc2FuaXRpemVyOiAodmFsOiBUKSA9PiBUKTogVW50YWludGVkVHlwZTxUPiB7XG4gIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnVudGFpbnRlZChzYW5pdGl6ZXIodmFsdWUuX192YWx1ZSksICdzYW5pdGl6ZWQnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRhaW50PFQ+KHZhbHVlOiBULCBzb3VyY2U6IHN0cmluZyk6IFRhaW50ZWRUeXBlPFQ+IHtcbiAgcmV0dXJuIFR5cGVDb25zdHJ1Y3RvcnMudGFpbnRlZCh2YWx1ZSwgc291cmNlLCAxLjApO1xufVxuXG4vKipcbiAqIOWei+OBruS6kuaPm+aAp+ODgeOCp+ODg+OCr1xuICog6KuW5paH44GuU2VjdGlvbiA144Gn5a6a576p44GV44KM44Gm44GE44KL6KaP5YmHXG4gKi9cbmV4cG9ydCBjbGFzcyBUeXBlQ29tcGF0aWJpbGl0eSB7XG4gIC8qKlxuICAgKiDjg6Hjgr3jg4Pjg4njgqrjg7zjg5Djg7zjg6njgqTjg4njga7lronlhajmgKfjgpLjg4Hjgqfjg4Pjgq9cbiAgICog5YWx5aSJ44O75Y+N5aSJ44Gu6KaP5YmH44KS6YGp55SoXG4gICAqL1xuICBzdGF0aWMgaXNPdmVycmlkZVNhZmUoXG4gICAgYmFzZU1ldGhvZDoge1xuICAgICAgcGFyYW1zOiBUYWludFF1YWxpZmllcltdO1xuICAgICAgcmV0dXJuOiBUYWludFF1YWxpZmllcjtcbiAgICB9LFxuICAgIG92ZXJyaWRlTWV0aG9kOiB7XG4gICAgICBwYXJhbXM6IFRhaW50UXVhbGlmaWVyW107XG4gICAgICByZXR1cm46IFRhaW50UXVhbGlmaWVyO1xuICAgIH1cbiAgKTogYm9vbGVhbiB7XG4gICAgLy8g44OR44Op44Oh44O844K/44Gv5Y+N5aSJ77yI44KI44KK5LiA6Iis55qE44Gq5Z6L44KS5Y+X44GR5YWl44KM44KL77yJXG4gICAgLy8g44Kq44O844OQ44O844Op44Kk44OJ44Oh44K944OD44OJ44Gv44CB44OZ44O844K544Oh44K944OD44OJ44KI44KK5LiA6Iis55qE44Gq44OR44Op44Oh44O844K/44KS5Y+X44GR5YWl44KM44KL5b+F6KaB44GM44GC44KLXG4gICAgLy8g44Gk44G+44KK44CBYmFzZSBwYXJhbSA8OiBvdmVycmlkZSBwYXJhbSDjgafjgarjgZHjgozjgbDjgarjgonjgarjgYRcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJhc2VNZXRob2QucGFyYW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIVN1YnR5cGluZ0NoZWNrZXIuaXNTdWJ0eXBlKGJhc2VNZXRob2QucGFyYW1zW2ldLCBvdmVycmlkZU1ldGhvZC5wYXJhbXNbaV0pKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8g5oi744KK5YCk44Gv5YWx5aSJ77yI44KI44KK5YW35L2T55qE44Gq5Z6L44KS6L+U44GZ77yJXG4gICAgLy8g44Kq44O844OQ44O844Op44Kk44OJ44Oh44K944OD44OJ44Gv44CB44OZ44O844K544Oh44K944OD44OJ44KI44KK5YW35L2T55qE44Gq5Z6L44KS6L+U44GZ5b+F6KaB44GM44GC44KLXG4gICAgLy8g44Gk44G+44KK44CBb3ZlcnJpZGUgcmV0dXJuIDw6IGJhc2UgcmV0dXJuIOOBp+OBquOBkeOCjOOBsOOBquOCieOBquOBhFxuICAgIHJldHVybiBTdWJ0eXBpbmdDaGVja2VyLmlzU3VidHlwZShvdmVycmlkZU1ldGhvZC5yZXR1cm4sIGJhc2VNZXRob2QucmV0dXJuKTtcbiAgfVxufVxuXG4vKipcbiAqIOWei+aOqOirluOBruODkuODs+ODiFxuICog6KuW5paH44GuU2VjdGlvbiA244Gn6Kqs5piO44GV44KM44Gm44GE44KL5o6o6KuW44Ki44Or44K044Oq44K644Og55SoXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVHlwZUluZmVyZW5jZUhpbnQge1xuICB2YXJpYWJsZTogc3RyaW5nO1xuICBwb3NzaWJsZVR5cGVzOiBUYWludFF1YWxpZmllcltdO1xuICBjb25maWRlbmNlOiBudW1iZXI7XG4gIGV2aWRlbmNlOiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiDlnovliLbntIRcbiAqIOaOqOirluOCouODq+OCtOODquOCuuODoOOBp+S9v+eUqOOBleOCjOOCi+WItue0hFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFR5cGVDb25zdHJhaW50IHtcbiAgdHlwZTogJ3N1YnR5cGUnIHwgJ2VxdWFsaXR5JyB8ICdmbG93JztcbiAgbGhzOiBzdHJpbmcgfCBUYWludFF1YWxpZmllcjtcbiAgcmhzOiBzdHJpbmcgfCBUYWludFF1YWxpZmllcjtcbiAgbG9jYXRpb246IHtcbiAgICBmaWxlOiBzdHJpbmc7XG4gICAgbGluZTogbnVtYmVyO1xuICAgIGNvbHVtbjogbnVtYmVyO1xuICB9O1xufVxuXG4vKipcbiAqIOODneODquODouODvOODleOCo+ODg+OCr+Wei+OBruOCpOODs+OCueOCv+ODs+OCueWMllxuICovXG5leHBvcnQgY2xhc3MgUG9seVRhaW50SW5zdGFudGlhdGlvbiB7XG4gIC8qKlxuICAgKiBQb2x5VGFpbnTlnovjgpLlhbfkvZPnmoTjgarlnovjgavjgqTjg7Pjgrnjgr/jg7PjgrnljJZcbiAgICovXG4gIHN0YXRpYyBpbnN0YW50aWF0ZTxUPihcbiAgICBwb2x5VHlwZTogUG9seVRhaW50VHlwZTxUPixcbiAgICBhcmd1bWVudFR5cGVzOiBUYWludFF1YWxpZmllcltdXG4gICk6IFF1YWxpZmllZFR5cGU8VD4ge1xuICAgIGNvbnN0IHJlbGV2YW50QXJncyA9IHBvbHlUeXBlLl9fcGFyYW1ldGVySW5kaWNlcy5tYXAoaSA9PiBhcmd1bWVudFR5cGVzW2ldKTtcbiAgICBcbiAgICBpZiAocG9seVR5cGUuX19wcm9wYWdhdGlvblJ1bGUgPT09ICgnYW55JyBhcyBQcm9wYWdhdGlvblJ1bGUpKSB7XG4gICAgICAvLyDjgYTjgZrjgozjgYvjgYxAVGFpbnRlZOOBquOCiee1kOaenOOCgkBUYWludGVkXG4gICAgICBpZiAocmVsZXZhbnRBcmdzLnNvbWUoYXJnID0+IGFyZyA9PT0gJ0BUYWludGVkJykpIHtcbiAgICAgICAgcmV0dXJuIFR5cGVDb25zdHJ1Y3RvcnMudGFpbnRlZChwb2x5VHlwZS5fX3ZhbHVlLCAncG9seS1pbnN0YW50aWF0aW9uJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIOOBmeOBueOBpuOBjEBUYWludGVk44Gq44KJ57WQ5p6c44KCQFRhaW50ZWRcbiAgICAgIGlmIChyZWxldmFudEFyZ3MuZXZlcnkoYXJnID0+IGFyZyA9PT0gJ0BUYWludGVkJykpIHtcbiAgICAgICAgcmV0dXJuIFR5cGVDb25zdHJ1Y3RvcnMudGFpbnRlZChwb2x5VHlwZS5fX3ZhbHVlLCAncG9seS1pbnN0YW50aWF0aW9uJyk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBUeXBlQ29uc3RydWN0b3JzLnVudGFpbnRlZChwb2x5VHlwZS5fX3ZhbHVlLCAncG9seS1pbnN0YW50aWF0aW9uJyk7XG4gIH1cbn1cblxuLyoqXG4gKiDlnovjgqjjg6njg7xcbiAqL1xuZXhwb3J0IGNsYXNzIFR5cGVRdWFsaWZpZXJFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIHB1YmxpYyByZWFkb25seSBleHBlY3RlZDogVGFpbnRRdWFsaWZpZXIsXG4gICAgcHVibGljIHJlYWRvbmx5IGFjdHVhbDogVGFpbnRRdWFsaWZpZXIsXG4gICAgcHVibGljIHJlYWRvbmx5IGxvY2F0aW9uPzogeyBmaWxlOiBzdHJpbmc7IGxpbmU6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKTtcbiAgICB0aGlzLm5hbWUgPSAnVHlwZVF1YWxpZmllckVycm9yJztcbiAgfVxufVxuXG4vKipcbiAqIOWei+ODgeOCp+ODg+OCr+e1kOaenFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFR5cGVDaGVja1Jlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yczogVHlwZVF1YWxpZmllckVycm9yW107XG4gIHdhcm5pbmdzOiBBcnJheTx7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGxvY2F0aW9uPzogeyBmaWxlOiBzdHJpbmc7IGxpbmU6IG51bWJlcjsgY29sdW1uOiBudW1iZXIgfTtcbiAgfT47XG59Il0sInZlcnNpb24iOjN9