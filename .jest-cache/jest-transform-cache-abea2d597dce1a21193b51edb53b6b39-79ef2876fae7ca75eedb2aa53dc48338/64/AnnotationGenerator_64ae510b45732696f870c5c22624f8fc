dd607e056406d4b17b55e1714ca1c9d9
"use strict";
/**
 * Annotation Generator
 * v0.8.0 - Phase 4: Context Engineering
 *
 * 検出された問題に対応するインライン・アノテーションを生成
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnnotationGenerator = void 0;
const inversify_1 = require("inversify");
const types_1 = require("./types");
let AnnotationGenerator = class AnnotationGenerator {
    defaultPrefix = 'RIMOR';
    /**
     * 問題に対するアノテーションを生成
     */
    generateAnnotation(issue, options) {
        const prefix = options?.prefix || this.defaultPrefix;
        const format = options?.format || 'inline';
        if (format === 'block') {
            return this.generateBlockAnnotation(issue, prefix, options);
        }
        else {
            return this.generateInlineAnnotation(issue, prefix, options);
        }
    }
    /**
     * インラインアノテーションを生成
     */
    generateInlineAnnotation(issue, prefix, options) {
        const parts = [];
        // プレフィックスと重要度
        parts.push(`${prefix}-${this.getSeverityTag(issue.severity)}:`);
        // 問題タイプ
        parts.push(`[${issue.severity}]`);
        parts.push(issue.type);
        // メッセージ
        parts.push('-');
        parts.push(issue.message);
        // データフロー情報（オプション）
        if (options?.includeDataFlow && issue.dataFlow) {
            parts.push(this.formatDataFlowInline(issue.dataFlow));
        }
        return `// ${parts.join(' ')}`;
    }
    /**
     * ブロックアノテーションを生成
     */
    generateBlockAnnotation(issue, prefix, options) {
        const lines = [];
        // 開始行
        lines.push('/**');
        lines.push(` * ${prefix} Security Analysis Report`);
        lines.push(` * `);
        // 問題の詳細
        lines.push(` * Issue: ${issue.type}`);
        lines.push(` * Severity: ${issue.severity}`);
        lines.push(` * ID: ${issue.id}`);
        lines.push(` * `);
        // メッセージ（複数行対応）
        const messageLines = issue.message.split('\n');
        messageLines.forEach(line => {
            lines.push(` * ${line}`);
        });
        // 推奨事項
        if (issue.recommendation) {
            lines.push(` * `);
            lines.push(` * Recommendation:`);
            const recommendationLines = issue.recommendation.split('\n');
            recommendationLines.forEach(line => {
                lines.push(` * ${line}`);
            });
        }
        // データフロー情報
        if (options?.includeDataFlow && issue.dataFlow) {
            lines.push(` * `);
            lines.push(` * Data Flow Analysis:`);
            lines.push(...this.formatDataFlowBlock(issue.dataFlow));
        }
        // 参考資料
        if (issue.references && issue.references.length > 0) {
            lines.push(` * `);
            lines.push(` * References:`);
            issue.references.forEach(ref => {
                lines.push(` * - ${ref}`);
            });
        }
        // 終了行
        lines.push(' */');
        return lines.join('\n');
    }
    /**
     * 複数の問題に対するアノテーションを行番号でグループ化
     */
    groupAnnotationsByLine(issues, options) {
        const annotationsByFile = new Map();
        issues.forEach(issue => {
            if (!issue.location)
                return;
            const file = issue.location.file;
            if (!annotationsByFile.has(file)) {
                annotationsByFile.set(file, []);
            }
            const annotation = this.generateAnnotation(issue, options);
            const annotationLine = {
                lineNumber: issue.location.startLine - 1, // 0-indexed
                annotation
            };
            annotationsByFile.get(file).push(annotationLine);
        });
        // 各ファイルのアノテーションを行番号でソート
        annotationsByFile.forEach((annotations, file) => {
            annotations.sort((a, b) => a.lineNumber - b.lineNumber);
        });
        return annotationsByFile;
    }
    /**
     * アノテーション用のスタンドアロンレポートを生成
     */
    generateAnnotationReport(issues) {
        const lines = [];
        lines.push('# Rimor Annotation Report');
        lines.push('');
        lines.push('## Summary');
        lines.push(`Total issues found: ${issues.length}`);
        lines.push('');
        // ファイル別にグループ化
        const issuesByFile = new Map();
        issues.forEach(issue => {
            if (!issue.location)
                return;
            const file = issue.location.file;
            if (!issuesByFile.has(file)) {
                issuesByFile.set(file, []);
            }
            issuesByFile.get(file).push(issue);
        });
        // ファイルごとにアノテーションを生成
        issuesByFile.forEach((fileIssues, file) => {
            lines.push(`## File: ${file}`);
            lines.push('');
            // 行番号でソート
            fileIssues.sort((a, b) => (a.location?.startLine || 0) - (b.location?.startLine || 0));
            fileIssues.forEach(issue => {
                lines.push(`### Line ${issue.location?.startLine || 0}: ${issue.type}`);
                lines.push('');
                lines.push('```');
                lines.push(this.generateAnnotation(issue, { format: 'inline' }));
                lines.push('```');
                lines.push('');
                if (issue.recommendation) {
                    lines.push(`**Recommendation**: ${issue.recommendation}`);
                    lines.push('');
                }
            });
        });
        return lines.join('\n');
    }
    /**
     * 重要度タグを取得
     */
    getSeverityTag(severity) {
        const tags = {
            [types_1.Severity.CRITICAL]: 'CRITICAL',
            [types_1.Severity.HIGH]: 'HIGH',
            [types_1.Severity.MEDIUM]: 'MEDIUM',
            [types_1.Severity.LOW]: 'LOW',
            [types_1.Severity.INFO]: 'INFO'
        };
        return tags[severity] || 'UNKNOWN';
    }
    /**
     * データフローをインライン形式でフォーマット
     */
    formatDataFlowInline(dataFlow) {
        const source = `${dataFlow.source.location.file}:${dataFlow.source.location.startLine}`;
        const sink = `${dataFlow.sink.location.file}:${dataFlow.sink.location.startLine}`;
        return `(Source: ${source} -> Sink: ${sink})`;
    }
    /**
     * データフローをブロック形式でフォーマット
     */
    formatDataFlowBlock(dataFlow) {
        const lines = [];
        // Source
        lines.push(` * Source: ${dataFlow.source.type}`);
        lines.push(` *   Location: ${dataFlow.source.location.file}:${dataFlow.source.location.startLine}`);
        // Path
        if (dataFlow.path && dataFlow.path.length > 0) {
            lines.push(` * Path:`);
            dataFlow.path.forEach((step, index) => {
                lines.push(` *   ${index + 1}. ${step.description || step.type}`);
                lines.push(` *      ${step.location.file}:${step.location.startLine}`);
            });
        }
        // Sink
        lines.push(` * Sink: ${dataFlow.sink.type}`);
        lines.push(` *   Location: ${dataFlow.sink.location.file}:${dataFlow.sink.location.startLine}`);
        return lines;
    }
    /**
     * ファイル拡張子に基づいてコメントスタイルを決定
     */
    getCommentStyle(filePath) {
        const ext = filePath.split('.').pop()?.toLowerCase() || '';
        const styles = {
            // C系言語
            'js': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'jsx': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'ts': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'tsx': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'java': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'c': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'cpp': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'cs': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'go': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'rust': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            'php': { inline: '//', blockStart: '/*', blockEnd: '*/' },
            // スクリプト言語
            'py': { inline: '#', blockStart: '"""', blockEnd: '"""' },
            'rb': { inline: '#', blockStart: '=begin', blockEnd: '=end' },
            'sh': { inline: '#' },
            'bash': { inline: '#' },
            // マークアップ
            'html': { inline: '<!--', blockEnd: '-->' },
            'xml': { inline: '<!--', blockEnd: '-->' },
            'vue': { inline: '<!--', blockEnd: '-->' },
            // その他
            'sql': { inline: '--', blockStart: '/*', blockEnd: '*/' },
            'yaml': { inline: '#' },
            'yml': { inline: '#' }
        };
        return styles[ext] || { inline: '//' };
    }
    /**
     * 言語に応じたアノテーションを生成
     */
    generateLanguageSpecificAnnotation(issue, filePath, options) {
        const commentStyle = this.getCommentStyle(filePath);
        const baseAnnotation = this.generateAnnotation(issue, options);
        // インラインコメントスタイルに変換
        if (baseAnnotation.startsWith('//')) {
            return baseAnnotation.replace('//', commentStyle.inline);
        }
        // ブロックコメントスタイルに変換
        if (baseAnnotation.startsWith('/**') && commentStyle.blockStart) {
            let converted = baseAnnotation.replace('/**', commentStyle.blockStart);
            if (commentStyle.blockEnd) {
                converted = converted.replace('*/', commentStyle.blockEnd);
            }
            return converted;
        }
        return baseAnnotation;
    }
};
exports.AnnotationGenerator = AnnotationGenerator;
exports.AnnotationGenerator = AnnotationGenerator = __decorate([
    (0, inversify_1.injectable)()
], AnnotationGenerator);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL3Nhc2FrYW1hL1Byb2plY3RzL1JpbW9yL3NyYy9yZXBvcnRpbmcvQW5ub3RhdGlvbkdlbmVyYXRvci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7Ozs7Ozs7OztBQUVILHlDQUF1QztBQUN2QyxtQ0FPaUI7QUFTVixJQUFNLG1CQUFtQixHQUF6QixNQUFNLG1CQUFtQjtJQUNiLGFBQWEsR0FBRyxPQUFPLENBQUM7SUFFekM7O09BRUc7SUFDSCxrQkFBa0IsQ0FBQyxLQUFZLEVBQUUsT0FBMkI7UUFDMUQsTUFBTSxNQUFNLEdBQUcsT0FBTyxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDO1FBQ3JELE1BQU0sTUFBTSxHQUFHLE9BQU8sRUFBRSxNQUFNLElBQUksUUFBUSxDQUFDO1FBRTNDLElBQUksTUFBTSxLQUFLLE9BQU8sRUFBRSxDQUFDO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDOUQsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQy9ELENBQUM7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSyx3QkFBd0IsQ0FDOUIsS0FBWSxFQUNaLE1BQWMsRUFDZCxPQUEyQjtRQUUzQixNQUFNLEtBQUssR0FBYSxFQUFFLENBQUM7UUFFM0IsY0FBYztRQUNkLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsUUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRXZFLFFBQVE7UUFDUixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFDbEMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFdkIsUUFBUTtRQUNSLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFMUIsa0JBQWtCO1FBQ2xCLElBQUksT0FBTyxFQUFFLGVBQWUsSUFBSSxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDL0MsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUVELE9BQU8sTUFBTSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7SUFDakMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssdUJBQXVCLENBQzdCLEtBQVksRUFDWixNQUFjLEVBQ2QsT0FBMkI7UUFFM0IsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBRTNCLE1BQU07UUFDTixLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxNQUFNLDJCQUEyQixDQUFDLENBQUM7UUFDcEQsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVsQixRQUFRO1FBQ1IsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLEtBQUssQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQzdDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRWxCLGVBQWU7UUFDZixNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzFCLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLElBQUksS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3pCLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2pDLE1BQU0sbUJBQW1CLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0QsbUJBQW1CLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNqQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxXQUFXO1FBQ1gsSUFBSSxPQUFPLEVBQUUsZUFBZSxJQUFJLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUMvQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUNyQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzFELENBQUM7UUFFRCxPQUFPO1FBQ1AsSUFBSSxLQUFLLENBQUMsVUFBVSxJQUFJLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3BELEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEIsS0FBSyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQzdCLEtBQUssQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QixLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxNQUFNO1FBQ04sS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVsQixPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsc0JBQXNCLENBQ3BCLE1BQWUsRUFDZixPQUEyQjtRQUUzQixNQUFNLGlCQUFpQixHQUFHLElBQUksR0FBRyxFQUE0QixDQUFDO1FBRTlELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRO2dCQUFFLE9BQU87WUFDNUIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDakMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNqQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ2xDLENBQUM7WUFFRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzNELE1BQU0sY0FBYyxHQUFtQjtnQkFDckMsVUFBVSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxHQUFHLENBQUMsRUFBRSxZQUFZO2dCQUN0RCxVQUFVO2FBQ1gsQ0FBQztZQUVGLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDcEQsQ0FBQyxDQUFDLENBQUM7UUFFSCx3QkFBd0I7UUFDeEIsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxFQUFFO1lBQzlDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8saUJBQWlCLENBQUM7SUFDM0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsd0JBQXdCLENBQUMsTUFBZTtRQUN0QyxNQUFNLEtBQUssR0FBYSxFQUFFLENBQUM7UUFFM0IsS0FBSyxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDZixLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3pCLEtBQUssQ0FBQyxJQUFJLENBQUMsdUJBQXVCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFZixjQUFjO1FBQ2QsTUFBTSxZQUFZLEdBQUcsSUFBSSxHQUFHLEVBQW1CLENBQUM7UUFDaEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVE7Z0JBQUUsT0FBTztZQUM1QixNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztZQUNqQyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUM1QixZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM3QixDQUFDO1lBQ0QsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxvQkFBb0I7UUFDcEIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsRUFBRTtZQUN4QyxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUMsQ0FBQztZQUMvQixLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBRWYsVUFBVTtZQUNWLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxTQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV2RixVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUN6QixLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksS0FBSyxDQUFDLFFBQVEsRUFBRSxTQUFTLElBQUksQ0FBQyxLQUFLLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUN4RSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNmLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xCLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRWYsSUFBSSxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7b0JBQ3pCLEtBQUssQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDO29CQUMxRCxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNqQixDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxjQUFjLENBQUMsUUFBa0M7UUFDdkQsTUFBTSxJQUFJLEdBQTZCO1lBQ3JDLENBQUMsZ0JBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxVQUFVO1lBQy9CLENBQUMsZ0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNO1lBQ3ZCLENBQUMsZ0JBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFRO1lBQzNCLENBQUMsZ0JBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLO1lBQ3JCLENBQUMsZ0JBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNO1NBQ3hCLENBQUM7UUFDRixPQUFPLElBQUksQ0FBQyxRQUFvQixDQUFDLElBQUksU0FBUyxDQUFDO0lBQ2pELENBQUM7SUFFRDs7T0FFRztJQUNLLG9CQUFvQixDQUFDLFFBQWtCO1FBQzdDLE1BQU0sTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ3hGLE1BQU0sSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2xGLE9BQU8sWUFBWSxNQUFNLGFBQWEsSUFBSSxHQUFHLENBQUM7SUFDaEQsQ0FBQztJQUVEOztPQUVHO0lBQ0ssbUJBQW1CLENBQUMsUUFBa0I7UUFDNUMsTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFDO1FBRTNCLFNBQVM7UUFDVCxLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELEtBQUssQ0FBQyxJQUFJLENBQUMsa0JBQWtCLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO1FBRXBHLE9BQU87UUFDUCxJQUFJLFFBQVEsQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDOUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN2QixRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDcEMsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssR0FBRyxDQUFDLEtBQUssSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDbEUsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUN6RSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxPQUFPO1FBQ1AsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUM3QyxLQUFLLENBQUMsSUFBSSxDQUFDLGtCQUFrQixRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUVoRyxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWUsQ0FBQyxRQUFnQjtRQUM5QixNQUFNLEdBQUcsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUUzRCxNQUFNLE1BQU0sR0FBK0U7WUFDekYsT0FBTztZQUNQLElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3hELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3pELElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3hELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3pELE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQzFELEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3ZELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3pELElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3hELElBQUksRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQ3hELE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBQzFELEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO1lBRXpELFVBQVU7WUFDVixJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtZQUN6RCxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRTtZQUM3RCxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFO1lBQ3JCLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUU7WUFFdkIsU0FBUztZQUNULE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRTtZQUMzQyxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUU7WUFDMUMsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFO1lBRTFDLE1BQU07WUFDTixLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRTtZQUN6RCxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFO1lBQ3ZCLEtBQUssRUFBRSxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUU7U0FDdkIsQ0FBQztRQUVGLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFRDs7T0FFRztJQUNILGtDQUFrQyxDQUNoQyxLQUFZLEVBQ1osUUFBZ0IsRUFDaEIsT0FBMkI7UUFFM0IsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwRCxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRS9ELG1CQUFtQjtRQUNuQixJQUFJLGNBQWMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNwQyxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzRCxDQUFDO1FBRUQsa0JBQWtCO1FBQ2xCLElBQUksY0FBYyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsSUFBSSxZQUFZLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDaEUsSUFBSSxTQUFTLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUMxQixTQUFTLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdELENBQUM7WUFDRCxPQUFPLFNBQVMsQ0FBQztRQUNuQixDQUFDO1FBRUQsT0FBTyxjQUFjLENBQUM7SUFDeEIsQ0FBQztDQUNGLENBQUE7QUEvU1ksa0RBQW1COzhCQUFuQixtQkFBbUI7SUFEL0IsSUFBQSxzQkFBVSxHQUFFO0dBQ0EsbUJBQW1CLENBK1MvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvc2FzYWthbWEvUHJvamVjdHMvUmltb3Ivc3JjL3JlcG9ydGluZy9Bbm5vdGF0aW9uR2VuZXJhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQW5ub3RhdGlvbiBHZW5lcmF0b3JcbiAqIHYwLjguMCAtIFBoYXNlIDQ6IENvbnRleHQgRW5naW5lZXJpbmdcbiAqIFxuICog5qSc5Ye644GV44KM44Gf5ZWP6aGM44Gr5a++5b+c44GZ44KL44Kk44Oz44Op44Kk44Oz44O744Ki44OO44OG44O844K344On44Oz44KS55Sf5oiQXG4gKi9cblxuaW1wb3J0IHsgaW5qZWN0YWJsZSB9IGZyb20gJ2ludmVyc2lmeSc7XG5pbXBvcnQge1xuICBJc3N1ZSxcbiAgU2V2ZXJpdHksXG4gIElzc3VlVHlwZSxcbiAgQ29kZUxvY2F0aW9uLFxuICBEYXRhRmxvdyxcbiAgQW5ub3RhdGlvbk9wdGlvbnNcbn0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBTZXZlcml0eUxldmVsIH0gZnJvbSAnLi4vY29yZS90eXBlcyc7XG5cbmludGVyZmFjZSBBbm5vdGF0aW9uTGluZSB7XG4gIGxpbmVOdW1iZXI6IG51bWJlcjtcbiAgYW5ub3RhdGlvbjogc3RyaW5nO1xufVxuXG5AaW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQW5ub3RhdGlvbkdlbmVyYXRvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgZGVmYXVsdFByZWZpeCA9ICdSSU1PUic7XG5cbiAgLyoqXG4gICAqIOWVj+mhjOOBq+WvvuOBmeOCi+OCouODjuODhuODvOOCt+ODp+ODs+OCkueUn+aIkFxuICAgKi9cbiAgZ2VuZXJhdGVBbm5vdGF0aW9uKGlzc3VlOiBJc3N1ZSwgb3B0aW9ucz86IEFubm90YXRpb25PcHRpb25zKTogc3RyaW5nIHtcbiAgICBjb25zdCBwcmVmaXggPSBvcHRpb25zPy5wcmVmaXggfHwgdGhpcy5kZWZhdWx0UHJlZml4O1xuICAgIGNvbnN0IGZvcm1hdCA9IG9wdGlvbnM/LmZvcm1hdCB8fCAnaW5saW5lJztcblxuICAgIGlmIChmb3JtYXQgPT09ICdibG9jaycpIHtcbiAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlQmxvY2tBbm5vdGF0aW9uKGlzc3VlLCBwcmVmaXgsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZUlubGluZUFubm90YXRpb24oaXNzdWUsIHByZWZpeCwgb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOOCpOODs+ODqeOCpOODs+OCouODjuODhuODvOOCt+ODp+ODs+OCkueUn+aIkFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUlubGluZUFubm90YXRpb24oXG4gICAgaXNzdWU6IElzc3VlLFxuICAgIHByZWZpeDogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBBbm5vdGF0aW9uT3B0aW9uc1xuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHBhcnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8g44OX44Os44OV44Kj44OD44Kv44K544Go6YeN6KaB5bqmXG4gICAgcGFydHMucHVzaChgJHtwcmVmaXh9LSR7dGhpcy5nZXRTZXZlcml0eVRhZyhpc3N1ZS5zZXZlcml0eSBhcyBhbnkpfTpgKTtcblxuICAgIC8vIOWVj+mhjOOCv+OCpOODl1xuICAgIHBhcnRzLnB1c2goYFske2lzc3VlLnNldmVyaXR5fV1gKTtcbiAgICBwYXJ0cy5wdXNoKGlzc3VlLnR5cGUpO1xuXG4gICAgLy8g44Oh44OD44K744O844K4XG4gICAgcGFydHMucHVzaCgnLScpO1xuICAgIHBhcnRzLnB1c2goaXNzdWUubWVzc2FnZSk7XG5cbiAgICAvLyDjg4fjg7zjgr/jg5Xjg63jg7zmg4XloLHvvIjjgqrjg5fjgrfjg6fjg7PvvIlcbiAgICBpZiAob3B0aW9ucz8uaW5jbHVkZURhdGFGbG93ICYmIGlzc3VlLmRhdGFGbG93KSB7XG4gICAgICBwYXJ0cy5wdXNoKHRoaXMuZm9ybWF0RGF0YUZsb3dJbmxpbmUoaXNzdWUuZGF0YUZsb3cpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYC8vICR7cGFydHMuam9pbignICcpfWA7XG4gIH1cblxuICAvKipcbiAgICog44OW44Ot44OD44Kv44Ki44OO44OG44O844K344On44Oz44KS55Sf5oiQXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQmxvY2tBbm5vdGF0aW9uKFxuICAgIGlzc3VlOiBJc3N1ZSxcbiAgICBwcmVmaXg6IHN0cmluZyxcbiAgICBvcHRpb25zPzogQW5ub3RhdGlvbk9wdGlvbnNcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIOmWi+Wni+ihjFxuICAgIGxpbmVzLnB1c2goJy8qKicpO1xuICAgIGxpbmVzLnB1c2goYCAqICR7cHJlZml4fSBTZWN1cml0eSBBbmFseXNpcyBSZXBvcnRgKTtcbiAgICBsaW5lcy5wdXNoKGAgKiBgKTtcbiAgICBcbiAgICAvLyDllY/poYzjga7oqbPntLBcbiAgICBsaW5lcy5wdXNoKGAgKiBJc3N1ZTogJHtpc3N1ZS50eXBlfWApO1xuICAgIGxpbmVzLnB1c2goYCAqIFNldmVyaXR5OiAke2lzc3VlLnNldmVyaXR5fWApO1xuICAgIGxpbmVzLnB1c2goYCAqIElEOiAke2lzc3VlLmlkfWApO1xuICAgIGxpbmVzLnB1c2goYCAqIGApO1xuICAgIFxuICAgIC8vIOODoeODg+OCu+ODvOOCuO+8iOikh+aVsOihjOWvvuW/nO+8iVxuICAgIGNvbnN0IG1lc3NhZ2VMaW5lcyA9IGlzc3VlLm1lc3NhZ2Uuc3BsaXQoJ1xcbicpO1xuICAgIG1lc3NhZ2VMaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xuICAgICAgbGluZXMucHVzaChgICogJHtsaW5lfWApO1xuICAgIH0pO1xuXG4gICAgLy8g5o6o5aWo5LqL6aCFXG4gICAgaWYgKGlzc3VlLnJlY29tbWVuZGF0aW9uKSB7XG4gICAgICBsaW5lcy5wdXNoKGAgKiBgKTtcbiAgICAgIGxpbmVzLnB1c2goYCAqIFJlY29tbWVuZGF0aW9uOmApO1xuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25MaW5lcyA9IGlzc3VlLnJlY29tbWVuZGF0aW9uLnNwbGl0KCdcXG4nKTtcbiAgICAgIHJlY29tbWVuZGF0aW9uTGluZXMuZm9yRWFjaChsaW5lID0+IHtcbiAgICAgICAgbGluZXMucHVzaChgICogJHtsaW5lfWApO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8g44OH44O844K/44OV44Ot44O85oOF5aCxXG4gICAgaWYgKG9wdGlvbnM/LmluY2x1ZGVEYXRhRmxvdyAmJiBpc3N1ZS5kYXRhRmxvdykge1xuICAgICAgbGluZXMucHVzaChgICogYCk7XG4gICAgICBsaW5lcy5wdXNoKGAgKiBEYXRhIEZsb3cgQW5hbHlzaXM6YCk7XG4gICAgICBsaW5lcy5wdXNoKC4uLnRoaXMuZm9ybWF0RGF0YUZsb3dCbG9jayhpc3N1ZS5kYXRhRmxvdykpO1xuICAgIH1cblxuICAgIC8vIOWPguiAg+izh+aWmVxuICAgIGlmIChpc3N1ZS5yZWZlcmVuY2VzICYmIGlzc3VlLnJlZmVyZW5jZXMubGVuZ3RoID4gMCkge1xuICAgICAgbGluZXMucHVzaChgICogYCk7XG4gICAgICBsaW5lcy5wdXNoKGAgKiBSZWZlcmVuY2VzOmApO1xuICAgICAgaXNzdWUucmVmZXJlbmNlcy5mb3JFYWNoKHJlZiA9PiB7XG4gICAgICAgIGxpbmVzLnB1c2goYCAqIC0gJHtyZWZ9YCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyDntYLkuobooYxcbiAgICBsaW5lcy5wdXNoKCcgKi8nKTtcblxuICAgIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDopIfmlbDjga7llY/poYzjgavlr77jgZnjgovjgqLjg47jg4bjg7zjgrfjg6fjg7PjgpLooYznlarlj7fjgafjgrDjg6vjg7zjg5fljJZcbiAgICovXG4gIGdyb3VwQW5ub3RhdGlvbnNCeUxpbmUoXG4gICAgaXNzdWVzOiBJc3N1ZVtdLFxuICAgIG9wdGlvbnM/OiBBbm5vdGF0aW9uT3B0aW9uc1xuICApOiBNYXA8c3RyaW5nLCBBbm5vdGF0aW9uTGluZVtdPiB7XG4gICAgY29uc3QgYW5ub3RhdGlvbnNCeUZpbGUgPSBuZXcgTWFwPHN0cmluZywgQW5ub3RhdGlvbkxpbmVbXT4oKTtcblxuICAgIGlzc3Vlcy5mb3JFYWNoKGlzc3VlID0+IHtcbiAgICAgIGlmICghaXNzdWUubG9jYXRpb24pIHJldHVybjtcbiAgICAgIGNvbnN0IGZpbGUgPSBpc3N1ZS5sb2NhdGlvbi5maWxlO1xuICAgICAgaWYgKCFhbm5vdGF0aW9uc0J5RmlsZS5oYXMoZmlsZSkpIHtcbiAgICAgICAgYW5ub3RhdGlvbnNCeUZpbGUuc2V0KGZpbGUsIFtdKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYW5ub3RhdGlvbiA9IHRoaXMuZ2VuZXJhdGVBbm5vdGF0aW9uKGlzc3VlLCBvcHRpb25zKTtcbiAgICAgIGNvbnN0IGFubm90YXRpb25MaW5lOiBBbm5vdGF0aW9uTGluZSA9IHtcbiAgICAgICAgbGluZU51bWJlcjogaXNzdWUubG9jYXRpb24uc3RhcnRMaW5lIC0gMSwgLy8gMC1pbmRleGVkXG4gICAgICAgIGFubm90YXRpb25cbiAgICAgIH07XG5cbiAgICAgIGFubm90YXRpb25zQnlGaWxlLmdldChmaWxlKSEucHVzaChhbm5vdGF0aW9uTGluZSk7XG4gICAgfSk7XG5cbiAgICAvLyDlkITjg5XjgqHjgqTjg6vjga7jgqLjg47jg4bjg7zjgrfjg6fjg7PjgpLooYznlarlj7fjgafjgr3jg7zjg4hcbiAgICBhbm5vdGF0aW9uc0J5RmlsZS5mb3JFYWNoKChhbm5vdGF0aW9ucywgZmlsZSkgPT4ge1xuICAgICAgYW5ub3RhdGlvbnMuc29ydCgoYSwgYikgPT4gYS5saW5lTnVtYmVyIC0gYi5saW5lTnVtYmVyKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBhbm5vdGF0aW9uc0J5RmlsZTtcbiAgfVxuXG4gIC8qKlxuICAgKiDjgqLjg47jg4bjg7zjgrfjg6fjg7PnlKjjga7jgrnjgr/jg7Pjg4njgqLjg63jg7Pjg6zjg53jg7zjg4jjgpLnlJ/miJBcbiAgICovXG4gIGdlbmVyYXRlQW5ub3RhdGlvblJlcG9ydChpc3N1ZXM6IElzc3VlW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGxpbmVzLnB1c2goJyMgUmltb3IgQW5ub3RhdGlvbiBSZXBvcnQnKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgICBsaW5lcy5wdXNoKCcjIyBTdW1tYXJ5Jyk7XG4gICAgbGluZXMucHVzaChgVG90YWwgaXNzdWVzIGZvdW5kOiAke2lzc3Vlcy5sZW5ndGh9YCk7XG4gICAgbGluZXMucHVzaCgnJyk7XG4gICAgXG4gICAgLy8g44OV44Kh44Kk44Or5Yil44Gr44Kw44Or44O844OX5YyWXG4gICAgY29uc3QgaXNzdWVzQnlGaWxlID0gbmV3IE1hcDxzdHJpbmcsIElzc3VlW10+KCk7XG4gICAgaXNzdWVzLmZvckVhY2goaXNzdWUgPT4ge1xuICAgICAgaWYgKCFpc3N1ZS5sb2NhdGlvbikgcmV0dXJuO1xuICAgICAgY29uc3QgZmlsZSA9IGlzc3VlLmxvY2F0aW9uLmZpbGU7XG4gICAgICBpZiAoIWlzc3Vlc0J5RmlsZS5oYXMoZmlsZSkpIHtcbiAgICAgICAgaXNzdWVzQnlGaWxlLnNldChmaWxlLCBbXSk7XG4gICAgICB9XG4gICAgICBpc3N1ZXNCeUZpbGUuZ2V0KGZpbGUpIS5wdXNoKGlzc3VlKTtcbiAgICB9KTtcblxuICAgIC8vIOODleOCoeOCpOODq+OBlOOBqOOBq+OCouODjuODhuODvOOCt+ODp+ODs+OCkueUn+aIkFxuICAgIGlzc3Vlc0J5RmlsZS5mb3JFYWNoKChmaWxlSXNzdWVzLCBmaWxlKSA9PiB7XG4gICAgICBsaW5lcy5wdXNoKGAjIyBGaWxlOiAke2ZpbGV9YCk7XG4gICAgICBsaW5lcy5wdXNoKCcnKTtcbiAgICAgIFxuICAgICAgLy8g6KGM55Wq5Y+344Gn44K944O844OIXG4gICAgICBmaWxlSXNzdWVzLnNvcnQoKGEsIGIpID0+IChhLmxvY2F0aW9uPy5zdGFydExpbmUgfHwgMCkgLSAoYi5sb2NhdGlvbj8uc3RhcnRMaW5lIHx8IDApKTtcbiAgICAgIFxuICAgICAgZmlsZUlzc3Vlcy5mb3JFYWNoKGlzc3VlID0+IHtcbiAgICAgICAgbGluZXMucHVzaChgIyMjIExpbmUgJHtpc3N1ZS5sb2NhdGlvbj8uc3RhcnRMaW5lIHx8IDB9OiAke2lzc3VlLnR5cGV9YCk7XG4gICAgICAgIGxpbmVzLnB1c2goJycpO1xuICAgICAgICBsaW5lcy5wdXNoKCdgYGAnKTtcbiAgICAgICAgbGluZXMucHVzaCh0aGlzLmdlbmVyYXRlQW5ub3RhdGlvbihpc3N1ZSwgeyBmb3JtYXQ6ICdpbmxpbmUnIH0pKTtcbiAgICAgICAgbGluZXMucHVzaCgnYGBgJyk7XG4gICAgICAgIGxpbmVzLnB1c2goJycpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGlzc3VlLnJlY29tbWVuZGF0aW9uKSB7XG4gICAgICAgICAgbGluZXMucHVzaChgKipSZWNvbW1lbmRhdGlvbioqOiAke2lzc3VlLnJlY29tbWVuZGF0aW9ufWApO1xuICAgICAgICAgIGxpbmVzLnB1c2goJycpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiDph43opoHluqbjgr/jgrDjgpLlj5blvpdcbiAgICovXG4gIHByaXZhdGUgZ2V0U2V2ZXJpdHlUYWcoc2V2ZXJpdHk6IFNldmVyaXR5IHwgU2V2ZXJpdHlMZXZlbCk6IHN0cmluZyB7XG4gICAgY29uc3QgdGFnczogUmVjb3JkPFNldmVyaXR5LCBzdHJpbmc+ID0ge1xuICAgICAgW1NldmVyaXR5LkNSSVRJQ0FMXTogJ0NSSVRJQ0FMJyxcbiAgICAgIFtTZXZlcml0eS5ISUdIXTogJ0hJR0gnLFxuICAgICAgW1NldmVyaXR5Lk1FRElVTV06ICdNRURJVU0nLFxuICAgICAgW1NldmVyaXR5LkxPV106ICdMT1cnLFxuICAgICAgW1NldmVyaXR5LklORk9dOiAnSU5GTydcbiAgICB9O1xuICAgIHJldHVybiB0YWdzW3NldmVyaXR5IGFzIFNldmVyaXR5XSB8fCAnVU5LTk9XTic7XG4gIH1cblxuICAvKipcbiAgICog44OH44O844K/44OV44Ot44O844KS44Kk44Oz44Op44Kk44Oz5b2i5byP44Gn44OV44Kp44O844Oe44OD44OIXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdERhdGFGbG93SW5saW5lKGRhdGFGbG93OiBEYXRhRmxvdyk6IHN0cmluZyB7XG4gICAgY29uc3Qgc291cmNlID0gYCR7ZGF0YUZsb3cuc291cmNlLmxvY2F0aW9uLmZpbGV9OiR7ZGF0YUZsb3cuc291cmNlLmxvY2F0aW9uLnN0YXJ0TGluZX1gO1xuICAgIGNvbnN0IHNpbmsgPSBgJHtkYXRhRmxvdy5zaW5rLmxvY2F0aW9uLmZpbGV9OiR7ZGF0YUZsb3cuc2luay5sb2NhdGlvbi5zdGFydExpbmV9YDtcbiAgICByZXR1cm4gYChTb3VyY2U6ICR7c291cmNlfSAtPiBTaW5rOiAke3Npbmt9KWA7XG4gIH1cblxuICAvKipcbiAgICog44OH44O844K/44OV44Ot44O844KS44OW44Ot44OD44Kv5b2i5byP44Gn44OV44Kp44O844Oe44OD44OIXG4gICAqL1xuICBwcml2YXRlIGZvcm1hdERhdGFGbG93QmxvY2soZGF0YUZsb3c6IERhdGFGbG93KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8gU291cmNlXG4gICAgbGluZXMucHVzaChgICogU291cmNlOiAke2RhdGFGbG93LnNvdXJjZS50eXBlfWApO1xuICAgIGxpbmVzLnB1c2goYCAqICAgTG9jYXRpb246ICR7ZGF0YUZsb3cuc291cmNlLmxvY2F0aW9uLmZpbGV9OiR7ZGF0YUZsb3cuc291cmNlLmxvY2F0aW9uLnN0YXJ0TGluZX1gKTtcblxuICAgIC8vIFBhdGhcbiAgICBpZiAoZGF0YUZsb3cucGF0aCAmJiBkYXRhRmxvdy5wYXRoLmxlbmd0aCA+IDApIHtcbiAgICAgIGxpbmVzLnB1c2goYCAqIFBhdGg6YCk7XG4gICAgICBkYXRhRmxvdy5wYXRoLmZvckVhY2goKHN0ZXAsIGluZGV4KSA9PiB7XG4gICAgICAgIGxpbmVzLnB1c2goYCAqICAgJHtpbmRleCArIDF9LiAke3N0ZXAuZGVzY3JpcHRpb24gfHwgc3RlcC50eXBlfWApO1xuICAgICAgICBsaW5lcy5wdXNoKGAgKiAgICAgICR7c3RlcC5sb2NhdGlvbi5maWxlfToke3N0ZXAubG9jYXRpb24uc3RhcnRMaW5lfWApO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU2lua1xuICAgIGxpbmVzLnB1c2goYCAqIFNpbms6ICR7ZGF0YUZsb3cuc2luay50eXBlfWApO1xuICAgIGxpbmVzLnB1c2goYCAqICAgTG9jYXRpb246ICR7ZGF0YUZsb3cuc2luay5sb2NhdGlvbi5maWxlfToke2RhdGFGbG93LnNpbmsubG9jYXRpb24uc3RhcnRMaW5lfWApO1xuXG4gICAgcmV0dXJuIGxpbmVzO1xuICB9XG5cbiAgLyoqXG4gICAqIOODleOCoeOCpOODq+aLoeW8teWtkOOBq+WfuuOBpeOBhOOBpuOCs+ODoeODs+ODiOOCueOCv+OCpOODq+OCkuaxuuWumlxuICAgKi9cbiAgZ2V0Q29tbWVudFN0eWxlKGZpbGVQYXRoOiBzdHJpbmcpOiB7IGlubGluZTogc3RyaW5nOyBibG9ja1N0YXJ0Pzogc3RyaW5nOyBibG9ja0VuZD86IHN0cmluZyB9IHtcbiAgICBjb25zdCBleHQgPSBmaWxlUGF0aC5zcGxpdCgnLicpLnBvcCgpPy50b0xvd2VyQ2FzZSgpIHx8ICcnO1xuICAgIFxuICAgIGNvbnN0IHN0eWxlczogUmVjb3JkPHN0cmluZywgeyBpbmxpbmU6IHN0cmluZzsgYmxvY2tTdGFydD86IHN0cmluZzsgYmxvY2tFbmQ/OiBzdHJpbmcgfT4gPSB7XG4gICAgICAvLyBD57O76KiA6KqeXG4gICAgICAnanMnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgICdqc3gnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgICd0cyc6IHsgaW5saW5lOiAnLy8nLCBibG9ja1N0YXJ0OiAnLyonLCBibG9ja0VuZDogJyovJyB9LFxuICAgICAgJ3RzeCc6IHsgaW5saW5lOiAnLy8nLCBibG9ja1N0YXJ0OiAnLyonLCBibG9ja0VuZDogJyovJyB9LFxuICAgICAgJ2phdmEnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgICdjJzogeyBpbmxpbmU6ICcvLycsIGJsb2NrU3RhcnQ6ICcvKicsIGJsb2NrRW5kOiAnKi8nIH0sXG4gICAgICAnY3BwJzogeyBpbmxpbmU6ICcvLycsIGJsb2NrU3RhcnQ6ICcvKicsIGJsb2NrRW5kOiAnKi8nIH0sXG4gICAgICAnY3MnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgICdnbyc6IHsgaW5saW5lOiAnLy8nLCBibG9ja1N0YXJ0OiAnLyonLCBibG9ja0VuZDogJyovJyB9LFxuICAgICAgJ3J1c3QnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgICdwaHAnOiB7IGlubGluZTogJy8vJywgYmxvY2tTdGFydDogJy8qJywgYmxvY2tFbmQ6ICcqLycgfSxcbiAgICAgIFxuICAgICAgLy8g44K544Kv44Oq44OX44OI6KiA6KqeXG4gICAgICAncHknOiB7IGlubGluZTogJyMnLCBibG9ja1N0YXJ0OiAnXCJcIlwiJywgYmxvY2tFbmQ6ICdcIlwiXCInIH0sXG4gICAgICAncmInOiB7IGlubGluZTogJyMnLCBibG9ja1N0YXJ0OiAnPWJlZ2luJywgYmxvY2tFbmQ6ICc9ZW5kJyB9LFxuICAgICAgJ3NoJzogeyBpbmxpbmU6ICcjJyB9LFxuICAgICAgJ2Jhc2gnOiB7IGlubGluZTogJyMnIH0sXG4gICAgICBcbiAgICAgIC8vIOODnuODvOOCr+OCouODg+ODl1xuICAgICAgJ2h0bWwnOiB7IGlubGluZTogJzwhLS0nLCBibG9ja0VuZDogJy0tPicgfSxcbiAgICAgICd4bWwnOiB7IGlubGluZTogJzwhLS0nLCBibG9ja0VuZDogJy0tPicgfSxcbiAgICAgICd2dWUnOiB7IGlubGluZTogJzwhLS0nLCBibG9ja0VuZDogJy0tPicgfSxcbiAgICAgIFxuICAgICAgLy8g44Gd44Gu5LuWXG4gICAgICAnc3FsJzogeyBpbmxpbmU6ICctLScsIGJsb2NrU3RhcnQ6ICcvKicsIGJsb2NrRW5kOiAnKi8nIH0sXG4gICAgICAneWFtbCc6IHsgaW5saW5lOiAnIycgfSxcbiAgICAgICd5bWwnOiB7IGlubGluZTogJyMnIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHN0eWxlc1tleHRdIHx8IHsgaW5saW5lOiAnLy8nIH07XG4gIH1cblxuICAvKipcbiAgICog6KiA6Kqe44Gr5b+c44GY44Gf44Ki44OO44OG44O844K344On44Oz44KS55Sf5oiQXG4gICAqL1xuICBnZW5lcmF0ZUxhbmd1YWdlU3BlY2lmaWNBbm5vdGF0aW9uKFxuICAgIGlzc3VlOiBJc3N1ZSxcbiAgICBmaWxlUGF0aDogc3RyaW5nLFxuICAgIG9wdGlvbnM/OiBBbm5vdGF0aW9uT3B0aW9uc1xuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbW1lbnRTdHlsZSA9IHRoaXMuZ2V0Q29tbWVudFN0eWxlKGZpbGVQYXRoKTtcbiAgICBjb25zdCBiYXNlQW5ub3RhdGlvbiA9IHRoaXMuZ2VuZXJhdGVBbm5vdGF0aW9uKGlzc3VlLCBvcHRpb25zKTtcblxuICAgIC8vIOOCpOODs+ODqeOCpOODs+OCs+ODoeODs+ODiOOCueOCv+OCpOODq+OBq+WkieaPm1xuICAgIGlmIChiYXNlQW5ub3RhdGlvbi5zdGFydHNXaXRoKCcvLycpKSB7XG4gICAgICByZXR1cm4gYmFzZUFubm90YXRpb24ucmVwbGFjZSgnLy8nLCBjb21tZW50U3R5bGUuaW5saW5lKTtcbiAgICB9XG5cbiAgICAvLyDjg5bjg63jg4Pjgq/jgrPjg6Hjg7Pjg4jjgrnjgr/jgqTjg6vjgavlpInmj5tcbiAgICBpZiAoYmFzZUFubm90YXRpb24uc3RhcnRzV2l0aCgnLyoqJykgJiYgY29tbWVudFN0eWxlLmJsb2NrU3RhcnQpIHtcbiAgICAgIGxldCBjb252ZXJ0ZWQgPSBiYXNlQW5ub3RhdGlvbi5yZXBsYWNlKCcvKionLCBjb21tZW50U3R5bGUuYmxvY2tTdGFydCk7XG4gICAgICBpZiAoY29tbWVudFN0eWxlLmJsb2NrRW5kKSB7XG4gICAgICAgIGNvbnZlcnRlZCA9IGNvbnZlcnRlZC5yZXBsYWNlKCcqLycsIGNvbW1lbnRTdHlsZS5ibG9ja0VuZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udmVydGVkO1xuICAgIH1cblxuICAgIHJldHVybiBiYXNlQW5ub3RhdGlvbjtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==